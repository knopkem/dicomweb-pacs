/*! For license information please see 164.bundle.ab28621e569cd0e68db4.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[164,473],{25271:(e,t,n)=>{n.d(t,{A:()=>o});const o=async function(e,t,n,o=!1,r=!1){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!n.addImages)return void console.warn(`Viewport with Id ${t} does not have addImages. Cannot add image segmentation to this viewport.`)}const i=n.map((async n=>e.getViewport(n).addImages(t,o,r)));await Promise.all(i)}},74260:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(6203);const r=async function(e,t,n,r=!1,i=!1){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!(n instanceof o.A))return void console.warn(`Viewport with Id ${t} is not a BaseVolumeViewport. Cannot add volume to this viewport.`)}const a=n.map((async n=>{const o=e.getViewport(n);await o.addVolumes(t,r,i)}));await Promise.all(a)}},78988:(e,t,n)=>{n.d(t,{A:()=>s});const o=Symbol("DefaultSettings"),r=Symbol("RuntimeSettings"),i=Symbol("ObjectSettingsMap"),a=Symbol("Dictionary");class s{constructor(e){const t=Object.create(e instanceof s&&a in e?e[a]:null);Object.seal(Object.defineProperty(this,a,{value:t}))}set(e,t){return c(this[a],e,t,null)}get(e){return function(e,t){return e[t]}(this[a],e)}unset(e){return function(e,t){if(t.endsWith(".")){let n=0;const o=t,r=o.slice(0,-1),i=0===r.length;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i||t.startsWith(o)||t===r)&&(delete e[t],++n);return n>0}return delete e[t]}(this[a],e+"")}forEach(e){l(this[a],e)}extend(){return new s(this)}import(e){u(e)&&Object.keys(e).forEach((t=>{c(this[a],t,e[t],null)}))}dump(){const e={};return l(this[a],((t,n)=>{void 0!==n&&d(e,t,n)})),e}static assert(e){return e instanceof s?e:s.getRuntimeSettings()}static getDefaultSettings(e=null){let t=s[o];if(t instanceof s||(t=new s,s[o]=t),e){const n={};return t.forEach((o=>{if(o.startsWith(e)){const r=o.split(`${e}.`)[1];n[r]=t.get(o)}})),n}return t}static getRuntimeSettings(){let e=s[r];return e instanceof s||(e=new s(s.getDefaultSettings()),s[r]=e),e}static getObjectSettings(e,t){let n=null;if(e instanceof s)n=e;else if("object"==typeof e&&null!==e){let o=s[i];o instanceof WeakMap||(o=new WeakMap,s[i]=o),n=o.get(e),n instanceof s||(n=new s(s.assert(s.getObjectSettings(t))),o.set(e,n))}return n}static extendRuntimeSettings(){return s.getRuntimeSettings().extend()}}function l(e,t){for(const n in e)t(n,e[n])}function c(e,t,n,o){return!!function(e){let t,n,o;if("string"!=typeof e||(t=e.length-1)<0)return!1;o=-1;for(;(n=e.indexOf(".",o+1))>=0;){if(n-o<2||n===t)return!1;o=n}return!0}(t)&&(u(n)?function(e,t,n,o){let r;if(o.has(n))return c(e,t,null,o);o.add(n),r=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(c(e,0===i.length?t:`${t}.${i}`,n[i],o)||++r);return o.delete(n),0===r}(e,t,n,o instanceof WeakSet?o:new WeakSet):(e[t]=n,!0))}function u(e){if("object"==typeof e&&null!==e){const t=Object.getPrototypeOf(e);if(t===Object.prototype||null===t)return!0}return!1}function d(e,t,n){const o=t.indexOf(".");if(o>=0){const r=t.slice(0,o);let i=e[r];if("object"!=typeof i||null===i){const t=i;i={},void 0!==t&&(i[""]=t),e[r]=i}d(i,t.slice(o+1,t.length),n)}else e[t]=n}s.getDefaultSettings().set("useCursors",!0)},88903:(e,t,n)=>{n.d(t,{EPSILON:()=>i,MPR_CAMERA_VALUES:()=>a.A,RENDERING_DEFAULTS:()=>r,VIEWPORT_PRESETS:()=>s.A});n(21301);const o={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(o);const r=o,i=.001;var a=n(99753),s=n(59845);n(61507)},15453:(e,t,n)=>{var o;n.d(t,{A:()=>r}),function(e){e.Interaction="interaction",e.Thumbnail="thumbnail",e.Prefetch="prefetch",e.Compute="compute"}(o||(o={}));const r=o},17702:(e,t,n)=>{var o;n.d(t,{A:()=>r}),function(e){e.NO_DATA="noData",e.LOADING="loading",e.PRE_RENDER="preRender",e.RESIZE="resize",e.RENDERED="rendered"}(o||(o={}));const r=o},50002:(e,t,n)=>{n.d(t,{BlendModes:()=>u,CalibrationTypes:()=>I,ContourType:()=>p,Events:()=>o.A,GeometryType:()=>f,ImageQualityStatus:()=>E.A,InterpolationType:()=>a.A,MetadataModules:()=>S.A,OrientationAxis:()=>g.A,RequestType:()=>r.A,SharedArrayBufferModes:()=>h.A,VOILUTFunctionType:()=>w.A,VideoEnums:()=>T,ViewportStatus:()=>A.A,ViewportType:()=>i.A});var o=n(11731),r=n(15453),i=n(21432),a=n(67342),s=n(16265);const{BlendMode:l}=s.Ay;var c;!function(e){e[e.COMPOSITE=0]="COMPOSITE",e[e.MAXIMUM_INTENSITY_BLEND=1]="MAXIMUM_INTENSITY_BLEND",e[e.MINIMUM_INTENSITY_BLEND=2]="MINIMUM_INTENSITY_BLEND",e[e.AVERAGE_INTENSITY_BLEND=3]="AVERAGE_INTENSITY_BLEND"}(c||(c={}));const u=c;var d,g=n(45919),h=n(38698);!function(e){e.CONTOUR="contour",e.SURFACE="Surface"}(d||(d={}));const f=d;var m;!function(e){e.CLOSED_PLANAR="CLOSED_PLANAR",e.OPEN_PLANAR="OPEN_PLANAR"}(m||(m={}));const p=m;var v,w=n(15381);!function(e){e.SUM="SUM",e.AVERAGE="AVERAGE",e.SUBTRACT="SUBTRACT"}(v||(v={}));var y;!function(e){e.NOT_APPLICABLE="",e.ERMF="ERMF",e.USER="User",e.PROJECTION="Proj",e.REGION="Region",e.ERROR="Error",e.UNCALIBRATED="Uncalibrated"}(y||(y={}));const I=y;var A=n(17702),E=n(89426),T=n(49465),S=n(29354)},29870:(e,t,n)=>{n.d(t,{Ay:()=>r,b1:()=>i,yj:()=>a,zb:()=>s});var o=n(49184);function r(e){if(!e)return;const{viewportUid:t,renderingEngineUid:n}=e.dataset;return i(t,n)}function i(e,t){if(!t||!e)return;const n=(0,o.Ay)(t);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(e);if(!r)return;const i=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:e,renderingEngineId:t,FrameOfReferenceUID:i}}function a(e){const t=(0,o.qO)();for(let n=0;n<t.length;n++){const o=t[n];if(o.getViewport(e))return i(e,o.id)}}function s(){const e=[];return(0,o.qO)().forEach((t=>{t.getViewports().forEach((({element:t})=>{e.push(r(t))}))})),e}},79220:(e,t,n)=>{n.r(t),n.d(t,{cancelLoadAll:()=>E,cancelLoadImage:()=>I,cancelLoadImages:()=>A,createAndCacheDerivedImage:()=>v,createAndCacheDerivedImages:()=>w,createAndCacheDerivedSegmentationImage:()=>D,createAndCacheDerivedSegmentationImages:()=>b,createAndCacheLocalImage:()=>y,loadAndCacheImage:()=>m,loadAndCacheImages:()=>p,loadImage:()=>f,registerImageLoader:()=>T,registerUnknownImageLoader:()=>S,unregisterAllImageLoaders:()=>x});var o=n(25534),r=n(13320),i=n(11731),a=n(51884),s=n(35678),l=n(775),c=n(92136);const u={};let d;function g(e,t){const n=e.indexOf(":"),o=e.substring(0,n),r=u[o];if(null==r){if(void 0!==d)return d(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}const l=r(e,t);return l.promise.then((function(e){(0,s.triggerEvent)(a.A,i.A.IMAGE_LOADED,{image:e})}),(function(t){const n={imageId:e,error:t};(0,s.triggerEvent)(a.A,i.A.IMAGE_LOAD_FAILED,n)})),l}function h(e,t){if(t.ignoreCache)return g(e,t);let n=o.A.getImageLoadObject(e);if(void 0!==n)return n;const i=o.A.getVolumeContainingImageId(e);if(i?.volume?.loadStatus?.loaded){const{volume:t,imageIdIndex:o}=i;return t instanceof r.QV&&(n=t.convertToCornerstoneImage(e,o)),n}const a=o.A.getCachedImageBasedOnImageURI(e);return a?(n=a.imageLoadObject,n):(n=g(e,t),n)}function f(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");return h(e,t).promise}function m(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=h(e,t);return o.A.getImageLoadObject(e)||o.A.putImageLoadObject(e,n).catch((e=>{console.warn(e)})),n.promise}function p(e,t={priority:0,requestType:"prefetch"}){if(!e||0===e.length)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return e.map((e=>m(e,t)))}function v(e,t={},n=!1){if(void 0===e)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");void 0===t.imageId&&(t.imageId=`derived:${(0,s.uuidv4)()}`);const{imageId:r,skipCreateBuffer:i,onCacheAdd:a}=t,l=c.metaData.get("imagePlaneModule",e),u=l.rows*l.columns,{TypedArrayConstructor:d}=(0,s.getBufferConfiguration)(t.targetBufferType,u),g=new d(i?1:u),h=r;["imagePixelModule","imagePlaneModule","generalSeriesModule"].forEach((t=>{s.genericMetadataProvider.add(h,{type:t,metadata:c.metaData.get(t,e)})}));const f=y({scalarData:g,onCacheAdd:a,skipCreateBuffer:i},r,!0),m={promise:Promise.resolve(f)};return n||o.A.putImageLoadObject(h,m),m.promise}function w(e,t={}){if(0===e?.length)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const n=[],o=e.map((e=>{const o={imageId:t.getDerivedImageId?.(e)||`derived:${(0,s.uuidv4)()}`,...t};return n.push(o.imageId),v(e,o)}));return{imageIds:n,promises:o}}function y(e,t,n=!1){const r=c.metaData.get("imagePlaneModule",t),i=r.rows*r.columns,a={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:!1,numComps:1,slope:1,minPixelValue:0,maxPixelValue:255,voiLUTFunction:void 0,rows:r.rows,columns:r.columns,getCanvas:void 0,height:r.rows,width:r.columns,rgba:void 0,columnPixelSpacing:r.columnPixelSpacing,rowPixelSpacing:r.rowPixelSpacing,invert:!1};if(e.scalarData){const t=e.scalarData;if(!(t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array||t instanceof Int16Array))throw new Error("To use createLocalVolume you should pass scalarData of type Uint8Array, Uint16Array, Int16Array or Float32Array");a.sizeInBytes=t.byteLength,a.getPixelData=()=>t}else if(!0!==e.skipCreateBuffer){const{numBytes:t,TypedArrayConstructor:n}=(0,s.getBufferConfiguration)(e.targetBufferType,i),o=new n(i);a.sizeInBytes=t,a.getPixelData=()=>o}e.onCacheAdd?.(a);const l={promise:Promise.resolve(a)};return n||o.A.putImageLoadObject(a.imageId,l),a}function I(e){l.A.filterRequests((({additionalDetails:t})=>!t.imageId||t.imageId!==e));const t=o.A.getImageLoadObject(e);t&&t.cancelFn()}function A(e){e.forEach((e=>I(e)))}function E(){const e=l.A.getRequestPool();Object.keys(e).forEach((t=>{const n=e[t];Object.keys(n).forEach((e=>{const t=n[e].pop().additionalDetails,{imageId:r,volumeId:i}=t;let a;r?a=o.A.getImageLoadObject(r):i&&(a=o.A.getVolumeLoadObject(i)),a&&a.cancel()})),l.A.clearRequestStack(t)}))}function T(e,t){u[e]=t}function S(e){const t=d;return d=e,t}function x(){Object.keys(u).forEach((e=>delete u[e])),d=void 0}function b(e,t={targetBufferType:"Uint8Array"}){return w(e,t)}function D(e,t={targetBufferType:"Uint8Array"}){return v(e,t)}},82041:(e,t,n)=>{n.r(t),n.d(t,{createAndCacheDerivedSegmentationVolume:()=>C,createAndCacheDerivedVolume:()=>A,createAndCacheVolume:()=>I,createAndCacheVolumeFromImages:()=>T,createLocalSegmentationVolume:()=>P,createLocalVolume:()=>E,getUnknownVolumeLoaderSchema:()=>D,getVolumeLoaderSchemes:()=>x,loadVolume:()=>y,registerUnknownVolumeLoader:()=>b,registerVolumeLoader:()=>S});n(3622);var o=n(51250),r=n(45128),i=n(77076),a=n(25534),s=n(11731),l=n(51884),c=n(13292),u=n(48463),d=n.n(u),g=n(35678),h=n(71702),f=n(51631);function m(e){const{dimensions:t,metadata:n,spacing:i,direction:a,origin:s}=e,{PhotometricInterpretation:l}=n;let c=1;"RGB"===l&&(c=3);const u=o.Ay.newInstance(),d={numberOfComponents:c};if(u.setDimensions(t),u.setSpacing(i),u.setDirection(a),u.setOrigin(s),e.isDynamicVolume()){!function(e,t,n){t.forEach(((t,o)=>{const i=r.Ay.newInstance({name:`timePoint-${o}`,values:t,...n});e.getPointData().addArray(i)})),e.getPointData().setActiveScalars("timePoint-0")}(u,e.getScalarDataArrays(),d)}else{!function(e,t,n){const o=r.Ay.newInstance({name:"Pixels",values:t,...n});e.getPointData().setScalars(o)}(u,e.getScalarData(),d)}return u}const p={};let v;function w(e,t){const n=e.indexOf(":"),o=e.substring(0,n);let r=p[o];if(null==r){if(null==v||"function"!=typeof v)throw new Error(`No volume loader for scheme ${o} has been registered`);r=v}const i=r(e,t);return(0,f.setupCacheOptimizationEventListener)(e),i.promise.then((function(e){(0,c.A)(l.A,s.A.VOLUME_LOADED,{volume:e})}),(function(t){const n={volumeId:e,error:t};(0,c.A)(l.A,s.A.VOLUME_LOADED_FAILED,n)})),i}function y(e,t={imageIds:[]}){if(void 0===e)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=a.A.getVolumeLoadObject(e);return void 0!==n?n.promise:(n=w(e,t),n.promise.then((e=>(e.imageData=m(e),e))))}async function I(e,t){if(void 0===e)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=a.A.getVolumeLoadObject(e);return void 0!==n||(n=w(e,t),n.promise.then((e=>{e.imageData=m(e)})),a.A.putVolumeLoadObject(e,n).catch((e=>{throw e}))),n.promise}async function A(e,t){const n=a.A.getVolume(e);if(!n)throw new Error(`Cannot created derived volume: Referenced volume with id ${e} does not exist.`);let{volumeId:s}=t;const{targetBuffer:l}=t;void 0===s&&(s=(0,g.uuidv4)());const{metadata:c,dimensions:u,spacing:h,origin:f,direction:m}=n,p=n.getScalarData().length,{volumeScalarData:v,numBytes:w}=_(l,p),y=r.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:v}),I=o.Ay.newInstance();I.setDimensions(u),I.setSpacing(h),I.setDirection(m),I.setOrigin(f),I.getPointData().setScalars(y);const A=new i.Q({volumeId:s,metadata:d()(c),dimensions:[u[0],u[1],u[2]],spacing:h,origin:f,direction:m,imageData:I,scalarData:v,sizeInBytes:w,imageIds:[],referencedVolumeId:e}),E={promise:Promise.resolve(A)};return await a.A.putVolumeLoadObject(s,E),A}function E(e,t,n=!1){const{metadata:l,dimensions:c,spacing:u,origin:h,direction:f,targetBuffer:m}=e;let{scalarData:p}=e;const v=["Uint8Array","Float32Array","Uint16Array","Int16Array"],w=c[0]*c[1]*c[2];if(!p||!v.includes(p.constructor.name)){if(!m?.type||!v.includes(m.type))throw new Error("createLocalVolume: parameter scalarData must be provided and must be either Uint8Array, Float32Array, Uint16Array or Int16Array");({volumeScalarData:p}=_(m,w))}void 0===t&&(t=(0,g.uuidv4)());const y=a.A.getVolume(t);if(y)return y;const I=p?p.buffer.byteLength:4*w;if(!a.A.isCacheable(I))throw new Error(s.A.CACHE_SIZE_EXCEEDED);const A=r.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:p}),E=o.Ay.newInstance();E.setDimensions(c),E.setSpacing(u),E.setDirection(f),E.setOrigin(h),E.getPointData().setScalars(A);const T=new i.Q({volumeId:t,metadata:d()(l),dimensions:[c[0],c[1],c[2]],spacing:u,origin:h,direction:f,imageData:E,scalarData:p,sizeInBytes:I,referencedImageIds:e.referencedImageIds||[],referencedVolumeId:e.referencedVolumeId,imageIds:e.imageIds||[]});if(n)return T;const S={promise:Promise.resolve(T)};return a.A.putVolumeLoadObject(t,S),T}async function T(e,t,n={}){const{preventCache:o=!1}=n;if(void 0===t)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(void 0===e)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const r=a.A.getVolume(e);if(r)return Promise.resolve(r);const s=(0,g.generateVolumePropsFromImageIds)(t,e),l=s.imageIds.map(((e,t)=>a.A.getImageLoadObject(e).promise.then((e=>{const n=e.getPixelData(),o=t*e.rows*e.columns;s.scalarData.set(n,o)}))));await Promise.all(l);const c=new i.Q({...s,referencedImageIds:t,...n});(0,f.performCacheOptimizationForVolume)(c);const u={promise:Promise.resolve(c)};return o||a.A.putVolumeLoadObject(e,u),u.promise}function S(e,t){p[e]=t}function x(){return Object.keys(p)}function b(e){const t=v;return v=e,t}function D(){return v.name}async function C(e,t={}){return A(e,{...t,targetBuffer:{type:"Uint8Array"}})}async function P(e,t,n=!1){return e.scalarData||(e.scalarData=new Uint8Array(e.dimensions[0]*e.dimensions[1]*e.dimensions[2])),E(e,t,n)}function _(e,t){const{useNorm16Texture:n}=(0,h.D0)().rendering,{TypedArrayConstructor:o,numBytes:r}=(0,g.getBufferConfiguration)(e?.type,t,{use16BitTexture:n,isVolumeBuffer:!0});if(!a.A.isCacheable(r))throw new Error(s.A.CACHE_SIZE_EXCEEDED);let i;if(e?.sharedArrayBuffer){i=new o(new SharedArrayBuffer(r))}else i=new o(t);return{volumeScalarData:i,numBytes:r}}},55692:(e,t,n)=>{n.r(t),n.d(t,{addProvider:()=>r,get:()=>s,removeAllProviders:()=>a,removeProvider:()=>i});const o=[];function r(e,t=0){let n;for(n=0;n<o.length&&!(o[n].priority<=t);n++);o.splice(n,0,{priority:t,provider:e})}function i(e){for(let t=0;t<o.length;t++)if(o[t].provider===e){o.splice(t,1);break}}function a(){for(;o.length>0;)o.pop()}function s(e,...t){for(let n=0;n<o.length;n++){const r=o[n].provider(e,...t);if(void 0!==r)return r}}},775:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(79927),r=n(15453);const i=new o.R("imageLoadPool");i.grabDelay=0,i.setMaxSimultaneousRequests(r.A.Interaction,1e3),i.setMaxSimultaneousRequests(r.A.Thumbnail,1e3),i.setMaxSimultaneousRequests(r.A.Prefetch,1e3);const a=i},79927:(e,t,n)=>{n.d(t,{R:()=>i});var o=n(15453),r=n(35678);class i{constructor(e){this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.id=e||(0,r.uuidv4)(),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]},compute:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5,compute:1e3}}setMaxSimultaneousRequests(e,t){this.maxNumRequests[e]=t}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,t,n,o=0){const r={requestFn:e,type:t,additionalDetails:n};void 0===this.requestPool[t][o]&&(this.requestPool[t][o]=[]),this.requestPool[t][o].push(r),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach((t=>{const n=this.requestPool[t];Object.keys(n).forEach((t=>{n[t]=n[t].filter((t=>e(t)))}))}))}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const t=this.maxNumRequests[e]-this.numRequests[e];let n=0;for(let o=0;o<t;o++){const t=this.getNextRequest(e);if(null===t)return!1;if(t){let o;this.numRequests[e]++,this.awake=!0;try{o=t.requestFn()}catch(e){console.warn("sendRequest failed",e)}o?.finally?o.finally((()=>{this.numRequests[e]--,this.startAgain()})):(this.numRequests[e]--,n++)}}return n&&this.startAgain(),!0}getNextRequest(e){const t=this.getSortedPriorityGroups(e);for(const n of t)if(this.requestPool[e][n].length)return this.requestPool[e][n].shift();return null}startGrabbing(){const e=this.sendRequests(o.A.Interaction),t=this.sendRequests(o.A.Thumbnail),n=this.sendRequests(o.A.Prefetch),r=this.sendRequests(o.A.Compute);e||t||n||r||(this.awake=!1)}startAgain(){this.awake&&(void 0!==this.grabDelay?this.timeoutHandle||(this.timeoutHandle=window.setTimeout((()=>{this.timeoutHandle=null,this.startGrabbing()}),this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter((t=>this.requestPool[e][t].length)).sort(((e,t)=>e-t))}getRequestPool(){return this.requestPool}}},13292:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(51884);function r(e=o.A,t,n=null){if(!t)throw new Error("Event type was not defined");const r=new CustomEvent(t,{detail:n,cancelable:!0});return e.dispatchEvent(r)}},61874:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(99178),r=n(50002),i=n(79927);const a=class{constructor(){this.workerRegistry={},this.workerPoolManager=new i.R("webworker")}registerWorker(e,t,n={}){const{maxWorkerInstances:r=1,overwrite:i=!1,autoTerminateOnIdle:a={enabled:!1,idleTimeThreshold:3e3}}=n;if(this.workerRegistry[e]&&!i)return void console.warn(`Worker type '${e}' is already registered...`);i&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:a.enabled,idleCheckIntervalId:null,idleTimeThreshold:a.idleTimeThreshold};s.loadCounters=Array(r).fill(0),s.lastActiveTime=Array(r).fill(null);for(let e=0;e<r;e++){const e=t();s.instances.push(o.LV(e)),s.nativeWorkers.push(e),s.workerFn=t}this.workerRegistry[e]=s}getNextWorkerAPI(e){const t=this.workerRegistry[e];if(!t)return console.error(`Worker type '${e}' is not registered.`),null;const n=t.instances.filter((e=>null!==e));let r=0,i=t.loadCounters[0]||0;for(let e=1;e<n.length;e++){const n=t.loadCounters[e]||0;n<i&&(r=e,i=n)}if(null===t.instances[r]){const e=t.workerFn();t.instances[r]=o.LV(e),t.nativeWorkers[r]=e}return t.loadCounters[r]+=1,{api:t.instances[r],index:r}}executeTask(e,t,n={},{requestType:i=r.RequestType.Compute,priority:a=0,options:s={},callbacks:l=[]}={}){return new Promise(((r,c)=>{this.workerPoolManager.addRequest((async()=>{const{api:i,index:a}=this.getNextWorkerAPI(e);if(!i){const t=new Error(`No available worker instance for '${e}'`);return console.error(t),void c(t)}try{let s=[];l.length&&(s=l.map((e=>o.BX(e))));const c=this.workerRegistry[e];c.processing=!0;const u=await i[t](n,...s);c.processing=!1,c.lastActiveTime[a]=Date.now(),c.autoTerminateOnIdle&&!c.idleCheckIntervalId&&c.idleTimeThreshold&&(c.idleCheckIntervalId=setInterval((()=>{this.terminateIdleWorkers(e,c.idleTimeThreshold)}),c.idleTimeThreshold)),r(u)}catch(n){console.error(`Error executing method '${t}' on worker '${e}':`,n),c(n)}finally{this.workerRegistry[e].loadCounters[a]--}}),i,s,a)}))}terminateIdleWorkers(e,t){const n=this.workerRegistry[e];if(n.processing)return;const o=Date.now();n.instances.forEach(((r,i)=>{const a=n.lastActiveTime[i];!(null!==a&&n.loadCounters[i]>0)&&o-a>t&&this.terminateWorkerInstance(e,i)}))}terminate(e){const t=this.workerRegistry[e];t?t.instances.forEach(((t,n)=>{this.terminateWorkerInstance(e,n)})):console.error(`Worker type '${e}' is not registered.`)}terminateWorkerInstance(e,t){const n=this.workerRegistry[e],r=n.instances[t];null!==r&&(r[o.A2](),n.nativeWorkers[t].terminate(),n.instances[t]=null,n.lastActiveTime[t]=null)}}},39371:(e,t,n)=>{n.d(t,{segmentation:()=>o});n(35373),n(61738),n(55965),n(42375),n(2746),n(74119),n(32916),n(40969),n(45238);var o=n(63421);n(81848),n(65043),n(84901)},35837:(e,t,n)=>{n.d(t,{getState:()=>o.A});var o=n(70692);n(80456),n(31862)},45238:(e,t,n)=>{n.d(t,{state:()=>o});n(35837),n(48428),n(42351);var o=n(38296);n(21009),n(22581),n(16122)},50720:(e,t,n)=>{var o=n(44753),r=n(92136),i=n(24592),a=n(74119),s=n(96214),l=n(21090),c=n(38296),u=n(48428),d=n(21009),g=n(54177),h=n(2746),f=n(61738),m=n(84901),p=n(90252),v=n(21954),w=n(10910),y=n(40233),I=n(23072);const{transformWorldToIndex:A}=r.utilities;class E extends s.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:T}}){super(e,t),this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{points:l}=s.handles;let c=a.worldToCanvas(l[0]),u=a.worldToCanvas(l[1]),d={start:{x:c[0],y:c[1]},end:{x:u[0],y:u[1]}},g=v.distanceToPoint([d.start.x,d.start.y],[d.end.x,d.end.y],[n[0],n[1]]);return g<=o||(c=a.worldToCanvas(l[2]),u=a.worldToCanvas(l[3]),d={start:{x:c[0],y:c[1]},end:{x:u[0],y:u[1]}},g=v.distanceToPoint([d.start.x,d.start.y],[d.end.x,d.end.y],[n[0],n[1]]),g<=o)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},this._activateModify(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,I.A)(s,i),(0,y.hideElementCursor)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,a=t.data;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex((e=>e===n));const c=(0,p.getViewportIdsWithToolToRender)(i,this.getToolName());(0,y.hideElementCursor)(i),this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(i);const u=(0,r.getEnabledElement)(i),{renderingEngine:d}=u;(0,I.A)(d,c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:u}=i;if(s&&!l)return;u.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,y.resetElementCursor)(n);const{renderingEngine:d}=(0,r.getEnabledElement)(n);if(void 0!==this.editData.handleIndex){const{points:e}=u.handles,t=o.eR.distance(e[0],e[1]);if(o.eR.distance(e[2],e[3])>t){const t=[[...e[2]],[...e[3]]],n=[...e[0]],r=[...e[1]],i=o.Zc.create();o.Zc.set(i,t[1][0]-t[0][0],t[1][1]-t[1][0]);const a=o.Zc.create();o.Zc.set(a,-i[1],i[0]);const s=o.Zc.create();let l;o.Zc.set(s,r[0]-n[0],r[1]-n[0]),l=o.Zc.dot(s,a)>0?[n,r]:[r,n],u.handles.points=[t[0],t[1],l[0],l[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,c.removeAnnotation)(i.annotationUID),(0,I.A)(d,a),s&&(0,g.dZ)(i),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:i}=t,a=(0,r.getEnabledElement)(i),{renderingEngine:s,viewport:l}=a,{worldToCanvas:c}=l,{annotation:u,viewportIdsToRender:d,handleIndex:g}=this.editData,{data:h}=u,f=n.world;h.handles.points[g]=[...f];const m=h.handles.points.map(c),p={start:{x:m[0][0],y:m[0][1]},end:{x:m[1][0],y:m[1][1]}},v=(m[2][0],m[2][1],m[3][0],m[3][1],o.Zc.distance(m[0],m[1])/3),w=p.start.x-p.end.x,y=p.start.y-p.end.y,A=Math.sqrt(w*w+y*y),E=w/A,T=y/A,S=(p.start.x+p.end.x)/2,x=(p.start.y+p.end.y)/2,b=S+v*T,D=x-v*E,C=S-v*T,P=x+v*E;h.handles.points[2]=l.canvasToWorld([b,D]),h.handles.points[3]=l.canvasToWorld([C,P]),u.invalidated=!0,(0,I.A)(s,d),this.editData.hasMoved=!0},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,o=(0,r.getEnabledElement)(n),{renderingEngine:i}=o,{annotation:a,viewportIdsToRender:s,handleIndex:l,movingTextBox:c}=this.editData,{data:u}=a;if(c){const{deltaPoints:e}=t,n=e.world,{textBox:o}=u.handles,{worldPosition:r}=o;r[0]+=n[0],r[1]+=n[1],r[2]+=n[2],o.hasMoved=!0}else if(void 0===l){const{deltaPoints:e}=t,n=e.world;u.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),a.invalidated=!0}else this._dragModifyHandle(e),a.invalidated=!0;(0,I.A)(i,s)},this._dragModifyHandle=e=>{const t=e.detail,{currentPoints:n,element:i}=t,a=(0,r.getEnabledElement)(i),{viewport:s}=a,{annotation:l,handleIndex:c}=this.editData,{data:u}=l,d=n.world,g=[s.worldToCanvas(u.handles.points[0]),s.worldToCanvas(u.handles.points[1]),s.worldToCanvas(u.handles.points[2]),s.worldToCanvas(u.handles.points[3])],h={start:{x:g[0][0],y:g[0][1]},end:{x:g[1][0],y:g[1][1]}},f={start:{x:g[2][0],y:g[2][1]},end:{x:g[3][0],y:g[3][1]}},m=[...d],p=s.worldToCanvas(m);if(0===c||1===c){const e=g[0===c?1:0],t=o.Zc.set(o.Zc.create(),p[0]-e[0],p[1]-e[1]),n=o.Zc.set(o.Zc.create(),g[c][0]-e[0],g[c][1]-e[1]);o.Zc.normalize(t,t),o.Zc.normalize(n,n);const r={start:{x:e[0],y:e[1]},end:{x:p[0],y:p[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(r,f))return;const i=e,a=this._getSignedAngle(n,t);let l=g[2][0],d=g[2][1],h=g[3][0],v=g[3][1];l-=i[0],d-=i[1],h-=i[0],v-=i[1];const w=l*Math.cos(a)-d*Math.sin(a),y=l*Math.sin(a)+d*Math.cos(a),I=h*Math.cos(a)-v*Math.sin(a),A=h*Math.sin(a)+v*Math.cos(a);l=w+i[0],d=y+i[1],h=I+i[0],v=A+i[1];const E=s.canvasToWorld([l,d]),T=s.canvasToWorld([h,v]);u.handles.points[c]=m,u.handles.points[2]=E,u.handles.points[3]=T}else{const e=2===c?3:2,t={longLineSegment:{start:h.start,end:h.end},shortLineSegment:{start:f.start,end:f.end}},n=o.Zc.subtract(o.Zc.create(),[t.longLineSegment.end.x,t.longLineSegment.end.y],[t.longLineSegment.start.x,t.longLineSegment.start.y]),r=o.Zc.normalize(o.Zc.create(),n),i=o.Zc.subtract(o.Zc.create(),[p[0],p[1]],[g[c][0],g[c][1]]),a=o.Zc.length(i),l=this._getSignedAngle(r,i),d=Math.cos(l)*a,w=o.Zc.scaleAndAdd(o.Zc.create(),[g[e][0],g[e][1]],r,d);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:p[0],y:p[1]},end:{x:w[0],y:w[1]}},{start:{x:t.longLineSegment.start.x,y:t.longLineSegment.start.y},end:{x:t.longLineSegment.end.x,y:t.longLineSegment.end.y}}))return;if(!v.intersectLine([p[0],p[1]],[w[0],w[1]],[h.start.x,h.start.y],[h.end.x,h.end.y]))return;u.handles.points[e]=s.canvasToWorld(w),u.handles.points[c]=m}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,y.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;t.highlighted=!1,i.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,r.getEnabledElement)(e);return(0,I.A)(a,n),o&&(0,g.dZ)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{f.wk.isInteractingWithTool=!0,e.addEventListener(m.Events.MOUSE_UP,this._endCallback),e.addEventListener(m.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(m.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(m.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(m.Events.TOUCH_TAP,this._endCallback),e.addEventListener(m.Events.TOUCH_END,this._endCallback),e.addEventListener(m.Events.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=e=>{f.wk.isInteractingWithTool=!1,e.removeEventListener(m.Events.MOUSE_UP,this._endCallback),e.removeEventListener(m.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(m.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(m.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(m.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(m.Events.TOUCH_END,this._endCallback),e.removeEventListener(m.Events.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=e=>{f.wk.isInteractingWithTool=!0,e.addEventListener(m.Events.MOUSE_UP,this._endCallback),e.addEventListener(m.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(m.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(m.Events.TOUCH_END,this._endCallback),e.addEventListener(m.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(m.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{f.wk.isInteractingWithTool=!1,e.removeEventListener(m.Events.MOUSE_UP,this._endCallback),e.removeEventListener(m.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(m.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(m.Events.TOUCH_END,this._endCallback),e.removeEventListener(m.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(m.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!0;const{viewport:o}=e,{element:r}=o;let i=(0,c.getAnnotations)(this.getToolName(),r);if(!i?.length)return n;if(i=this.filterInteractableAnnotationsForElement(r,i),!i?.length)return n;const a=this.getTargetId(o),s=o.getRenderingEngine(),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<i.length;r++){const c=i[r],{annotationUID:g,data:f}=c,{points:m,activeHandleIndex:p}=f.handles,v=m.map((e=>o.worldToCanvas(e)));l.annotationUID=g;const{color:y,lineWidth:I,lineDash:A,shadow:E}=this.getAnnotationStyle({annotation:c,styleSpecifier:l});if(f.cachedStats[a]&&null!=f.cachedStats[a].unit?c.invalidated&&this._throttledCalculateCachedStats(c,s,e):(f.cachedStats[a]={length:null,width:null,unit:null},this._calculateCachedStats(c,s,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let T;if(!(0,d.isAnnotationVisible)(g))continue;if((0,u.isAnnotationLocked)(c)||this.editData||null===p||(T=[v[p]]),T){const e="0";(0,h.drawHandles)(t,g,e,T,{color:y})}const S=`${g}-line-1`,x=`${g}-line-2`,b="0";(0,h.drawLine)(t,g,b,v[0],v[1],{color:y,lineDash:A,lineWidth:I,shadow:E},S);const D="1";(0,h.drawLine)(t,g,D,v[2],v[3],{color:y,lineDash:A,lineWidth:I,shadow:E},x),n=!0;const C=this.getLinkedTextBoxStyle(l,c);if(!C.visibility){f.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const P=this.configuration.getTextLines(f,a);if(!P||0===P.length)continue;let _;f.handles.textBox.hasMoved||(_=(0,w.getTextBoxCoordsCanvas)(v),f.handles.textBox.worldPosition=o.canvasToWorld(_));const R=o.worldToCanvas(f.handles.textBox.worldPosition),M="1",O=(0,h.drawLinkedTextBox)(t,g,M,P,R,v,{},C),{x:L,y:k,width:N,height:V}=O;f.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([L,k]),topRight:o.canvasToWorld([L+N,k]),bottomLeft:o.canvasToWorld([L,k+V]),bottomRight:o.canvasToWorld([L+N,k+V])}}return n},this._movingLongAxisWouldPutItThroughShortAxis=(e,t)=>{const n=o.Zc.create();o.Zc.set(n,t.end.x-t.start.x,t.end.y-t.start.y),o.Zc.normalize(n,n);const r={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!v.intersectLine([r.start.x,r.start.y],[r.end.x,r.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])},this._calculateCachedStats=(e,t,n)=>{const{data:o}=e,{element:r}=n.viewport,a=o.handles.points[0],s=o.handles.points[1],l=o.handles.points[2],c=o.handles.points[3],{cachedStats:u}=o,d=Object.keys(u);for(let e=0;e<d.length;e++){const n=d[e],o=this.getTargetIdImage(n,t);if(!o)continue;const{imageData:r,dimensions:g}=o,h=A(r,a),f=A(r,s),m=A(r,l),p=A(r,c),v=[h,f],w=[m,p],{scale:y,units:I}=(0,i.Op)(o,v),{scale:E,units:T}=(0,i.Op)(o,w),S=this._calculateLength(a,s)/y,x=this._calculateLength(l,c)/E,b=S>x?S:x,D=S>x?x:S,C=S>x?I:T,P=S>x?T:I;this._isInsideVolume(h,f,m,p,g)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,u[n]={length:b,width:D,unit:I,lengthUnit:C,widthUnit:P}}return e.invalidated=!1,(0,g.XF)(e,r),u},this._isInsideVolume=(e,t,n,o,i)=>r.utilities.indexWithinDimensions(e,i)&&r.utilities.indexWithinDimensions(t,i)&&r.utilities.indexWithinDimensions(n,i)&&r.utilities.indexWithinDimensions(o,i),this._getSignedAngle=(e,t)=>Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1]),this._throttledCalculateCachedStats=(0,l.A)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:s,renderingEngine:l}=a;this.isDrawing=!0;const u=s.getCamera(),{viewPlaneNormal:d,viewUp:g}=u,h=this.getReferencedImageId(s,i,d,g),f=s.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...g],FrameOfReferenceUID:f,referencedImageId:h},data:{handles:{points:[[...i],[...i],[...i],[...i]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};(0,c.addAnnotation)(m,o);const v=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,y.hideElementCursor)(o),e.preventDefault(),(0,I.A)(l,v),m}_calculateLength(e,t){const n=e[0]-t[0],o=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+o*o+r*r)}}function T(e,t){const{cachedStats:n,label:o}=e,{length:r,width:i,unit:s,lengthUnit:l,widthUnit:c}=n[t],u=[];return o&&u.push(o),void 0===r||u.push(`L: ${(0,a.roundNumber)(r)} ${l||s}`,`W: ${(0,a.roundNumber)(i)} ${c||s}`),u}E.toolName="Bidirectional"},52454:(e,t,n)=>{n.d(t,{A:()=>d});var o=n(92136),r=n(44753),i=n(28062),a=n(48428),s=n(21009),l=n(38296),c=n(54177);class u extends i.A{constructor(e,t){super(e,t),this.mouseMoveCallback=(e,t)=>{if(!t)return!1;const{element:n,currentPoints:o}=e.detail,r=o.canvas;let i=!1;for(const e of t){if((0,a.isAnnotationLocked)(e)||!(0,s.isAnnotationVisible)(e.annotationUID))continue;const{data:t}=e,o=t.handles?t.handles.activeHandleIndex:void 0,l=this._imagePointNearToolOrHandle(n,e,r,6),c=l&&!e.highlighted,u=!l&&e.highlighted;c||u?(e.highlighted=!e.highlighted,i=!0):t.handles&&t.handles.activeHandleIndex!==o&&(i=!0)}return i},e.configuration?.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),e.configuration?.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}static createAnnotation(...e){let t={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(const n of e)t=o.utilities.deepMerge(t,n);return t}static createAnnotationForViewport(e,...t){return this.createAnnotation({metadata:e.getViewReference()},...t)}static createAndAddAnnotation(e,...t){const n=this.createAnnotationForViewport(e,...t);(0,l.addAnnotation)(n,e.element),(0,c.XF)(n,e.element)}getHandleNearImagePoint(e,t,n,i){const a=(0,o.getEnabledElement)(e),{viewport:s}=a,{data:l}=t,{isCanvasAnnotation:c}=l,{points:u,textBox:d}=l.handles;if(d){const{worldBoundingBox:e}=d;if(e){const t={topLeft:s.worldToCanvas(e.topLeft),topRight:s.worldToCanvas(e.topRight),bottomLeft:s.worldToCanvas(e.bottomLeft),bottomRight:s.worldToCanvas(e.bottomRight)};if(n[0]>=t.topLeft[0]&&n[0]<=t.bottomRight[0]&&n[1]>=t.topLeft[1]&&n[1]<=t.bottomRight[1])return l.handles.activeHandleIndex=null,d}}for(let e=0;e<u?.length;e++){const t=u[e],o=c?t.slice(0,2):s.worldToCanvas(t);if(!0===r.Zc.distance(n,o)<i)return l.handles.activeHandleIndex=e,t}l.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,t){return{visibility:this.getStyle("textBoxVisibility",e,t),fontFamily:this.getStyle("textBoxFontFamily",e,t),fontSize:this.getStyle("textBoxFontSize",e,t),color:this.getStyle("textBoxColor",e,t),shadow:this.getStyle("textBoxShadow",e,t),background:this.getStyle("textBoxBackground",e,t),lineWidth:this.getStyle("textBoxLinkLineWidth",e,t),lineDash:this.getStyle("textBoxLinkLineDash",e,t)}}isSuvScaled(e,t,n){if(e instanceof o.BaseVolumeViewport){const e=o.utilities.getVolumeId(t),n=o.cache.getVolume(e);return void 0!==n.scaling?.PT}const r=n&&o.metaData.get("scalingModule",n);return"number"==typeof r?.suvbw}getAnnotationStyle(e){const{annotation:t,styleSpecifier:n}=e,o=e=>this.getStyle(e,n,t),{annotationUID:r}=t,i=(0,s.isAnnotationVisible)(r),l=(0,a.isAnnotationLocked)(t),c=o("lineWidth"),u=o("lineDash"),d=o("color");return{visibility:i,locked:l,color:d,lineWidth:c,lineDash:u,lineOpacity:1,fillColor:d,fillOpacity:0,shadow:o("shadow"),textbox:this.getLinkedTextBoxStyle(n,t)}}_imagePointNearToolOrHandle(e,t,n,o){if(this.getHandleNearImagePoint(e,t,n,o))return!0;return!!this.isPointNearTool(e,t,n,o,"mouse")||void 0}}u.toolName="AnnotationTool";const d=u},44350:(e,t,n)=>{n.d(t,{A:()=>r});const o={renderOutline:!0,outlineWidthActive:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.7,fillAlphaInactive:.65,outlineOpacity:1,outlineOpacityInactive:.85};const r=function(){return o}},81848:(e,t,n)=>{n.d(t,{M$:()=>r.A,EC:()=>o.EC,PlanarFreehandContourSegmentationTool:()=>s.A,ex:()=>a.A,t0:()=>l.A});var o=n(96214),r=(n(25294),n(15924),n(455),n(20132),n(15354),n(57008),n(20842),n(94574),n(57424),n(91976),n(93970),n(73168)),i=(n(54541),n(87841),n(70494),n(1143),n(92807),n(50720),n(72655),n(30049),n(28087),n(19994)),a=(n(19116),n(42865),n(42058),n(67540),n(39244)),s=n(20070),l=(n(19904),n(88854),n(65314),n(1368),n(40310),n(95608),n(72799),n(7336),n(31163)),c=(n(81502),n(34229),n(55108),n(92136)),u=n(95778),d=n(48428),g=n(2746),h=n(90252),f=n(40233),m=n(23072),p=n(21009),v=n(54177);class w extends i.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,r=n.world,i=(0,c.getEnabledElement)(o),{viewport:a,renderingEngine:s}=i;this.isDrawing=!0;const l=a.getCamera(),{viewPlaneNormal:d,viewUp:g}=l,p=this.getTargetId(a);let v,w;if(a instanceof c.StackViewport)v=p.split("imageId:")[1];else{w=c.utilities.getVolumeId(p);const e=c.cache.getVolume(w);v=c.utilities.getClosestImageId(e,r,d)}const y=a.getFrameOfReferenceUID(),I={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...d],enabledElement:i,viewUp:[...g],FrameOfReferenceUID:y,referencedImageId:v,toolName:this.getToolName(),volumeId:w},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...r],[...r],[...r],[...r]],activeHandleIndex:null},segmentationId:null}};(0,u.lC)(I,o);const A=(0,h.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:I,viewportIdsToRender:A,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,f.hideElementCursor)(o),e.preventDefault(),(0,m.A)(s,A),I},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:r}=o;let i=(0,u.Rh)(this.getToolName(),r);if(!i?.length)return n;if(i=this.filterInteractableAnnotationsForElement(r,i),!i?.length)return n;const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<i.length;e++){const s=i[e],{annotationUID:l,data:c}=s,{points:u,activeHandleIndex:h}=c.handles,f=u.map((e=>o.worldToCanvas(e)));a.annotationUID=l;const m=this.getStyle("lineWidth",a,s),w=this.getStyle("lineDash",a,s),y=this.getStyle("color",a,s);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let I;if((0,v.XF)(s,r),!(0,p.isAnnotationVisible)(l))continue;if((0,d.isAnnotationLocked)(s)||this.editData||null===h||(I=[f[h]]),I){const e="0";(0,g.drawHandles)(t,l,e,I,{color:y})}const A="0";(0,g.drawRect)(t,l,A,f[0],f[3],{color:y,lineDash:w,lineWidth:m}),n=!0}return n}}}w.toolName="RectangleROIThreshold";var y=n(44753),I=n(21090),A=n(74119);const{transformWorldToIndex:E}=c.utilities;class T extends i.A{constructor(e={},t={configuration:{numSlicesToPropagate:10,computePointsInsideVolume:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,r=n.world,i=(0,c.getEnabledElement)(o),{viewport:a,renderingEngine:s}=i;this.isDrawing=!0;const l=a.getCamera(),{viewPlaneNormal:d,viewUp:g}=l;let p,v,w;if(a instanceof c.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(a);w=c.utilities.getVolumeId(e),v=c.cache.getVolume(w),p=c.utilities.getClosestImageId(v,r,d)}if(!p)throw new Error("This tool does not work on non-acquisition planes");const y=a.getCurrentImageIdIndex(),I=c.utilities.getSpacingInNormalDirection(v,d),A=this._getEndSliceIndex(v,r,I,d),E=a.getFrameOfReferenceUID(),T={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...d],enabledElement:i,viewUp:[...g],FrameOfReferenceUID:E,referencedImageId:p,toolName:this.getToolName(),volumeId:w,spacingInNormal:I},data:{label:"",startSlice:y,endSlice:A,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[p]},handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...r],[...r],[...r],[...r]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(T,v),(0,u.lC)(T,o);const S=(0,h.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:T,viewportIdsToRender:S,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,f.hideElementCursor)(o),e.preventDefault(),(0,m.A)(s,S),T},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:r,newAnnotation:i,hasMoved:a}=this.editData,{data:s}=o;if(i&&!a)return;s.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,f.resetElementCursor)(n);const l=(0,c.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,u.O8)(o.annotationUID);const d=this.getTargetId(l.viewport),g=c.cache.getVolume(d.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(o,g,l),(0,m.A)(l.renderingEngine,r),i&&(0,v.dZ)(o)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,r=(0,u.Rh)(this.getToolName(),o.element);if(!r?.length)return n;const i=o.getCurrentImageIdIndex(),a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let s=0;s<r.length;s++){const l=r[s],{annotationUID:c,data:u}=l,{startSlice:h,endSlice:f}=u,{points:m,activeHandleIndex:v}=u.handles,w=m.map((e=>o.worldToCanvas(e)));a.annotationUID=c;const y=this.getStyle("lineWidth",a,l),I=this.getStyle("lineDash",a,l),A=this.getStyle("color",a,l);if(i<Math.min(h,f)||i>Math.max(h,f))continue;l.invalidated&&this._throttledCalculateCachedStats(l,e);let E,T=!1;if(i!==h&&i!==f||(T=!0),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,p.isAnnotationVisible)(c))continue;if((0,d.isAnnotationLocked)(l)||this.editData||null===v||!T||(E=[w[v]]),E){const e="0";(0,g.drawHandles)(t,c,e,E,{color:A})}let S=I;T||(S=2);const x="0";(0,g.drawRect)(t,c,x,w[0],w[3],{color:A,lineDash:S,lineWidth:y}),n=!0}return n},this._throttledCalculateCachedStats=(0,I.A)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:o}=e,{viewPlaneNormal:r,spacingInNormal:i}=o,{imageData:a}=t,{startSlice:s,endSlice:l}=n,{points:u}=n.handles,d=E(a,u[0]);if(d[2]!==s)throw new Error("Start slice does not match");const g=y.eR.fromValues(d[0],d[1],l),h=y.eR.create();a.indexToWorldVec3(d,h);const f=y.eR.create();a.indexToWorldVec3(g,f);const m=y.eR.distance(h,f),p=[];for(let e=0;e<m;e+=i)p.push(u.map((t=>{const n=y.eR.create();return y.eR.scaleAndAdd(n,t,r,e),Array.from(n)})));n.cachedStats.projectionPoints=p;const v=[];for(const e of p){const n=c.utilities.getClosestImageId(t,e[0],r);v.push(n)}n.cachedStats.projectionPointsImageIds=v}_computePointsInsideVolume(e,t,n){const{data:o}=e,r=o.cachedStats.projectionPoints,i=[[]];for(let e=0;e<r.length;e++){if(!t)continue;const n=r[e][0],a=o.handles.points[0],s=o.handles.points[3],{dimensions:l,imageData:c}=t,u=E(c,a),d=E(c,n);u[0]=Math.floor(u[0]),u[1]=Math.floor(u[1]),u[2]=Math.floor(d[2]);const g=E(c,s);if(g[0]=Math.floor(g[0]),g[1]=Math.floor(g[1]),g[2]=Math.floor(d[2]),this._isInsideVolume(u,g,l)){this.isHandleOutsideImage=!1;const e=[[Math.min(u[0],g[0]),Math.max(u[0],g[0])],[Math.min(u[1],g[1]),Math.max(u[1],g[1])],[Math.min(u[2],g[2]),Math.max(u[2],g[2])]],t=(0,A.pointInShapeCallback)(c,(()=>!0),null,e);i.push(t)}}o.cachedStats.pointsInVolume=i}_calculateCachedStatsTool(e,t){const n=e.data,{viewport:o}=t,{cachedStats:r}=n,i=this.getTargetId(o),a=c.cache.getVolume(i.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,a),e.invalidated=!1,(0,v.XF)(e,o.element),r}_getEndSliceIndex(e,t,n,o){const r=this.configuration.numSlicesToPropagate,i=y.eR.create();y.eR.scaleAndAdd(i,t,o,r*n);const a=n/2,{imageIds:s}=e;let l;for(let e=0;e<s.length;e++){const t=s[e],{imagePositionPatient:n}=c.metaData.get("imagePlaneModule",t),r=y.eR.create();y.eR.sub(r,i,n);const u=y.eR.dot(r,o);Math.abs(u)<a&&(l=e)}return l}}T.toolName="RectangleROIStartEndThreshold";n(94932),n(53712),n(70817),n(36129),n(34041)},41209:(e,t,n)=>{var o=n(92136),r=n(28117);class i{static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}static imageIdToFrames(e){const t=e.match(this.frameRangeExtractor);if(!t||!t[2])return null;const n=t[2].split("-").map((e=>Number(e)));return 1===n.length?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,t){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const o=this.framesToString(t);return e.replace(this.frameRangeExtractor,`${n[1]}${o}`)}static setFrameRange(e,t,n){const{referencedImageId:i}=e.metadata;e.metadata.referencedImageId=this.framesToImageId(i,t);const a={...n,annotation:e};(0,o.triggerEvent)(o.eventTarget,r.A.ANNOTATION_MODIFIED,a)}static getFrameRange(e){return this.imageIdToFrames(e.metadata.referencedImageId)}}},42290:()=>{},14471:(e,t,n)=>{n.d(t,{C:()=>s,g:()=>a});var o=n(92136);const{EPSILON:r}=o.CONSTANTS;function i(e,t,n=!1){let o=1/0,i=n?-1/0:0,a=1/0,s=n?-1/0:0,l=1/0,c=n?-1/0:0;const u=3===e[0]?.length;for(let t=0;t<e.length;t++){const n=e[t];o=Math.min(n[0],o),i=Math.max(n[0],i),a=Math.min(n[1],a),s=Math.max(n[1],s),u&&(l=Math.min(n[2]??l,l),c=Math.max(n[2]??c,c))}return t?(o=Math.max(n?t[0]+r:0,o),i=Math.min(n?t[0]-r:t[0]-1,i),a=Math.max(n?t[1]+r:0,a),s=Math.min(n?t[1]-r:t[1]-1,s),u&&3===t.length&&(l=Math.max(n?t[2]+r:0,l),c=Math.min(n?t[2]-r:t[2]-1,c))):n||(o=Math.max(0,o),i=Math.min(1/0,i),a=Math.max(0,a),s=Math.min(1/0,s),u&&(l=Math.max(0,l),c=Math.min(1/0,c))),u?[[o,i],[a,s],[l,c]]:[[o,i],[a,s],null]}function a(e,t){return i(e,t,!1)}function s(e,t){return i(e,t,!0)}},15306:(e,t,n)=>{n.d(t,{getBoundingBoxAroundShapeIJK:()=>o.g,getBoundingBoxAroundShapeWorld:()=>o.C});n(42290);var o=n(14471)},17167:(e,t,n)=>{var o=n(92136);const{calibratedPixelSpacingMetadataProvider:r}=o.utilities},60001:(e,t,n)=>{n(44753);var o,r=n(92136);!function(e){e.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",e.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED"}(o||(o={}));n(21783);const{ViewportStatus:i}=r.Enums,{triggerEvent:a}=r.utilities;new Map},88484:(e,t,n)=>{},32415:(e,t,n)=>{n.d(t,{V:()=>r});var o=n(30322);function r(e){if(e.parentAnnotationUID)return;if(!e.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:t,segmentIndex:n}=e.data.segmentation,r=(0,o.getSegmentation)(t);r.representationData.CONTOUR||(r.representationData.CONTOUR={annotationUIDsMap:new Map});const{annotationUIDsMap:i}=r.representationData.CONTOUR;let a=i.get(n);a||(a=new Set,i.set(n,a)),i.set(n,a.add(e.annotationUID))}},3030:(e,t,n)=>{},7259:(e,t,n)=>{n.d(t,{addContourSegmentationAnnotation:()=>o.V,removeContourSegmentationAnnotation:()=>r.M});n(3030),n(84354);var o=n(32415),r=n(78170)},84354:(e,t,n)=>{},78170:(e,t,n)=>{n.d(t,{M:()=>r});var o=n(63421);function r(e){if(!e.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:t,segmentIndex:n}=e.data.segmentation,r=o.state.getSegmentation(t),{annotationUIDsMap:i}=r?.representationData.CONTOUR||{},a=i?.get(n);a&&(a.delete(e.annotationUID),a.size||i.delete(n))}},93712:(e,t,n)=>{var o=n(69405);class r{constructor(){}static{this.TOOL_NAMES={}}static convert(e,t,n){!function(e){if(!e?.data)throw new Error("Tool data is empty");if(!e.metadata||e.metadata.referenceImageId)throw new Error("Tool data is not associated with any imageId")}(e);const{toolName:o}=e.metadata,i=r.TOOL_NAMES[o];if(!i)throw new Error(`Unknown tool type: ${o}, cannot convert to RTSSReport`);const a=i.getContourSequence(e,n);return{ReferencedROINumber:t+1,ROIDisplayColor:[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],ContourSequence:a}}static register(e){r.TOOL_NAMES[e.toolName]=e}}r.register(o.A)},14633:(e,t,n)=>{n(44753)},53891:(e,t,n)=>{n.d(t,{A:()=>o});const o=function(e,t){let n=0;for(let t=0;t<e.length-1;t++){const o=e[t],r=e[t+1];n+=Math.sqrt(Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2))}if(t){const t=e[0],o=e[e.length-1];n+=Math.sqrt(Math.pow(o[0]-t[0],2)+Math.pow(o[1]-t[1],2))}return n}},11716:(e,t,n)=>{},92806:(e,t,n)=>{},84045:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(92136),r=n(44753);const{isEqual:i}=o.utilities;function a(e,t){const{polyline:n}=e.data.contour,{points:o}=e.data.handles,{length:a}=o;if(t===a)return n.length;if(t<0&&(t=(t+a)%a),0===t)return 0;const s=o[t],l=n.findIndex((e=>i(s,e)));if(-1!==l)return l;let c=1/0;return n.reduce(((e,t,n)=>{const o=r.eR.squaredDistance(t,s);return o<c?(c=o,n):e}),-1)}},36392:(e,t,n)=>{n(92136),n(52754),n(45128),n(51250),n(75534),n(11716);var o=n(83946);const{Labelmap:r}=o.A},88267:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(98043);function r(e,t){const n=(0,o.A)(e),r=[];return n.forEach((e=>{const n=e.length,o=new Array(n);for(let r=0;r<n;r++)o[r]=t.worldToCanvas(e[r]);r.push(o)})),r}},98043:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(95778);function r(e){return(e.childAnnotationUIDs??[]).map((e=>(0,o.gw)(e).data.contour.polyline))}},19866:(e,t,n)=>{},75534:(e,t,n)=>{n.d(t,{getContourHolesDataCanvas:()=>o.A,updateContourPolyline:()=>r.A});n(14633),n(11716),n(19866),n(92806),n(36392),n(93712),n(98043);var o=n(88267),r=n(89111);n(65864),n(69115),n(84045),n(53891)},65864:(e,t,n)=>{n(33836)},69115:(e,t,n)=>{n.d(t,{InterpolationManager:()=>o.A});var o=n(33836)},89111:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(92136),r=n(73047),i=n(95778);function a(e,t,n,a){const{canvasToWorld:s}=n,{data:l}=e,{targetWindingDirection:c}=t;let{points:u}=t;a?.decimate?.enabled&&(u=r.polyline.decimate(t.points,a?.decimate?.epsilon));let{closed:d}=t;const g=u.length,h=new Array(g),f=r.polyline.getWindingDirection(u),m=(0,i.Ay)(e);if(void 0===d){let e=!1;if(u.length>3){const t=r.point.distanceToPointSquared(u[0],u[g-1]);e=o.utilities.isEqual(0,t)}d=e}let p=m?-1*m.data.contour.windingDirection:c;void 0===p?p=f:p!==f&&u.reverse();for(let e=0;e<g;e++)h[e]=s(u[e]);l.contour.polyline=h,l.contour.closed=d,l.contour.windingDirection=p,(0,i.zH)(e)}},64857:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(11857);const r=function(e,t,n){let r,i,a,s,l,c,u=0,d=!1,g=!1,h=!0;const f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){const n=r,o=i;return r=i=void 0,u=t,s=e.apply(o,n),s}function p(e,t){return f?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){const n=e-c;return void 0===c||n>=t||n<0||g&&e-u>=a}function w(){const e=Date.now();if(v(e))return y(e);l=p(w,function(e){const n=e-u,o=t-(e-c);return g?Math.min(o,a-n):o}(e))}function y(e){return l=void 0,h&&r?m(e):(r=i=void 0,s)}function I(...e){const n=Date.now(),o=v(n);if(r=e,i=this,c=n,o){if(void 0===l)return function(e){return u=e,l=p(w,t),d?m(e):s}(c);if(g)return l=p(w,t),m(c)}return void 0===l&&(l=p(w,t)),s}return t=Number(t)||0,(0,o.A)(n)&&(d=Boolean(n.leading),g="maxWait"in n,a=g?Math.max(Number(n.maxWait)||0,t):a,h="trailing"in n?Boolean(n.trailing):h),I.cancel=function(){void 0!==l&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),u=0,r=c=i=l=void 0},I.flush=function(){return void 0===l?s:y(Date.now())},I.pending=function(){return void 0!==l},I}},10910:(e,t,n)=>{function o(e){const t=function(e){const t=[e[0],e[1]].sort(a),n=[e[0],e[1]].sort(s),o=t[t.length-1],r=n[0],i=n[n.length-1];return{top:r,bottom:i,right:o};function a(e,t){return e[0]<t[0]?-1:1}function s(e,t){return e[1]<t[1]?-1:1}}(e),n=(t.top[1]+t.bottom[1])/2;return[t.right[0],n]}n.d(t,{getTextBoxCoordsCanvas:()=>o})},16390:(e,t,n)=>{n(92136),n(77071),n(75403)},66429:(e,t,n)=>{n(92136),n(38296),n(52610)},24592:(e,t,n)=>{n.d(t,{CQ:()=>h,Op:()=>d,Xw:()=>g});var o=n(92136);const{CalibrationTypes:r}=o.Enums,i="px",a=[1],s=["3,3"],l=["4,3"],c={3:"cm",4:"seconds"},u="²",d=(e,t)=>{const{calibration:n,hasPixelSpacing:l}=e;let c=l?"mm":i,d=c+u,g=1,h="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{units:c,areaUnits:d,scale:g};if(n.type===r.UNCALIBRATED)return{units:i,areaUnits:i+u,scale:g};if(n.sequenceOfUltrasoundRegions){let e,r;if(Array.isArray(t)&&2===t.length)[e,r]=t;else if("function"==typeof t){const n=t();e=n[0],r=n[1]}let l=n.sequenceOfUltrasoundRegions.filter((t=>e[0]>=t.regionLocationMinX0&&e[0]<=t.regionLocationMaxX1&&e[1]>=t.regionLocationMinY0&&e[1]<=t.regionLocationMaxY1&&r[0]>=t.regionLocationMinX0&&r[0]<=t.regionLocationMaxX1&&r[1]>=t.regionLocationMinY0&&r[1]<=t.regionLocationMaxY1));if(!l?.length)return{units:c,areaUnits:d,scale:g};if(l=l.filter((e=>a.includes(e.regionDataType)&&s.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`))),!l.length)return{units:i,areaUnits:i+u,scale:g};const f=l[0],m=Math.abs(f.physicalDeltaX),p=Math.abs(f.physicalDeltaY);if(!o.utilities.isEqual(m,p,.001))return{units:i,areaUnits:i+u,scale:g};g=1/(10*m),h="US Region",c="mm",d="mm²"}else n.scale&&(g=n.scale);return[r.ERMF,r.USER,r.ERROR,r.PROJECTION].includes(n?.type)&&(h=n.type),{units:c+(h?` ${h}`:""),areaUnits:d+(h?` ${h}`:""),scale:g}},g=(e,t)=>{const[n]=t,{calibration:o}=e;let r=["raw"],i=[null],s="";if(!o||!o.type&&!o.sequenceOfUltrasoundRegions)return{units:r,values:i};if(o.sequenceOfUltrasoundRegions){const e=o.sequenceOfUltrasoundRegions.filter((e=>a.includes(e.regionDataType)&&l.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`)));if(!e?.length)return{units:r,values:i};const t=e.find((e=>n[0]>=e.regionLocationMinX0&&n[0]<=e.regionLocationMaxX1&&n[1]>=e.regionLocationMinY0&&n[1]<=e.regionLocationMaxY1));if(!t)return{units:r,values:i};const{referencePixelX0:u=0,referencePixelY0:d=0}=t,{physicalDeltaX:g,physicalDeltaY:h}=t,f=(n[1]-t.regionLocationMinY0-d)*h;s="US Region",i=[(n[0]-t.regionLocationMinX0-u)*g,f],r=[c[t.physicalUnitsXDirection],c[t.physicalUnitsYDirection]]}return{units:r,values:i,calibrationType:s}},h=e=>e.calibration?.aspect||1},96760:(e,t,n)=>{n.d(t,{R:()=>s});var o=n(92136),r=n(44753),i=n(15306);const{transformWorldToIndex:a}=o.utilities;function s(e,t,n){const[o,s]=e,l=r.eR.fromValues((o[0]+s[0])/2,(o[1]+s[1])/2,(o[2]+s[2])/2),c=r.eR.distance(o,s)/2;if(!n)throw new Error("viewport is required in order to calculate the sphere bounds");const{boundsIJK:u,topLeftWorld:d,bottomRightWorld:g}=function(e,t,n,o,s){const[l,c]=n,u=e.getDimensions(),d=t.getCamera(),g=r.eR.fromValues(d.viewUp[0],d.viewUp[1],d.viewUp[2]),h=r.eR.fromValues(d.viewPlaneNormal[0],d.viewPlaneNormal[1],d.viewPlaneNormal[2]),f=r.eR.create();r.eR.cross(f,g,h);const m=r.eR.create(),p=r.eR.create();r.eR.scaleAndAdd(m,c,h,s),r.eR.scaleAndAdd(p,l,h,-s),r.eR.scaleAndAdd(m,m,f,-s),r.eR.scaleAndAdd(p,p,f,s);const v=a(e,m),w=a(e,p),y=n.map((t=>a(e,t))),I=(0,i.getBoundingBoxAroundShapeIJK)([v,w,...y],u);return{boundsIJK:I,topLeftWorld:m,bottomRightWorld:p}}(t,n,e,0,c);return{boundsIJK:u,centerWorld:l,radiusWorld:c,topLeftWorld:d,bottomRightWorld:g}}},39490:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(65903);function r(e){const t=(0,o.A)(e);return t.length?t[0]:void 0}},74119:(e,t,n)=>{n.d(t,{debounce:()=>r.A,getCalibratedLengthUnitsAndScale:()=>a.Op,math:()=>g,pointInShapeCallback:()=>c.A,pointToString:()=>d.l,polyDataUtils:()=>h,roundNumber:()=>f,scroll:()=>u.A,throttle:()=>i.A,triggerAnnotationRenderForToolGroupIds:()=>l.A,triggerAnnotationRenderForViewportIds:()=>s.A});var o=n(92136),r=(n(66429),n(64857)),i=n(21090),a=(n(11857),n(88484),n(17167),n(24592)),s=n(23072),l=n(27819),c=(n(6805),n(11666),n(75403)),u=(n(96760),n(21783)),d=n(60438),g=(n(41209),n(5093),n(39490),n(75534),n(10351),n(10910),n(73047)),h=(n(84797),n(90252),n(80393),n(39365),n(60001),n(15306),n(44074),n(15874),n(90387),n(31555),n(54868),n(16390),n(46514));n(10413),n(7259);const f=o.utilities.roundNumber},11857:(e,t,n)=>{n.d(t,{A:()=>o});const o=function(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}},27924:(e,t,n)=>{function o(e,t){return e.minX<=t.maxX&&e.maxX>=t.minX&&e.minY<=t.maxY&&e.maxY>=t.minY}function r(e,t){const n=e.maxX-e.minX,o=e.maxY-e.minY,r=[n,o],i=[e.minX+n/2,e.minY+o/2],a=[Math.abs(t[0]-i[0]),Math.abs(t[1]-i[1])],s=a[0]-.5*r[0],l=a[1]-.5*r[1];if(s>0&&l>0)return s*s+l*l;const c=Math.max(s,0)+Math.max(l,0);return c*c}function i(e,t){return Math.sqrt(r(e,t))}n.r(t),n.d(t,{distanceToPoint:()=>i,distanceToPointSquared:()=>r,intersectAABB:()=>o})},83112:(e,t,n)=>{n.d(t,{BasicStatsCalculator:()=>r});const o=class{};class r extends o{static{this.max=[-1/0]}static{this.sum=[0]}static{this.sumSquares=[0]}static{this.squaredDiffSum=[0]}static{this.count=0}static{this.statsCallback=({value:e})=>{Array.isArray(e)&&e.length>1&&1===this.max.length&&(this.max.push(this.max[0],this.max[0]),this.sum.push(this.sum[0],this.sum[0]),this.sumSquares.push(this.sumSquares[0],this.sumSquares[0]),this.squaredDiffSum.push(this.squaredDiffSum[0],this.squaredDiffSum[0]));const t=Array.isArray(e)?e:[e];this.count+=1,this.max.forEach(((e,n)=>this.max[n]=Math.max(e,t[n]))),this.sum.map(((e,n)=>this.sum[n]+=t[n])),this.sumSquares.map(((e,n)=>this.sumSquares[n]+=t[n]**2)),this.squaredDiffSum.map(((e,n)=>this.squaredDiffSum[n]+=Math.pow(t[n]-this.sum[n]/this.count,2)))}}static{this.getStatistics=()=>{const e=this.sum.map((e=>e/this.count)),t=this.squaredDiffSum.map((e=>Math.sqrt(e/this.count))),n=this.sumSquares.map(((t,n)=>Math.sqrt(this.sumSquares[n]/this.count-e[n]**2))),o={max:{name:"max",label:"Max Pixel",value:i(this.max),unit:null},mean:{name:"mean",label:"Mean Pixel",value:i(e),unit:null},stdDev:{name:"stdDev",label:"Standard Deviation",value:i(t),unit:null},stdDevWithSumSquare:{name:"stdDevWithSumSquare",value:i(n),unit:null},count:{name:"count",label:"Pixel Count",value:this.count,unit:null},array:[]};return o.array.push(o.max,o.mean,o.stdDev,o.stdDevWithSumSquare,o.count),this.max=[-1/0],this.sum=[0],this.sumSquares=[0],this.squaredDiffSum=[0],this.count=0,o}}}function i(e){return 1===e.length?e[0]:e}},2264:(e,t,n)=>{function o(e,t,n={}){return n.precalculated||r(e,n),n.precalculated(t)}n.d(t,{getCanvasEllipseCorners:()=>i,pointInEllipse:()=>o,precalculatePointInEllipse:()=>r});const r=(e,t={})=>{const{xRadius:n,yRadius:o,zRadius:r}=e;void 0!==t.invXRadiusSq&&void 0!==t.invYRadiusSq&&void 0!==t.invZRadiusSq||(t.invXRadiusSq=0!==n?1/n**2:0,t.invYRadiusSq=0!==o?1/o**2:0,t.invZRadiusSq=0!==r?1/r**2:0);const{invXRadiusSq:i,invYRadiusSq:a,invZRadiusSq:s}=t,{center:l}=e,[c,u,d]=l;return t.precalculated=e=>{const t=e[0]-c;let n=t*t*i;if(n>1)return!1;const o=e[1]-u;if(n+=o*o*a,n>1)return!1;const r=e[2]-d;return n+=r*r*s,n<=1},t};function i(e){const[t,n,o,r]=e;return[[o[0],n[1]],[r[0],t[1]]]}},73047:(e,t,n)=>{n.d(t,{aabb:()=>o,lineSegment:()=>r,point:()=>i,polyline:()=>a});var o=n(27924),r=(n(83112),n(2264),n(21954)),i=n(14846),a=n(56634);n(23345),n(73100)},21954:(e,t,n)=>{n.r(t),n.d(t,{distanceToPoint:()=>a,distanceToPointSquared:()=>i,distanceToPointSquaredInfo:()=>r,intersectLine:()=>l,isPointOnLineSegment:()=>u});var o=n(73047);function r(e,t,n){let r;const i=o.point.distanceToPointSquared(e,t);if(e[0]===t[0]&&e[1]===t[1]&&(r=e),!r){const o=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/i;r=o<0?e:o>1?t:[e[0]+o*(t[0]-e[0]),e[1]+o*(t[1]-e[1])]}return{point:[...r],distanceSquared:o.point.distanceToPointSquared(n,r)}}function i(e,t,n){return r(e,t,n).distanceSquared}function a(e,t,n){if(2!==e.length||2!==t.length||2!==n.length)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(i(e,t,n))}function s(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}function l(e,t,n,o){const[r,i]=e,[a,l]=t,[c,u]=n,[d,g]=o,h=l-i,f=r-a,m=a*i-r*l,p=h*c+f*u+m,v=h*d+f*g+m;if(0!==p&&0!==v&&s(p)===s(v))return;const w=g-u,y=c-d,I=d*u-c*g,A=w*r+y*i+I,E=w*a+y*l+I;if(0!==A&&0!==E&&s(A)===s(E))return;const T=h*y-w*f;let S;S=f*I-y*m;const x=S/T;S=w*m-h*I;return[x,S/T]}const c=.01;function u(e,t,n){const o=e[0]<=t[0]?e[0]:t[0],r=e[0]>=t[0]?e[0]:t[0],i=e[1]<=t[1]?e[1]:t[1],a=e[1]>=t[1]?e[1]:t[1];if(!(n[0]>=o-c&&n[0]<=r+c&&n[1]>=i-c&&n[1]<=a+c))return!1;const s=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return(s>=0?s:-s)<=c}},38566:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(14257);function r(e,t){return Math.sqrt((0,o.A)(e,t))}},14257:(e,t,n)=>{function o(e,t){if(e.length!==t.length)throw Error("Both points should have the same dimensionality");const[n,o,r=0]=e,[i,a,s=0]=t,l=i-n,c=a-o,u=s-r;return l*l+c*c+u*u}n.d(t,{A:()=>o})},49131:(e,t,n)=>{function o(e,t){const[n,o]=e,[r,i]=t;return[2*r-n,2*i-o]}n.d(t,{A:()=>o})},56634:(e,t,n)=>{n.r(t),n.d(t,{addCanvasPointsToArray:()=>B,containsPoint:()=>a,containsPoints:()=>s,decimate:()=>O,getAABB:()=>l.A,getArea:()=>c,getClosestLineSegmentIntersection:()=>k,getFirstLineSegmentIntersectionIndexes:()=>_,getLineSegmentIntersectionsCoordinates:()=>L,getLineSegmentIntersectionsIndexes:()=>w,getNormal2:()=>h,getNormal3:()=>g,getSignedArea:()=>u,getSubPixelSpacingAndXYDirections:()=>U,getWindingDirection:()=>d,intersectPolyline:()=>R,isClosed:()=>i,isPointInsidePolyline3D:()=>H,mergePolylines:()=>C,pointCanProjectOnLine:()=>F,pointsAreWithinCloseContourProximity:()=>W,projectTo2D:()=>j,subtractPolylines:()=>P});var o=n(44753),r=n(73047);function i(e){if(e.length<3)return!1;const t=e.length,n=e[0],i=e[t-1],a=r.point.distanceToPointSquared(n,i);return o.Fd.equals(0,a)}function a(e,t,n={closed:void 0}){if(e.length<3)return!1;const o=e.length;let r=0;const{closed:s,holes:l}=n;if(l?.length)for(const e of l)if(a(e,t))return!1;const c=!(void 0===s?i(e):s),u=e.length-(c?1:2);for(let n=0;n<=u;n++){const i=e[n],a=e[n===o-1?0:n+1],s=i[0]>=a[0]?i[0]:a[0],l=i[1]>=a[1]?i[1]:a[1],c=i[1]<=a[1]?i[1]:a[1];if(t[0]<=s&&t[1]>=c&&t[1]<l){let e=i[0]===a[0];if(!e){const n=(t[1]-i[1])*(a[0]-i[0])/(a[1]-i[1])+i[0];e=t[0]<=n}r+=e?1:0}}return!!(r%2)}function s(e,t){for(let n=0,o=t.length;n<o;n++)if(!a(e,t[n]))return!1;return!0}var l=n(86970);function c(e){const t=e.length;let n=0,o=t-1;for(let r=0;r<t;r++)n+=(e[o][0]+e[r][0])*(e[o][1]-e[r][1]),o=r;return Math.abs(n/2)}function u(e){if(e.length<3)return 0;const t=e[0];let n=0;for(let o=0,r=e.length;o<r;o++){const i=e[o],a=e[o===r-1?0:o+1],s=i[0]-t[0],l=i[1]-t[1],c=a[0]-t[0];n+=s*(a[1]-t[1])-l*c}return n*=.5,n}function d(e){return u(e)>=0?1:-1}function g(e){const t=function(e){const t=o.eR.create(),n=e[0];for(let o=0,r=e.length;o<r;o++){const i=e[o],a=e[o===r-1?0:o+1],s=i[0]-n[0],l=i[1]-n[1],c=i[2]-n[2],u=a[0]-n[0],d=a[1]-n[1],g=a[2]-n[2];t[0]+=l*g-c*d,t[1]+=c*u-s*g,t[2]+=s*d-l*u}return o.eR.scale(t,t,.5),t}(e);return o.eR.normalize(t,t)}function h(e){const t=u(e);return[0,0,t/Math.abs(t)]}var f=n(14846);function m(e,t,n,o){let r=!1;const i=e[0]<t[0]?e[0]:t[0],a=e[1]<t[1]?e[1]:t[1],s=e[0]>t[0]?e[0]:t[0],l=e[1]>t[1]?e[1]:t[1],c=n[0]<o[0]?n[0]:o[0],u=n[1]<o[1]?n[1]:o[1],d=n[0]>o[0]?n[0]:o[0],g=n[1]>o[1]?n[1]:o[1];if(i>d||s<c||a>g||l<u)return!1;const h=[p(e,t,n),p(e,t,o),p(n,o,e),p(n,o,t)];return h[0]!==h[1]&&h[2]!==h[3]||((0===h[0]&&v(e,n,t)||0===h[1]&&v(e,o,t)||0===h[2]&&v(n,e,o)||0===h[3]&&v(n,t,o))&&(r=!0),r)}function p(e,t,n){const o=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===o?0:o>0?1:2}function v(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])}function w(e,t,n,o=!0){const r=[],i=e.length,a=i-(o?1:2);for(let o=0;o<=a;o++){const a=o===i-1?0:o+1;m(t,n,e[o],e[a])&&r.push([o,a])}return r}var y=n(21954);const I=.01;function A(e,t,n,o){const r=[t[0]-e[0],t[1]-e[1]],i=[o[0]-n[0],o[1]-n[1]],a=i[1]*r[0]-i[0]*r[1];if((a>=0?a:-a)<I){const r=[e[0]<t[0]?e[0]:t[0],e[0]>t[0]?e[0]:t[0],e[1]<t[1]?e[1]:t[1],e[1]>t[1]?e[1]:t[1]],i=[n[0]<o[0]?n[0]:o[0],n[0]>o[0]?n[0]:o[0],n[1]<o[1]?n[1]:o[1],n[1]>o[1]?n[1]:o[1]];if(!(r[0]<=i[1]&&r[1]>=i[0]&&r[2]<=i[3]&&r[3]>=i[2]))return;if(!(y.isPointOnLineSegment(e,t,n)||y.isPointOnLineSegment(e,t,o)||y.isPointOnLineSegment(n,o,e)))return;return[.5*((r[0]>i[0]?r[0]:i[0])+(r[1]<i[1]?r[1]:i[1])),.5*((r[2]>i[2]?r[2]:i[2])+(r[3]<i[3]?r[3]:i[3]))]}let s=e[1]-n[1],l=e[0]-n[0];const c=r[0]*s-r[1]*l;s=(i[0]*s-i[1]*l)/a,l=c/a;return[e[0]+s*r[0],e[1]+s*r[1]]}var E,T,S;function x(e){for(let t=0,n=e.length;t<n;t++){const o=e[t];o.next||(o.next=e[t===n-1?0:t+1])}}function b(e,t){const n=[],o=[],r=new Map;let i=a(t,e[0])?S.Exiting:S.Entering;for(let o=0,s=e.length;o<s;o++){const l=e[o],c=a(t,l),u={type:E.Vertex,coordinates:l,position:c?T.Inside:T.Outside,visited:!1,next:null};n.push(u);const d=e[o===s-1?0:o+1],g=w(t,l,d).map((e=>{const n=e[0],o=t[e[0]],r=t[e[1]],i=A(l,d,o,r);return{sourceLineSegmentId:n,coordinate:i,targetStartPointDistSquared:f.distanceToPointSquared(l,i)}}));g.sort(((e,t)=>e.targetStartPointDistSquared-t.targetStartPointDistSquared)),g.forEach((e=>{const{sourceLineSegmentId:t,coordinate:o}=e,a={type:E.Intersection,coordinates:o,position:T.Edge,direction:i,visited:!1,next:null},s={...a,direction:S.Unknown,cloned:!0};i===S.Entering?a.next=s:s.next=a;let l=r.get(t);l||(l=[],r.set(t,l)),n.push(a),l.push(s),i*=-1}))}for(let e=0,n=t.length;e<n;e++){const n=e,i=t[e],a={type:E.Vertex,coordinates:i,visited:!1,next:null};o.push(a);const s=r.get(n);s?.length&&s.map((e=>({intersectionPoint:e,lineSegStartDistSquared:f.distanceToPointSquared(i,e.coordinates)}))).sort(((e,t)=>e.lineSegStartDistSquared-t.lineSegStartDistSquared)).map((({intersectionPoint:e})=>e)).forEach((e=>o.push(e)))}return x(n),x(o),{targetPolylinePoints:n,sourcePolylinePoints:o}}function D(e){for(let t=0,n=e.length;t<n;t++){const n=e[t];if(!n.visited&&n.position===T.Outside)return n}}function C(e,t){const n=h(e),r=h(t),i=o.eR.dot(r,n);o.Fd.equals(1,i)||(t=t.slice().reverse());const{targetPolylinePoints:a}=b(e,t),s=D(a);if(!s)return e.slice();const l=[s.coordinates];let c=s.next;for(;c!==s;)c.type===E.Intersection&&c.cloned||l.push(c.coordinates),c=c.next;return l}function P(e,t){const n=h(e),r=h(t),i=o.eR.dot(r,n);o.Fd.equals(-1,i)||(t=t.slice().reverse());const{targetPolylinePoints:a}=b(e,t);let s=null;const l=[];for(;s=D(a);){const e=[s.coordinates];let t=s.next;for(s.visited=!0;t!==s;)t.visited=!0,t.type===E.Intersection&&t.cloned||e.push(t.coordinates),t=t.next;l.push(e)}return l}function _(e,t,n,o=!0){let r,i;o?(i=e.length-1,r=0):(i=0,r=1);for(let o=r;o<e.length;o++){if(m(t,n,e[i],e[o]))return[i,o];i=o}}function R(e,t){for(let n=0,o=e.length;n<o;n++){const r=_(t,e[n],e[n===o-1?0:n+1]);if(2===r?.length)return!0}return!1}!function(e){e[e.Vertex=0]="Vertex",e[e.Intersection=1]="Intersection"}(E||(E={})),function(e){e[e.Outside=-1]="Outside",e[e.Edge=0]="Edge",e[e.Inside=1]="Inside"}(T||(T={})),function(e){e[e.Exiting=-1]="Exiting",e[e.Unknown=0]="Unknown",e[e.Entering=1]="Entering"}(S||(S={}));const M=.1;function O(e,t=M){const n=e.length;if(n<3)return e;const o=t*t,r=[[0,n-1]],i=new Array(n).fill(!1);let a=2;for(i[0]=!0,i[n-1]=!0;r.length;){const[t,n]=r.pop();if(n-t==1)continue;const s=e[t],l=e[n];let c=-1/0,u=-1;for(let o=t+1;o<n;o++){const t=e[o],n=y.distanceToPointSquared(s,l,t);n>c&&(c=n,u=o)}c<o||(i[u]=!0,a++,r.push([u,n]),r.push([t,u]))}const s=new Array(a);for(let t=0,o=0;t<n;t++)i[t]&&(s[o++]=e[t]);return s}function L(e,t,n,o=!0){const r=[],i=w(e,t,n,o);for(let o=0;o<i.length;o++){const a=A(t,n,e[i[o][0]],e[i[o][1]]);r.push(a)}return r}function k(e,t,n,r=!0){let i,a;r?(a=e.length-1,i=0):(a=0,i=1);const s=[];for(let o=i;o<e.length;o++){const r=e[a],i=e[o];m(t,n,r,i)&&s.push([a,o]),a=o}if(0===s.length)return;const l=[];s.forEach((n=>{const r=[e[n[0]],e[n[1]]],i=[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2];l.push(o.Zc.distance(i,t))}));const c=Math.min(...l);return{segment:s[l.indexOf(c)],distance:c}}var N=n(92136);const V=.001,U=(e,t)=>{let n,r,i;if(e instanceof N.StackViewport){const t=e.getImageData();r=t.direction.slice(0,3),i=t.direction.slice(3,6),n=t.spacing}else{const t=e.getImageData(),{direction:a,spacing:s}=t,{viewPlaneNormal:l,viewUp:c}=e.getCamera(),u=a.slice(0,3),d=a.slice(3,6),g=a.slice(6,9),h=o.eR.create();o.eR.cross(h,c,l);const f=Math.abs(o.eR.dot(h,u)),m=Math.abs(o.eR.dot(h,d)),p=Math.abs(o.eR.dot(h,g));let v;if(Math.abs(1-f)<V)v=s[0],r=u;else if(Math.abs(1-m)<V)v=s[1],r=d;else{if(!(Math.abs(1-p)<V))throw new Error("No support yet for oblique plane planar contours");v=s[2],r=g}const w=Math.abs(o.eR.dot(c,u)),y=Math.abs(o.eR.dot(c,d)),I=Math.abs(o.eR.dot(c,g));let A;if(Math.abs(1-w)<V)A=s[0],i=u;else if(Math.abs(1-y)<V)A=s[1],i=d;else{if(!(Math.abs(1-I)<V))throw new Error("No support yet for oblique plane planar contours");A=s[2],i=g}n=[v,A]}return{spacing:[n[0]/t,n[1]/t],xDir:r,yDir:i}},W=(e,t,n)=>o.Zc.dist(e,t)<n,B=(e,t,n,r)=>{const{xDir:i,yDir:a,spacing:s}=r,l=(0,N.getEnabledElement)(e),{viewport:c}=l;if(!t.length)return t.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const u=c.canvasToWorld(t[t.length-1]),d=c.canvasToWorld(n),g=o.eR.create();o.eR.subtract(g,d,u);const h=Math.abs(o.eR.dot(g,i)),f=Math.abs(o.eR.dot(g,a)),m=Math.max(Math.floor(h/s[0]),Math.floor(f/s[0]));if(m>1){const e=t[t.length-1],r=o.Zc.dist(e,n),i=o.Zc.create();o.Zc.subtract(i,n,e),o.Zc.set(i,i[0]/r,i[1]/r);const a=r/m;for(let n=1;n<=m;n++)t.push([e[0]+a*i[0]*n,e[1]+a*i[1]*n])}else t.push(n);return m},F=(e,t,n,r)=>{const i=[e[0]-t[0],e[1]-t[1]],a=[n[0]-t[0],n[1]-t[1]],s=i[0]*a[0]+i[1]*a[1];if(s<0)return!1;const l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===l)return!1;const c=s/l,u=[a[0]/l,a[1]/l],d=[u[0]*c,u[1]*c],g=[t[0]+d[0],t[1]+d[1]];return!(o.Zc.distance(e,g)>r)&&!(o.Zc.distance(t,g)>o.Zc.distance(t,n))},q=1e-6;function j(e){let t;const n=N.utilities.getRandomSampleFromArray(e,50);for(let e=0;e<3;e++)if(n.every(((t,n,o)=>Math.abs(t[e]-o[0][e])<q))){t=e;break}if(void 0===t)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const o=[],r=(t+1)%3,i=(t+2)%3;for(let t=0;t<e.length;t++)o.push([e[t][r],e[t][i]]);return{sharedDimensionIndex:t,projectedPolyline:o}}function H(e,t,n={}){const{sharedDimensionIndex:o,projectedPolyline:r}=j(t),{holes:i}=n,s=[];if(i)for(let e=0;e<i.length;e++){const t=i[e],n=[];for(let e=0;e<t.length;e++)n.push([t[e][(o+1)%3],t[e][(o+2)%3]]);s.push(n)}return a(r,[e[(o+1)%3],e[(o+2)%3]],{holes:s})}},23345:(e,t,n)=>{n.d(t,{distanceToPoint:()=>r});var o=n(21954);function r(e,t){if(4!==e.length||2!==t.length)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[n,r,i,a]=e;let s=655535;const l=function(e,t,n,o){return{top:[[e,t],[e+n,t]],right:[[e+n,t],[e+n,t+o]],bottom:[[e+n,t+o],[e,t+o]],left:[[e,t+o],[e,t]]}}(n,r,i,a);return Object.keys(l).forEach((e=>{const[n,r]=l[e],i=o.distanceToPoint(n,r,t);i<s&&(s=i)})),s}},19096:(e,t,n)=>{function o(e,t){const{center:n,radius:o}=e,r=e.radius2||o*o;return(t[0]-n[0])*(t[0]-n[0])+(t[1]-n[1])*(t[1]-n[1])+(t[2]-n[2])*(t[2]-n[2])<=r}n.d(t,{d:()=>o})},73100:(e,t,n)=>{n(87658),n(86981)},86981:(e,t,n)=>{n.d(t,{A:()=>s});const o=1e-6,r=1,i=0;function a(e,t,n){const[r,i]=n;if(Math.abs(t)<o)return e<0;const a=e/t;if(t>0){if(a>i)return 0;a>r&&(n[0]=a)}else{if(a<r)return 0;a<i&&(n[1]=a)}return 1}function s(e,t,n,s,l){const[c,u]=e,[d,g]=t,h=d-c,f=g-u;if(void 0===s||void 0===l?(s=e,l=t):(s[0]=e[0],s[1]=e[1],l[0]=t[0],l[1]=t[1]),Math.abs(h)<o&&Math.abs(f)<o&&c>=n[0]&&c<=n[2]&&u>=n[1]&&u<=n[3])return r;const m=[0,1];if(a(n[0]-c,h,m)&&a(c-n[2],-h,m)&&a(n[1]-u,f,m)&&a(u-n[3],-f,m)){const[e,t]=m;return t<1&&(l[0]=c+t*h,l[1]=u+t*f),e>0&&(s[0]+=e*h,s[1]+=e*f),r}return i}},80393:(e,t,n)=>{},39365:(e,t,n)=>{},84797:(e,t,n)=>{n.d(t,{filterAnnotationsForDisplay:()=>i.A,getPointInLineOfSightWithCriteria:()=>a.A,isPlaneIntersectingAABB:()=>s.Y});var o=n(17926),r=n(78609),i=n(65826),a=n(3895),s=n(99706);o.A,r.A,i.A,a.A,s.Y},44074:(e,t,n)=>{n(14659).A},75403:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(44753);function r(e,t,n,r){let i,a,s,l,c,u,d;const{numComps:g}=e;d=e.getScalarData?e.getScalarData():e.getPointData().getScalars().getData();const h=e.getDimensions();r?[[i,a],[s,l],[c,u]]=r:(i=0,a=h[0],s=0,l=h[1],c=0,u=h[2]);const f=o.eR.fromValues(i,s,c),m=e.getDirection(),p=m.slice(0,3),v=m.slice(3,6),w=m.slice(6,9),y=e.getSpacing(),[I,A,E]=y,T=e.indexToWorld(f),S=o.eR.fromValues(p[0]*I,p[1]*I,p[2]*I),x=o.eR.fromValues(v[0]*A,v[1]*A,v[2]*A),b=o.eR.fromValues(w[0]*E,w[1]*E,w[2]*E),D=g||d.length/h[2]/h[1]/h[0],C=h[0]*D,P=h[1]*C,_=[],R=o.eR.clone(T);for(let e=c;e<=u;e++){const r=o.eR.clone(R);for(let r=s;r<=l;r++){const s=o.eR.clone(R);for(let s=i;s<=a;s++){const i=[s,r,e];if(t(R,i)){const t=e*P+r*C+s*D;let o;o=D>2?[d[t],d[t+1],d[t+2]]:d[t],_.push({value:o,index:t,pointIJK:i,pointLPS:R.slice()}),n&&n({value:o,index:t,pointIJK:i,pointLPS:R})}o.eR.add(R,R,S)}o.eR.copy(R,s),o.eR.add(R,R,x)}o.eR.copy(R,r),o.eR.add(R,R,b)}return _}},5093:(e,t,n)=>{var o=n(92136);n(44753),n(19096),n(75403),n(15306);const{transformWorldToIndex:r}=o.utilities},60438:(e,t,n)=>{function o(e,t=5){return parseFloat(e[0]).toFixed(t)+","+parseFloat(e[1]).toFixed(t)+","+parseFloat(e[2]).toFixed(t)+","}n.d(t,{l:()=>o})},46514:(e,t,n)=>{n.r(t),n.d(t,{getPoint:()=>r,getPolyDataPointIndexes:()=>i,getPolyDataPoints:()=>a});var o=n(44753);function r(e,t){const n=3*t;if(n<e.length)return o.eR.fromValues(e[n],e[n+1],e[n+2])}function i(e){const t=e.getLines().getData();let n=0;const o=new Map;for(;n<t.length;){const e=t[n++],r=[];for(let o=0;o<e;o++)r.push(t[n+o]);o.set(r[0],r),n+=e}const r=[],i=e=>{for(const[t,n]of e.entries())if(void 0!==n)return t;return-1};let a=i(o);for(;-1!==a;){const e=[a];for(;o.has(a);){const t=o.get(a)[1];o.has(t)&&e.push(t),o.delete(a),a=t}r.push(e),a=i(o)}return r.length?r:void 0}function a(e){const t=i(e);if(!t)return;const n=e.getPoints().getData();return t.map((e=>e.map((e=>r(n,e)))))}},89786:(e,t,n)=>{n(92136),n(14471),n(42290)},15874:(e,t,n)=>{n(89786),n(81952)},81952:(e,t,n)=>{n.d(t,{l:()=>s});var o=n(44753),r=n(92136);const{isEqual:i}=r.utilities,a=[o.eR.fromValues(1,0,0),o.eR.fromValues(0,1,0),o.eR.fromValues(0,0,1)];function s(e){const t=o.eR.subtract(o.eR.create(),e[0],e[1]),n=o.eR.subtract(o.eR.create(),e[0],e[2]);return[...l(t,a),...l(n,a)].every((e=>i(e,0)||i(e,90)||i(e,180)||i(e,270)))}function l(e,t){return t.map((t=>180*o.eR.angle(e,t)/Math.PI))}},21783:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(92136);function r(e,t){if(!(0,o.getEnabledElement)(e.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(e instanceof o.StackViewport&&0===e.getImageIds().length)throw new Error("Scroll::Stack Viewport has no images");const{type:n}=e,{volumeId:r,delta:i,scrollSlabs:a}=t;if(e instanceof o.StackViewport)e.scroll(i,t.debounceLoading,t.loop);else if(e instanceof o.VolumeViewport)!function(e,t,n,r=!1){const i=r,{numScrollSteps:a,currentStepIndex:s,sliceRangeInfo:l}=o.utilities.getVolumeViewportScrollInfo(e,t,i);if(!l)return;const{sliceRange:c,spacingInNormalDirection:u,camera:d}=l,{focalPoint:g,viewPlaneNormal:h,position:f}=d,{newFocalPoint:m,newPosition:p}=o.utilities.snapFocalPointToSlice(g,f,c,h,u,n);e.setCamera({focalPoint:m,position:p}),e.render();const v=s+n,w={volumeId:t,viewport:e,delta:n,desiredStepIndex:v,currentStepIndex:s,numScrollSteps:a,currentImageId:e.getCurrentImageId()};(v>a||v<0)&&e.getCurrentImageId()?o.utilities.triggerEvent(o.eventTarget,o.EVENTS.VOLUME_SCROLL_OUT_OF_BOUNDS,w):o.utilities.triggerEvent(o.eventTarget,o.EVENTS.VOLUME_VIEWPORT_SCROLL,w)}(e,r,i,a);else{if(!(e instanceof o.VideoViewport))throw new Error(`Not implemented for Viewport Type: ${n}`);e.scroll(i)}}},33836:(e,t,n)=>{n.d(t,{A:()=>h});var o=n(92136),r=n(45238),i=n(23237),a=n(7727),s=n(20629),l=n(42111),c=n(39490),u=n(32415);const{uuidv4:d}=o.utilities,g=[l.A.HandlesUpdated,l.A.InterpolationUpdated];class h{static{this.toolNames=[]}static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static acceptAutoGenerated(e,t={}){const{toolNames:n,segmentationId:o,segmentIndex:i,sliceIndex:a}=t;for(const t of n||h.toolNames){const n=r.state.getAnnotations(t,e);if(n?.length)for(const e of n){const{interpolationUID:t,data:n,autoGenerated:r,metadata:s}=e;t&&(e.interpolationCompleted=!0),r&&(i&&i!==n.segmentation.segmentIndex||void 0!==a&&s&&a!==s.sliceIndex||o&&o!==n.segmentation.segmentationId||((0,u.V)(e),e.autoGenerated=!1))}}}static{this.handleAnnotationCompleted=e=>{const t=e.detail.annotation;if(!t?.metadata)return;const{toolName:n,originalToolName:o}=t.metadata;if(!this.toolNames.includes(n)&&!this.toolNames.includes(o))return;const r=(0,c.A)(t);if(!r)return void console.warn("Unable to find viewport for",t);const l={viewport:r,sliceData:f(r),annotation:t,interpolationUID:t.interpolationUID},u=!!t.interpolationUID;if(t.autoGenerated=!1,u)return(0,s.A)(l),void(0,a.A)(l);const g=[{key:"segmentIndex",value:t.data.segmentation.segmentIndex,parentKey:e=>e.data.segmentation},{key:"viewPlaneNormal",value:t.metadata.viewPlaneNormal,parentKey:e=>e.metadata},{key:"viewUp",value:t.metadata.viewUp,parentKey:e=>e.metadata}];let h=(0,i.A)(l,g);const{sliceIndex:m}=t.metadata,p=new Set;h.forEach((e=>{if(e.interpolationCompleted||e.metadata.sliceIndex===m){const{interpolationUID:t}=e;p.add(t)}})),h=h.filter((e=>!p.has(e.interpolationUID))),t.interpolationUID=h[0]?.interpolationUID||d(),l.interpolationUID=t.interpolationUID,(0,a.A)(l)}}static{this.handleAnnotationUpdate=e=>{const t=e.detail.annotation,{changeType:n=l.A.HandlesUpdated}=e.detail;if(!t?.metadata)return;const{toolName:o,originalToolName:r}=t.metadata;if(!this.toolNames.includes(o)&&!this.toolNames.includes(r)||!g.includes(n))return;const i=(0,c.A)(t);if(!i)return void console.warn("Unable to find matching viewport for annotation interpolation",t);t.autoGenerated&&((0,u.V)(t),t.autoGenerated=!1);const s={viewport:i,sliceData:f(i),annotation:t,interpolationUID:t.interpolationUID,isInterpolationUpdate:n===l.A.InterpolationUpdated};(0,a.A)(s)}}static{this.handleAnnotationDelete=e=>{const t=e.detail.annotation;if(!t?.metadata)return;const{toolName:n}=t.metadata;if(!this.toolNames.includes(n)||t.autoGenerated)return;const o=(0,c.A)(t);if(!o)return void console.warn("No viewport, can't delete interpolated results",t);const r={viewport:o,sliceData:f(o),annotation:t,interpolationUID:t.interpolationUID};t.autoGenerated=!1,(0,s.A)(r)}}}function f(e){return{numberOfSlices:e.getNumberOfSlices(),imageIndex:e.getCurrentImageIdIndex()}}},87590:(e,t,n)=>{n(52610),n(23072),n(92136),n(77071)},7300:(e,t,n)=>{n(52610),n(23072),n(92136),n(77071)},41196:(e,t,n)=>{n(75534);var o=n(83946);n(44753),n(92136);const{Labelmap:r}=o.A},96610:(e,t,n)=>{},82914:(e,t,n)=>{function o(e,t){return new Map(e.map(((e,n)=>[e,t[n]])))}n.d(t,{c:()=>o})},5092:(e,t,n)=>{n(48463),n(92136)},86398:(e,t,n)=>{n(92136)},27650:(e,t,n)=>{function o(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}n.d(t,{A:()=>r});const r=function(e,t,n={}){const r=n.onFlood,i=n.onBoundary,a=n.equals,s=n.diagonals||!1,l=m(t),c=function(){const e=function(e){const t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))};for(let r=0;r<Math.pow(3,e);r+=1){const i=o(r.toString(3),"0",e);t.push(n(i))}return t}(t.length);return e.filter((function(e){const t=function(e){let t=0;for(let n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}(e);return 0!==t&&(1===t||s)}))}(),u=[],d=[],g=new Set,h=new Map;for(u.push({currentArgs:t});u.length>0;)f(u.pop());return{flooded:d,boundaries:function(){const e=Array.from(h.values());return e.reverse(),e}()};function f(e){const t=e.currentArgs,n=e.previousArgs;(function(e){const[t,n,o=0]=e,r=t+32768+65536*(n+32768+65536*(o+32768));return g.has(r)})(t)||(function(e){const[t,n,o=0]=e,r=t+32768+65536*(n+32768+65536*(o+32768));g.add(r)}(t),function(e){const t=m(e);return a?a(t,l):t===l}(t)?(function(e){d.push(e),r&&r(...e)}(t),function(e){for(let t=0;t<c.length;t+=1){const n=c[t],o=e.slice(0);for(let t=0;t<e.length;t+=1)o[t]+=n[t];u.push({currentArgs:o,previousArgs:e})}}(t)):function(e){const[t,n,o=0]=e,r=t+32768+65536*(n+32768+65536*(o+32768));h.set(r,e),i&&i(...e)}(n))}function m(t){return e(...t)}}},50969:(e,t,n)=>{n(44350),n(83946)},4863:(e,t,n)=>{n.d(t,{L:()=>i});var o=n(95778),r=n(30322);function i(e){const t=(0,r.getSegmentation)(e),{annotationUIDsMap:n}=t.representationData.CONTOUR;for(const[e,t]of n.entries()){if(Array.from(t).find((e=>(0,o.gw)(e).highlighted)))return e}}},54117:(e,t,n)=>{n.d(t,{F:()=>a});var o=n(92136),r=n(30322),i=n(16124);function a(e,t,{viewport:n,searchRadius:a}){const l=(0,r.getSegmentation)(e),c=l.representationData.LABELMAP;if((0,i.r)(c)){const{volumeId:e}=c,r=o.cache.getVolume(e);if(!r)return;const i=r.imageData,l=i.getScalarValueFromWorld(t),u=function(e,t,n,o,r){const i=(t,r)=>{const i=[e[0]+t,e[1]+r],a=n.canvasToWorld(i);return o.getScalarValueFromWorld(a)};return s(i,t,r)}(n.worldToCanvas(t),l,n,i,a);return u?l:void 0}const{imageIdReferenceMap:u}=c,d=n.getCurrentImageId(),g=u.get(d);if(!o.cache.getImage(g))return;const h=(0,r.getSegmentationIdRepresentations)(l.segmentationId),{segmentationRepresentationUID:f}=h[0],m=n.getActor(f),p=m?.actor.getMapper().getInputData(),v=o.utilities.transformWorldToIndex(p,t),w=p.getDimensions(),y=p.voxelManager||o.utilities.VoxelManager.createVolumeVoxelManager(w,p.getPointData().getScalars().getData()),I=y.getAtIJKPoint(v),A=function(e,t,n,o,r){const i=(t,o,r)=>{const i=[e[0]+t,e[1]+o,e[2]+r];return n.getAtIJK(...i)};return s(i,o,r)}(v,0,y,I);return A?I:void 0}function s(e,t,n=1){const o=Array.from({length:2*n+1},((e,t)=>t-n));for(const n of o)for(const r of o)for(const i of o){if(0===n&&0===r&&0===i)continue;const o=e(n,r,i);if(void 0!==o&&t!==o)return!0}return!1}},2465:(e,t,n)=>{n.d(t,{Z5:()=>c});var o=n(92136),r=n(84901),i=n(30322),a=n(16124),s=n(95778),l=n(56634);function c(e,t,n={}){const c=(0,i.getSegmentation)(e),u=c.representationData,d=n?.representationType??Object.keys(u)[0];if(!d)throw new Error(`Segmentation ${e} does not have any representations`);switch(d){case r.SegmentationRepresentations.Labelmap:return function(e,t,{viewport:n}){const r=e.representationData.LABELMAP;if((0,a.r)(r)){const{volumeId:e}=r,n=o.cache.getVolume(e);if(!n)return;return n.imageData.getScalarValueFromWorld(t)}const{imageIdReferenceMap:s}=r,l=n.getCurrentImageId(),c=s.get(l);if(!o.cache.getImage(c))return;const u=(0,i.getSegmentationIdRepresentations)(e.segmentationId),{segmentationRepresentationUID:d}=u[0],g=n.getActor(d),h=g?.actor.getMapper().getInputData(),f=o.utilities.transformWorldToIndex(h,t),m=h.getDimensions(),p=h.voxelManager||o.utilities.VoxelManager.createVolumeVoxelManager(m,h.getPointData().getScalars().getData());return p.getAtIJKPoint(f)}(c,t,n);case r.SegmentationRepresentations.Contour:return function(e,t,{viewport:n}){const r=e.representationData.CONTOUR,i=Array.from(r.annotationUIDsMap.keys()),{viewPlaneNormal:a}=n.getCamera();for(const e of i){const n=r.annotationUIDsMap.get(e);if(n)for(const r of n){const n=(0,s.gw)(r);if(!n)continue;const{polyline:i}=n.data.contour;if(o.utilities.isEqual(a,n.metadata.viewPlaneNormal)&&(0,l.isPointInsidePolyline3D)(t,i))return Number(e)}}}(c,t,n);default:return}}},10351:(e,t,n)=>{n.d(t,{createImageIdReferenceMap:()=>r.c,getHoveredContourSegmentationAnnotation:()=>c.L,getSegmentAtLabelmapBorder:()=>l.F,getSegmentAtWorldPoint:()=>s.Z5,getUniqueSegmentIndices:()=>a.OX,invalidateBrushCursor:()=>i.E,triggerSegmentationRender:()=>o.h6});n(32854),n(71411),n(86398),n(19434),n(50969),n(5092);var o=n(49521),r=(n(27650),n(87590),n(7300),n(92922),n(82914)),i=(n(41196),n(96610),n(10032),n(15818)),a=n(94510),s=n(2465),l=n(54117),c=n(4863);n(77071)},15818:(e,t,n)=>{n.d(t,{E:()=>s});var o=n(52610),r=n(23072),i=n(92136),a=n(77071);function s(e){const t=(0,o.getToolGroup)(e);if(void 0===t)return;(0,a.n7)(e).forEach((e=>{e.invalidateBrushCursor()}));const n=t.getViewportsInfo(),s=Object.keys(n).map((e=>n[e]));if(!s.length)return;const{renderingEngineId:l}=s[0],c=t.getViewportIds(),u=(0,i.getRenderingEngine)(l);(0,r.A)(u,c)}},19434:(e,t,n)=>{n(44350),n(83946)},71411:(e,t,n)=>{n(45238),n(81848),n(32854),n(89786)},10032:(e,t,n)=>{n(92136),n(63421),n(45238),n(31555),n(41196),n(96610),n(50720)},92922:(e,t,n)=>{n(74119),n(87682),n(77071)},32854:(e,t,n)=>{n(74119),n(87682),n(77071)},77071:(e,t,n)=>{n.d(t,{n7:()=>i});n(92136);var o=n(52610),r=n(53712);n(14471);function i(e,t){const n=(0,o.getToolGroup)(e);if(void 0===n)return;const i=n._toolInstances;if(!Object.keys(i).length)return;if(t&&i[t])return[i[t]];return Object.values(i).filter((e=>e instanceof r.A))}},90387:(e,t,n)=>{n(92136),n(54957),n(48506);n(74119)},21090:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(64857),r=n(11857);const i=function(e,t,n){let i=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return(0,r.A)(n)&&(i="leading"in n?Boolean(n.leading):i,a="trailing"in n?Boolean(n.trailing):a),(0,o.A)(e,t,{leading:i,trailing:a,maxWait:t})}},54868:(e,t,n)=>{function o(e,t){const n=l(e),o=l(t);return{page:u(n.page,o.page),client:u(n.client,o.client),canvas:u(n.canvas,o.canvas),world:(r=n.world,i=o.world,[r[0]-i[0],r[1]-i[1],r[2]-i[2]])};var r,i}function r(e,t){const n=l(e),o=l(t);return{page:g(n.page,o.page),client:g(n.client,o.client),canvas:g(n.canvas,o.canvas),world:h(n.world,o.world)}}function i(e,t){const n=d(e),o=d(t);return{page:n.page-o.page,client:n.client-o.client,canvas:n.canvas-o.canvas,world:n.world-o.world}}function a(e){return JSON.parse(JSON.stringify(e))}function s(e){return JSON.parse(JSON.stringify(e))}function l(e){return e.reduce(((t,n)=>({page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length]})),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function c(e){return e.reduce(((t,n)=>({page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length],touch:{identifier:null,radiusX:t.touch.radiusX+n.touch.radiusX/e.length,radiusY:t.touch.radiusY+n.touch.radiusY/e.length,force:t.touch.force+n.touch.force/e.length,rotationAngle:t.touch.rotationAngle+n.touch.rotationAngle/e.length}})),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function u(e,t){return[e[0]-t[0],e[1]-t[1]]}function d(e){const t=[];for(let n=0;n<e.length;n++)for(let o=0;o<e.length;o++)n<o&&t.push({page:g(e[n].page,e[o].page),client:g(e[n].client,e[o].client),canvas:g(e[n].canvas,e[o].canvas),world:h(e[n].world,e[o].world)});return t.reduce(((e,n)=>({page:e.page+n.page/t.length,client:e.client+n.client/t.length,canvas:e.canvas+n.canvas/t.length,world:e.world+n.world/t.length})),{page:0,client:0,canvas:0,world:0})}function g(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function h(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}n.d(t,{copyPoints:()=>s,copyPointsList:()=>a,getDeltaDistance:()=>r,getDeltaDistanceBetweenIPoints:()=>i,getDeltaPoints:()=>o,getMeanTouchPoints:()=>c})},27819:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(92136),r=n(6805),i=n(52610);const a=function(e){e.forEach((e=>{const t=(0,i.getToolGroup)(e);if(!t)return void console.warn(`ToolGroup not available for ${e}`);t.getViewportsInfo().forEach((e=>{const{renderingEngineId:t,viewportId:n}=e,i=(0,o.getRenderingEngine)(t);if(!i)return void console.warn(`RenderingEngine not available for ${t}`);const a=i.getViewport(n);(0,r.Ay)(a.element)}))}))}},31555:(e,t,n)=>{n.d(t,{isViewportPreScaled:()=>o.u});var o=n(97022);n(11666),n(88240)},97022:(e,t,n)=>{n.d(t,{u:()=>r});var o=n(92136);function r(e,t){if(e instanceof o.BaseVolumeViewport){const e=t.split("volumeId:"),n=e.length>1?e[1].split("?")[0]:e[0],r=o.cache.getVolume(n);return!!r?.scaling&&Object.keys(r.scaling).length>0}if(e instanceof o.StackViewport){const{preScale:t}=e.getImageData()||{};return!!t?.scaled}return!1}},11666:(e,t,n)=>{n(92136),n(88484),n(21783)},88240:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(92136),r=n(44753);function i(e,t){if(!(e instanceof o.VolumeViewport))return;const{focalPoint:n}=e.getCamera(),i=[0,0,0];return r.eR.sub(i,t,n),function(e,t){const n=e.getCamera(),o=n.viewPlaneNormal,i=r.eR.dot(t,o),a=r.eR.fromValues(o[0],o[1],o[2]);if(r.eR.scale(a,a,i),Math.abs(a[0])>.001||Math.abs(a[1])>.001||Math.abs(a[2])>.001){const t=[0,0,0],o=[0,0,0];r.eR.add(t,n.focalPoint,a),r.eR.add(o,n.position,a),e.setCamera({focalPoint:t,position:o}),e.render()}}(e,i),!0}},90252:(e,t,n)=>{n.d(t,{filterViewportsWithToolEnabled:()=>l,getViewportIdsWithToolToRender:()=>h});var o=n(61738),r=n(84901);const{Active:i,Passive:a,Enabled:s}=r.ToolModes;function l(e,t){const n=e.length,r=[];for(let i=0;i<n;i++){const n=e[i],a=o.dU.getToolGroupForViewport(n.id,n.renderingEngineId);if(!a)continue;c(a,t)&&r.push(n)}return r}function c(e,t){const{toolOptions:n}=e,o=n[t];if(!o)return!1;const r=o.mode;return r===i||r===a||r===s}var u=n(92136),d=n(44753);const g=function(e,t,n=.999){return e.filter((e=>{const o=e.getCamera();return Math.abs(d.eR.dot(o.viewPlaneNormal,t.viewPlaneNormal))>n}))};function h(e,t,n=!0){const o=(0,u.getEnabledElement)(e),{renderingEngine:r,FrameOfReferenceUID:i}=o;let a=r.getViewports();a=function(e,t){const n=e.length,o=[];for(let r=0;r<n;r++){const n=e[r];n.getFrameOfReferenceUID()===t&&o.push(n)}return o}(a,i),a=l(a,t);const s=r.getViewport(o.viewportId);n&&(a=g(a,s.getCamera()));return a.map((e=>e.id))}},50112:(e,t,n)=>{n.d(t,{P:()=>g});var o=n(44753),r=n(92136),i=n(24284),a=n(50614),s=n(25605),l=n(4856),c=n(57457),u=n(38461);const d={MULTIPLIER:1,RANGE_TEXT_POSITION:a.U.Right,TICKS_BAR_SIZE:50};class g extends u.A{constructor(e){super(e),this._isMouseOver=!1,this._isInteracting=!1,this._mouseOverCallback=e=>{this._isMouseOver=!0,this.showTicks(),e.stopPropagation()},this._mouseOutCallback=e=>{this._isMouseOver=!1,this.hideTicks(),e.stopPropagation()},this._mouseDownCallback=e=>{this._isInteracting=!0,this.showTicks(),this._addVOIEventListeners(e),e.stopPropagation()},this._mouseDragCallback=(e,t)=>{const n=this.getVOIMultipliers(),i=this._getPointsFromMouseEvent(e),{points:a,voiRange:s}=t,l=o.Zc.sub(o.Zc.create(),i.local,a.local),c=l[0]*n[0],u=l[1]*n[1];if(!c&&!u)return;const{lower:d,upper:g}=s;let{windowWidth:h,windowCenter:f}=r.utilities.windowLevel.toWindowLevel(d,g);h=Math.max(h+c,1),f+=u;const m=r.utilities.windowLevel.toLowHighRange(h,f);this.voiRange=m,e.stopPropagation(),e.preventDefault()},this._mouseUpCallback=e=>{this._isInteracting=!1,this.hideTicks(),this._removeVOIEventListeners(),e.stopPropagation()},this._eventListenersManager=new r.utilities.eventListener.MultiTargetEventListenerManager,this._colormaps=g.getColormapsMap(e),this._activeColormapName=g.getInitialColormapName(e),this._canvas=this._createCanvas(e),this._ticksBar=this._createTicksBar(e),this._rangeTextPosition=e.ticks?.position??d.RANGE_TEXT_POSITION,this._canvas.appendTo(this.rootElement),this._ticksBar.appendTo(this.rootElement),this._addRootElementEventListeners()}get activeColormapName(){return this._activeColormapName}set activeColormapName(e){if(e===this._activeColormapName)return;const t=this._colormaps.get(e);t?(this._activeColormapName=e,this._canvas.colormap=t):console.warn(`Invalid colormap name (${e})`)}get imageRange(){return this._canvas.imageRange}set imageRange(e){this._canvas.imageRange=e,this._ticksBar.imageRange=e}get voiRange(){return this._canvas.voiRange}set voiRange(e){const{voiRange:t}=this._canvas;(0,i.kB)(e)&&!(0,i.bh)(e,t)&&(this._canvas.voiRange=e,this._ticksBar.voiRange=e,this.onVoiChange(e))}get showFullImageRange(){return this._canvas.showFullImageRange}set showFullImageRange(e){this._canvas.showFullImageRange=e,this._ticksBar.showFullPixelValueRange=e}destroy(){super.destroy(),this._eventListenersManager.reset()}createRootElement(){const e=document.createElement("div");return Object.assign(e.style,{position:"relative",fontSize:"0",width:"100%",height:"100%"}),e}onContainerResize(){super.onContainerResize(),this.updateTicksBar(),this._canvas.size=this.containerSize}getVOIMultipliers(){return[d.MULTIPLIER,d.MULTIPLIER]}onVoiChange(e){}showTicks(){this.updateTicksBar(),this._ticksBar.visible=!0}hideTicks(){this._isInteracting||this._isMouseOver||(this._ticksBar.visible=!1)}static getColormapsMap(e){const{colormaps:t}=e;return t.reduce(((e,t)=>e.set(t.Name,t)),new Map)}static getInitialColormapName(e){const{activeColormapName:t,colormaps:n}=e;return!!t&&n.some((e=>e.Name===t))?t:n[0].Name}_createCanvas(e){const{imageRange:t,voiRange:n,showFullPixelValueRange:o}=e,r=this._colormaps.get(this._activeColormapName);return new s.n({colormap:r,imageRange:t,voiRange:n,showFullPixelValueRange:o})}_createTicksBar(e){const t=e.ticks;return new l.f({imageRange:e.imageRange,voiRange:e.voiRange,ticks:t,showFullPixelValueRange:e.showFullPixelValueRange})}_getPointsFromMouseEvent(e){const{rootElement:t}=this,n=[e.clientX,e.clientY],o=[e.pageX,e.pageY],r=t.getBoundingClientRect();return{client:n,page:o,local:[o[0]-r.left-window.pageXOffset,o[1]-r.top-window.pageYOffset]}}updateTicksBar(){const{width:e,height:t}=this.containerSize;if(0===e&&0===t)return;const{_ticksBar:n,_rangeTextPosition:o}=this,r=e>=t,i=r?e:d.TICKS_BAR_SIZE,s=r?d.TICKS_BAR_SIZE:t;if(!(0,c.A)(e,t,o))throw new Error("Invalid rangeTextPosition value for the current colobar orientation");let l,u;n.size={width:i,height:s},r?(u=0,l=o===a.U.Top?-s:t):(l=0,u=o===a.U.Left?-i:e),n.top=l,n.left=u}_addRootElementEventListeners(){const{_eventListenersManager:e}=this,{rootElement:t}=this;e.addEventListener(t,"mouseover",this._mouseOverCallback),e.addEventListener(t,"mouseout",this._mouseOutCallback),e.addEventListener(t,"mousedown",this._mouseDownCallback)}_addVOIEventListeners(e){const{_eventListenersManager:t}=this,n={points:this._getPointsFromMouseEvent(e),voiRange:{...this._canvas.voiRange}};this._removeVOIEventListeners(),t.addEventListener(document,"voi.mouseup",this._mouseUpCallback),t.addEventListener(document,"voi.mousemove",(e=>this._mouseDragCallback(e,n)))}_removeVOIEventListeners(){const{_eventListenersManager:e}=this;e.removeEventListener(document,"voi.mouseup"),e.removeEventListener(document,"voi.mousemove")}}},81034:(e,t,n)=>{var o=n(92136),r=n(50112);n(51954);const{Events:i}=o.Enums;r.P},50614:(e,t,n)=>{var o;n.d(t,{U:()=>o}),function(e){e.Top="top",e.Left="left",e.Bottom="bottom",e.Right="right"}(o||(o={}))},73231:(e,t,n)=>{n.d(t,{ColorbarRangeTextPosition:()=>o.U});var o=n(50614)},64690:(e,t,n)=>{n(73231),n(50112),n(81034)},10413:(e,t,n)=>{n(64690)},95989:(e,t,n)=>{var o,r=n(99178),i=n(51250),a=n(45128);const s=(o="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,n,r=void 0!==(e=e||{})?e:{};r.ready=new Promise((function(e,o){t=e,n=o}));var i,a=Object.assign({},r),s=[],l="./this.program",c=(e,t)=>{throw t},u=!0,d=!1,g="";(u||d)&&(d?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),o&&(g=o),g=0!==g.indexOf("blob:")?g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):"",d&&(i=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var h=r.print||console.log.bind(console),f=r.printErr||console.warn.bind(console);Object.assign(r,a),a=null,r.arguments&&(s=r.arguments),r.thisProgram&&(l=r.thisProgram),r.quit&&(c=r.quit);var m,p=4;r.wasmBinary&&(m=r.wasmBinary);var v,w=r.noExitRuntime||!0;"object"!=typeof WebAssembly&&H("no native wasm support detected");var y,I,A,E,T,S,x,b,D,C,P=!1,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(e,t,n){for(var o=t+n,r=t;e[r]&&!(r>=o);)++r;if(r-t>16&&e.buffer&&_)return _.decode(e.subarray(t,r));for(var i="";t<r;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var l=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&e[t++])<65536)i+=String.fromCharCode(a);else{var c=a-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&a)<<6|s)}else i+=String.fromCharCode(a)}return i}function M(e,t){return e?R(E,e,t):""}function O(e,t,n,o){if(!(o>0))return 0;for(var r=n,i=n+o-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(n>=i)break;t[n++]=s}else if(s<=2047){if(n+1>=i)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=i)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-r}function L(e){for(var t=0,n=0;n<e.length;++n){var o=e.charCodeAt(n);o<=127?t++:o<=2047?t+=2:o>=55296&&o<=57343?(t+=4,++n):t+=3}return t}function k(e){I=e,r.HEAP8=A=new Int8Array(e),r.HEAP16=T=new Int16Array(e),r.HEAP32=x=new Int32Array(e),r.HEAPU8=E=new Uint8Array(e),r.HEAPU16=S=new Uint16Array(e),r.HEAPU32=b=new Uint32Array(e),r.HEAPF32=D=new Float32Array(e),r.HEAPF64=C=new Float64Array(e)}r.INITIAL_MEMORY;var N,V=[],U=[],W=[],B=[],F=0,q=null,j=null;function H(e){r.onAbort&&r.onAbort(e),f(e="Aborted("+e+")"),P=!0,y=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}var Y,z,G="data:application/octet-stream;base64,";function Z(e){return e.startsWith(G)}function X(e){try{if(e==Y&&m)return new Uint8Array(m);if(i)return i(e);throw"both async and sync fetching of the wasm failed"}catch(e){H(e)}}Z(Y="ICRPolySeg.wasm")||(z=Y,Y=r.locateFile?r.locateFile(z,g):g+z);var $={638383:e=>{r.updateProgress&&r.updateProgress(e)}};function K(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function J(e){for(;e.length>0;)e.shift()(r)}function Q(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){b[this.ptr+4>>2]=e},this.get_type=function(){return b[this.ptr+4>>2]},this.set_destructor=function(e){b[this.ptr+8>>2]=e},this.get_destructor=function(){return b[this.ptr+8>>2]},this.set_refcount=function(e){x[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,A[this.ptr+12|0]=e},this.get_caught=function(){return 0!=A[this.ptr+12|0]},this.set_rethrown=function(e){e=e?1:0,A[this.ptr+13|0]=e},this.get_rethrown=function(){return 0!=A[this.ptr+13|0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=x[this.ptr>>2];x[this.ptr>>2]=e+1},this.release_ref=function(){var e=x[this.ptr>>2];return x[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){b[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return b[this.ptr+16>>2]},this.get_exception_ptr=function(){if(ft(this.get_type()))return b[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}var ee={varargs:void 0,get:function(){return ee.varargs+=4,x[ee.varargs-4>>2]},getStr:function(e){return M(e)}},te={};function ne(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function oe(e){return this.fromWireType(x[e>>2])}var re={},ie={},ae={},se=48,le=57;function ce(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=se&&t<=le?"_"+e:e}function ue(e,t){return e=ce(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function de(e,t){var n=ue(t,(function(e){this.name=t,this.message=e;var n=new Error(e).stack;void 0!==n&&(this.stack=this.toString()+"\n"+n.replace(/^Error(:[^\n]*)?\n/,""))}));return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var ge=void 0;function he(e){throw new ge(e)}function fe(e,t,n){function o(t){var o=n(t);o.length!==e.length&&he("Mismatched type converter count");for(var r=0;r<e.length;++r)Ie(e[r],o[r])}e.forEach((function(e){ae[e]=t}));var r=new Array(t.length),i=[],a=0;t.forEach(((e,t)=>{ie.hasOwnProperty(e)?r[t]=ie[e]:(i.push(e),re.hasOwnProperty(e)||(re[e]=[]),re[e].push((()=>{r[t]=ie[e],++a===i.length&&o(r)})))})),0===i.length&&o(r)}function me(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var pe=void 0;function ve(e){for(var t="",n=e;E[n];)t+=pe[E[n++]];return t}var we=void 0;function ye(e){throw new we(e)}function Ie(e,t,n={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var o=t.name;if(e||ye('type "'+o+'" must have a positive integer typeid pointer'),ie.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;ye("Cannot register type '"+o+"' twice")}if(ie[e]=t,delete ae[e],re.hasOwnProperty(e)){var r=re[e];delete re[e],r.forEach((e=>e()))}}var Ae=[],Ee=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Te(e){e>4&&0==--Ee[e].refcount&&(Ee[e]=void 0,Ae.push(e))}function Se(){for(var e=0,t=5;t<Ee.length;++t)void 0!==Ee[t]&&++e;return e}function xe(){for(var e=5;e<Ee.length;++e)if(void 0!==Ee[e])return Ee[e];return null}var be={toValue:e=>(e||ye("Cannot use deleted val. handle = "+e),Ee[e].value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=Ae.length?Ae.pop():Ee.length;return Ee[t]={refcount:1,value:e},t}}};function De(e,t){switch(t){case 2:return function(e){return this.fromWireType(D[e>>2])};case 3:return function(e){return this.fromWireType(C[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Ce(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var n=ue(e.name||"unknownFunctionName",(function(){}));n.prototype=e.prototype;var o=new n,r=e.apply(o,t);return r instanceof Object?r:o}function Pe(e,t,n){r.hasOwnProperty(e)?((void 0===n||void 0!==r[e].overloadTable&&void 0!==r[e].overloadTable[n])&&ye("Cannot register public name '"+e+"' twice"),function(e,t,n){if(void 0===e[t].overloadTable){var o=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ye("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[o.argCount]=o}}(r,e,e),r.hasOwnProperty(n)&&ye("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),r[e].overloadTable[n]=t):(r[e]=t,void 0!==n&&(r[e].numArguments=n))}var _e=[];function Re(e){var t=_e[e];return t||(e>=_e.length&&(_e.length=e+1),_e[e]=t=N.get(e)),t}function Me(e,t,n){return e.includes("j")?function(e,t,n){var o=r["dynCall_"+e];return n&&n.length?o.apply(null,[t].concat(n)):o.call(null,t)}(e,t,n):Re(t).apply(null,n)}function Oe(e,t){var n,o,r,i=(e=ve(e)).includes("j")?(n=e,o=t,r=[],function(){return r.length=0,Object.assign(r,arguments),Me(n,o,r)}):Re(t);return"function"!=typeof i&&ye("unknown function pointer with signature "+e+": "+t),i}var Le=void 0;function ke(e){var t=ht(e),n=ve(t);return gt(t),n}function Ne(e,t,n){switch(t){case 0:return n?function(e){return A[e]}:function(e){return E[e]};case 1:return n?function(e){return T[e>>1]}:function(e){return S[e>>1]};case 2:return n?function(e){return x[e>>2]}:function(e){return b[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var Ve="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function Ue(e,t){for(var n=e,o=n>>1,r=o+t/2;!(o>=r)&&S[o];)++o;if((n=o<<1)-e>32&&Ve)return Ve.decode(E.subarray(e,n));for(var i="",a=0;!(a>=t/2);++a){var s=T[e+2*a>>1];if(0==s)break;i+=String.fromCharCode(s)}return i}function We(e,t,n){if(void 0===n&&(n=2147483647),n<2)return 0;for(var o=t,r=(n-=2)<2*e.length?n/2:e.length,i=0;i<r;++i){var a=e.charCodeAt(i);T[t>>1]=a,t+=2}return T[t>>1]=0,t-o}function Be(e){return 2*e.length}function Fe(e,t){for(var n=0,o="";!(n>=t/4);){var r=x[e+4*n>>2];if(0==r)break;if(++n,r>=65536){var i=r-65536;o+=String.fromCharCode(55296|i>>10,56320|1023&i)}else o+=String.fromCharCode(r)}return o}function qe(e,t,n){if(void 0===n&&(n=2147483647),n<4)return 0;for(var o=t,r=o+n-4,i=0;i<e.length;++i){var a=e.charCodeAt(i);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i)),x[t>>2]=a,(t+=4)+4>r)break}return x[t>>2]=0,t-o}function je(e){for(var t=0,n=0;n<e.length;++n){var o=e.charCodeAt(n);o>=55296&&o<=57343&&++n,t+=4}return t}function He(e,t){var n=ie[e];return void 0===n&&ye(t+" has unknown type "+ke(e)),n}var Ye={};function ze(e){var t=Ye[e];return void 0===t?ve(e):t}var Ge=[];function Ze(){return"object"==typeof globalThis?globalThis:Function("return this")()}var Xe=[],$e={},Ke=[];function Je(e,t,n){var o=function(e,t){var n;for(Ke.length=0,t>>=2;n=E[e++];)t+=105!=n&t,Ke.push(105==n?x[t]:C[t++>>1]),++t;return Ke}(t,n);return $[e].apply(null,o)}function Qe(e){try{return v.grow(e-I.byteLength+65535>>>16),k(v.buffer),1}catch(e){}}var et={};function tt(){if(!tt.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in et)void 0===et[t]?delete e[t]:e[t]=et[t];var n=[];for(var t in e)n.push(t+"="+e[t]);tt.strings=n}return tt.strings}var nt=[null,[],[]];function ot(e,t){var n=nt[e];0===t||10===t?((1===e?h:f)(R(n,0)),n.length=0):n.push(t)}function rt(e){return e%4==0&&(e%100!=0||e%400==0)}var it=[31,29,31,30,31,30,31,31,30,31,30,31],at=[31,28,31,30,31,30,31,31,30,31,30,31];function st(e,t,n,o){var r=x[o+40>>2],i={tm_sec:x[o>>2],tm_min:x[o+4>>2],tm_hour:x[o+8>>2],tm_mday:x[o+12>>2],tm_mon:x[o+16>>2],tm_year:x[o+20>>2],tm_wday:x[o+24>>2],tm_yday:x[o+28>>2],tm_isdst:x[o+32>>2],tm_gmtoff:x[o+36>>2],tm_zone:r?M(r):""},a=M(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in s)a=a.replace(new RegExp(l,"g"),s[l]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=["January","February","March","April","May","June","July","August","September","October","November","December"];function d(e,t,n){for(var o="number"==typeof e?e.toString():e||"";o.length<t;)o=n[0]+o;return o}function g(e,t){return d(e,t,"0")}function h(e,t){function n(e){return e<0?-1:e>0?1:0}var o;return 0===(o=n(e.getFullYear()-t.getFullYear()))&&0===(o=n(e.getMonth()-t.getMonth()))&&(o=n(e.getDate()-t.getDate())),o}function f(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function m(e){var t=function(e,t){for(var n=new Date(e.getTime());t>0;){var o=rt(n.getFullYear()),r=n.getMonth(),i=(o?it:at)[r];if(!(t>i-n.getDate()))return n.setDate(n.getDate()+t),n;t-=i-n.getDate()+1,n.setDate(1),r<11?n.setMonth(r+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),o=new Date(t.getFullYear()+1,0,4),r=f(n),i=f(o);return h(r,t)<=0?h(i,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var p={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return u[e.tm_mon].substring(0,3)},"%B":function(e){return u[e.tm_mon]},"%C":function(e){return g((e.tm_year+1900)/100|0,2)},"%d":function(e){return g(e.tm_mday,2)},"%e":function(e){return d(e.tm_mday,2," ")},"%g":function(e){return m(e).toString().substring(2)},"%G":function(e){return m(e)},"%H":function(e){return g(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),g(t,2)},"%j":function(e){return g(e.tm_mday+function(e,t){for(var n=0,o=0;o<=t;n+=e[o++]);return n}(rt(e.tm_year+1900)?it:at,e.tm_mon-1),3)},"%m":function(e){return g(e.tm_mon+1,2)},"%M":function(e){return g(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return g(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return g(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var n=(e.tm_wday+371-e.tm_yday)%7;4==n||3==n&&rt(e.tm_year)||(t=1)}}else{t=52;var o=(e.tm_wday+7-e.tm_yday-1)%7;(4==o||5==o&&rt(e.tm_year%400-1))&&t++}return g(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return g(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in a=a.replace(/%%/g,"\0\0"),p)a.includes(l)&&(a=a.replace(new RegExp(l,"g"),p[l](i)));a=a.replace(/\0\0/g,"%");var v,w,y,I,E,T,S=(v=a,w=!1,I=y>0?y:L(v)+1,E=new Array(I),T=O(v,E,0,E.length),w&&(E.length=T),E);return S.length>t?0:(function(e,t){A.set(e,t)}(S,e),S.length-1)}function lt(e){y=e,w||(r.onExit&&r.onExit(e),P=!0),c(e,new K(e))}ge=r.InternalError=de(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);pe=e}(),we=r.BindingError=de(Error,"BindingError"),r.count_emval_handles=Se,r.get_first_emval=xe,Le=r.UnboundTypeError=de(Error,"UnboundTypeError");var ct,ut={b:function(e,t,n){throw new Q(e).init(t,n),e},J:function(e,t){},F:function(e,t,n){},L:function(e,t,n,o){ee.varargs=o},E:function(e,t,n,o){},G:function(e,t){},x:function(e){var t=te[e];delete te[e];var n=t.rawConstructor,o=t.rawDestructor,r=t.fields;fe([e],r.map((e=>e.getterReturnType)).concat(r.map((e=>e.setterArgumentType))),(e=>{var i={};return r.forEach(((t,n)=>{var o=t.fieldName,a=e[n],s=t.getter,l=t.getterContext,c=e[n+r.length],u=t.setter,d=t.setterContext;i[o]={read:e=>a.fromWireType(s(l,e)),write:(e,t)=>{var n=[];u(d,e,c.toWireType(n,t)),ne(n)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var n in i)t[n]=i[n].read(e);return o(e),t},toWireType:function(e,t){for(var r in i)if(!(r in t))throw new TypeError('Missing field:  "'+r+'"');var a=n();for(r in i)i[r].write(a,t[r]);return null!==e&&e.push(o,a),a},argPackAdvance:8,readValueFromPointer:oe,destructorFunction:o}]}))},A:function(e,t,n,o,r){},O:function(e,t,n,o,r){var i=me(n);Ie(e,{name:t=ve(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?o:r},argPackAdvance:8,readValueFromPointer:function(e){var o;if(1===n)o=A;else if(2===n)o=T;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);o=x}return this.fromWireType(o[e>>i])},destructorFunction:null})},N:function(e,t){Ie(e,{name:t=ve(t),fromWireType:function(e){var t=be.toValue(e);return Te(e),t},toWireType:function(e,t){return be.toHandle(t)},argPackAdvance:8,readValueFromPointer:oe,destructorFunction:null})},v:function(e,t,n){var o=me(n);Ie(e,{name:t=ve(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:De(t,o),destructorFunction:null})},g:function(e,t,n,o,i,a){var s=function(e,t){for(var n=[],o=0;o<e;o++)n.push(b[t+4*o>>2]);return n}(t,n);e=ve(e),i=Oe(o,i),Pe(e,(function(){!function(e,t){var n=[],o={};throw t.forEach((function e(t){o[t]||ie[t]||(ae[t]?ae[t].forEach(e):(n.push(t),o[t]=!0))})),new Le(e+": "+n.map(ke).join([", "]))}("Cannot call "+e+" due to unbound types",s)}),t-1),fe([],s,(function(n){var o=[n[0],null].concat(n.slice(1));return function(e,t,n){r.hasOwnProperty(e)||he("Replacing nonexistant public symbol"),void 0!==r[e].overloadTable&&void 0!==n?r[e].overloadTable[n]=t:(r[e]=t,r[e].argCount=n)}(e,function(e,t,n,o,r){var i=t.length;i<2&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==n,s=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){s=!0;break}var c="void"!==t[0].name,u="",d="";for(l=0;l<i-2;++l)u+=(0!==l?", ":"")+"arg"+l,d+=(0!==l?", ":"")+"arg"+l+"Wired";var g="return function "+ce(e)+"("+u+") {\nif (arguments.length !== "+(i-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(i-2)+" args!');\n}\n";s&&(g+="var destructors = [];\n");var h=s?"destructors":"null",f=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],m=[ye,o,r,ne,t[0],t[1]];for(a&&(g+="var thisWired = classParam.toWireType("+h+", this);\n"),l=0;l<i-2;++l)g+="var arg"+l+"Wired = argType"+l+".toWireType("+h+", arg"+l+"); // "+t[l+2].name+"\n",f.push("argType"+l),m.push(t[l+2]);if(a&&(d="thisWired"+(d.length>0?", ":"")+d),g+=(c?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+");\n",s)g+="runDestructors(destructors);\n";else for(l=a?1:2;l<t.length;++l){var p=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(g+=p+"_dtor("+p+"); // "+t[l].name+"\n",f.push(p+"_dtor"),m.push(t[l].destructorFunction))}return c&&(g+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),g+="}\n",f.push(g),Ce(Function,f).apply(null,m)}(e,o,null,i,a),t-1),[]}))},d:function(e,t,n,o,r){t=ve(t),-1===r&&(r=4294967295);var i=me(n),a=e=>e;if(0===o){var s=32-8*n;a=e=>e<<s>>>s}var l=t.includes("unsigned");Ie(e,{name:t,fromWireType:a,toWireType:l?function(e,t){return this.name,t>>>0}:function(e,t){return this.name,t},argPackAdvance:8,readValueFromPointer:Ne(t,i,0!==o),destructorFunction:null})},c:function(e,t,n){var o=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){var t=b,n=t[e>>=2],r=t[e+1];return new o(I,r,n)}Ie(e,{name:n=ve(n),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},u:function(e,t){var n="std::string"===(t=ve(t));Ie(e,{name:t,fromWireType:function(e){var t,o=b[e>>2],r=e+4;if(n)for(var i=r,a=0;a<=o;++a){var s=r+a;if(a==o||0==E[s]){var l=M(i,s-i);void 0===t?t=l:(t+=String.fromCharCode(0),t+=l),i=s+1}}else{var c=new Array(o);for(a=0;a<o;++a)c[a]=String.fromCharCode(E[r+a]);t=c.join("")}return gt(e),t},toWireType:function(e,t){var o;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ye("Cannot pass non-string to std::string"),o=n&&r?L(t):t.length;var i=dt(4+o+1),a=i+4;if(b[i>>2]=o,n&&r)O(t,E,a,o+1);else if(r)for(var s=0;s<o;++s){var l=t.charCodeAt(s);l>255&&(gt(a),ye("String has UTF-16 code units that do not fit in 8 bits")),E[a+s]=l}else for(s=0;s<o;++s)E[a+s]=t[s];return null!==e&&e.push(gt,i),i},argPackAdvance:8,readValueFromPointer:oe,destructorFunction:function(e){gt(e)}})},m:function(e,t,n){var o,r,i,a,s;n=ve(n),2===t?(o=Ue,r=We,a=Be,i=()=>S,s=1):4===t&&(o=Fe,r=qe,a=je,i=()=>b,s=2),Ie(e,{name:n,fromWireType:function(e){for(var n,r=b[e>>2],a=i(),l=e+4,c=0;c<=r;++c){var u=e+4+c*t;if(c==r||0==a[u>>s]){var d=o(l,u-l);void 0===n?n=d:(n+=String.fromCharCode(0),n+=d),l=u+t}}return gt(e),n},toWireType:function(e,o){"string"!=typeof o&&ye("Cannot pass non-string to C++ string type "+n);var i=a(o),l=dt(4+i+t);return b[l>>2]=i>>s,r(o,l+4,i+t),null!==e&&e.push(gt,l),l},argPackAdvance:8,readValueFromPointer:oe,destructorFunction:function(e){gt(e)}})},y:function(e,t,n,o,r,i){te[e]={name:ve(t),rawConstructor:Oe(n,o),rawDestructor:Oe(r,i),fields:[]}},e:function(e,t,n,o,r,i,a,s,l,c){te[e].fields.push({fieldName:ve(t),getterReturnType:n,getter:Oe(o,r),getterContext:i,setterArgumentType:a,setter:Oe(s,l),setterContext:c})},P:function(e,t){Ie(e,{isVoid:!0,name:t=ve(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},r:function(e,t,n){e=be.toValue(e),t=He(t,"emval::as");var o=[],r=be.toHandle(o);return b[n>>2]=r,t.toWireType(o,e)},i:function(e,t,n,o){(e=Ge[e])(t=be.toValue(t),n=ze(n),null,o)},a:Te,p:function(e){return 0===e?be.toHandle(Ze()):(e=ze(e),be.toHandle(Ze()[e]))},j:function(e,t){var n=function(e,t){for(var n=new Array(e),o=0;o<e;++o)n[o]=He(b[t+o*p>>2],"parameter "+o);return n}(e,t),o=n[0],r=o.name+"_$"+n.slice(1).map((function(e){return e.name})).join("_")+"$",i=Xe[r];if(void 0!==i)return i;for(var a=["retType"],s=[o],l="",c=0;c<e-1;++c)l+=(0!==c?", ":"")+"arg"+c,a.push("argType"+c),s.push(n[1+c]);var u="return function "+ce("methodCaller_"+r)+"(handle, name, destructors, args) {\n",d=0;for(c=0;c<e-1;++c)u+="    var arg"+c+" = argType"+c+".readValueFromPointer(args"+(d?"+"+d:"")+");\n",d+=n[c+1].argPackAdvance;for(u+="    var rv = handle[name]("+l+");\n",c=0;c<e-1;++c)n[c+1].deleteObject&&(u+="    argType"+c+".deleteObject(arg"+c+");\n");o.isVoid||(u+="    return retType.toWireType(destructors, rv);\n"),u+="};\n",a.push(u);var g,h,f=Ce(Function,a).apply(null,s);return g=f,h=Ge.length,Ge.push(g),i=h,Xe[r]=i,i},s:function(e,t){return e=be.toValue(e),t=be.toValue(t),be.toHandle(e[t])},f:function(e){e>4&&(Ee[e].refcount+=1)},o:function(e,t,n,o){e=be.toValue(e);var i=$e[t];return i||(i=function(e){for(var t="",n=0;n<e;++n)t+=(0!==n?", ":"")+"arg"+n;var o="return function emval_allocator_"+e+"(constructor, argTypes, args) {\n  var HEAPU32 = getMemory();\n";for(n=0;n<e;++n)o+="var argType"+n+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+n+"');\nvar arg"+n+" = argType"+n+".readValueFromPointer(args);\nargs += argType"+n+"['argPackAdvance'];\nargTypes += 4;\n";return o+="var obj = new constructor("+t+");\nreturn valueToHandle(obj);\n}\n",new Function("requireRegisteredType","Module","valueToHandle","getMemory",o)(He,r,be.toHandle,(()=>b))}(t),$e[t]=i),i(e,n,o)},w:function(e){return be.toHandle(ze(e))},q:function(e){ne(be.toValue(e)),Te(e)},k:function(e,t){var n=(e=He(e,"_emval_take_value")).readValueFromPointer(t);return be.toHandle(n)},n:function(){H("")},h:function(e,t,n){return Je(e,t,n)},D:function(){return 2147483648},M:function(e,t,n){E.copyWithin(e,t,t+n)},C:function(e){var t,n,o=E.length,r=2147483648;if((e>>>=0)>r)return!1;for(var i=1;i<=4;i*=2){var a=o*(1+.2/i);if(a=Math.min(a,e+100663296),Qe(Math.min(r,(t=Math.max(e,a))+((n=65536)-t%n)%n)))return!0}return!1},H:function(e,t){var n=0;return tt().forEach((function(o,r){var i=t+n;b[e+4*r>>2]=i,function(e,t,n){for(var o=0;o<e.length;++o)A[0|t++]=e.charCodeAt(o);n||(A[0|t]=0)}(o,i),n+=o.length+1})),0},I:function(e,t){var n=tt();b[e>>2]=n.length;var o=0;return n.forEach((function(e){o+=e.length+1})),b[t>>2]=o,0},l:function(e){return 52},K:function(e,t,n,o){return 52},z:function(e,t,n,o,r){return 70},t:function(e,t,n,o){for(var r=0,i=0;i<n;i++){var a=b[t>>2],s=b[t+4>>2];t+=8;for(var l=0;l<s;l++)ot(e,E[a+l]);r+=s}return b[o>>2]=r,0},B:function(e,t,n,o,r){return st(e,t,n,o)}},dt=(function(){var e={a:ut};function t(e,t){var n,o=e.exports;r.asm=o,k((v=r.asm.Q).buffer),N=r.asm.T,n=r.asm.R,U.unshift(n),function(e){if(F--,r.monitorRunDependencies&&r.monitorRunDependencies(F),0==F&&(null!==q&&(clearInterval(q),q=null),j)){var t=j;j=null,t()}}()}function o(e){t(e.instance)}function i(t){return(m||!u&&!d||"function"!=typeof fetch?Promise.resolve().then((function(){return X(Y)})):fetch(Y,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Y+"'";return e.arrayBuffer()})).catch((function(){return X(Y)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){f("failed to asynchronously prepare wasm: "+e),H(e)}))}if(F++,r.monitorRunDependencies&&r.monitorRunDependencies(F),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){f("Module.instantiateWasm callback failed with error: "+e),n(e)}(m||"function"!=typeof WebAssembly.instantiateStreaming||Z(Y)||"function"!=typeof fetch?i(o):fetch(Y,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(o,(function(e){return f("wasm streaming compile failed: "+e),f("falling back to ArrayBuffer instantiation"),i(o)}))}))).catch(n)}(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.R).apply(null,arguments)},r._main=function(){return(r._main=r.asm.S).apply(null,arguments)},r._malloc=function(){return(dt=r._malloc=r.asm.U).apply(null,arguments)}),gt=r._free=function(){return(gt=r._free=r.asm.V).apply(null,arguments)},ht=r.___getTypeName=function(){return(ht=r.___getTypeName=r.asm.W).apply(null,arguments)},ft=(r.__embind_initialize_bindings=function(){return(r.__embind_initialize_bindings=r.asm.X).apply(null,arguments)},r.___cxa_is_pointer_type=function(){return(ft=r.___cxa_is_pointer_type=r.asm.Y).apply(null,arguments)});function mt(e){var t,n=r._main;try{var o=n(0,0);return y=t=o,lt(t),o}catch(e){return function(e){if(e instanceof K||"unwind"==e)return y;c(1,e)}(e)}}function pt(e){function n(){ct||(ct=!0,r.calledRun=!0,P||(J(U),J(W),t(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),vt&&mt(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),B.unshift(e);var e;J(B)}()))}e=e||s,F>0||(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),V.unshift(e);var e;J(V)}(),F>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),n()}),1)):n()))}if(r.dynCall_viij=function(){return(r.dynCall_viij=r.asm.Z).apply(null,arguments)},r.dynCall_vij=function(){return(r.dynCall_vij=r.asm._).apply(null,arguments)},r.dynCall_iij=function(){return(r.dynCall_iij=r.asm.$).apply(null,arguments)},r.dynCall_viji=function(){return(r.dynCall_viji=r.asm.aa).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.ba).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.ca).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.da).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.ea).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.fa).apply(null,arguments)},r.___start_em_js=638316,r.___stop_em_js=638383,j=function e(){ct||pt(),ct||(j=e)},r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var vt=!0;return r.noInitialRun&&(vt=!1),pt(),e.ready}),l=n.p+"17dd54813d5acc10bf8f.wasm";class c{constructor(){this._instance}get instance(){if(this._instance)return this._instance;throw new Error("ICRPolySeg is not initialized.")}async initialize(e={}){this._instance=await s({locateFile:e=>e.endsWith(".wasm")?l:e,...e})}}var u=n(92136),d=n(84441),g=n(27398),h=n(50906);const f={Forward:1,Backward:-1},m=new Set;const p={};function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,p,n),h.m.obj(e,t),h.m.algo(e,t,1,1),function(e,t){e.requestData=(t,n)=>{const[o]=t;n[0]||(n[0]=g.Ay.newInstance());const[r]=n;e.extractContours(o,r),r.modified()},e.traverseLoop=(e,t,n,o,r)=>{let i=n,a=o,s=!1,l=0;for(;!s;){const{cellPointIds:n}=e.getCellPoints(i);if(!n)continue;a=n[0]!==a?n[0]:n[1],l++;const c=t*l;r.push({t:c,ptId:a});const u=e.getPointCells(a);if(2!==u.length||a===o)return a;2===u.length?(i=u[0]!==i?u[0]:u[1],m.add(i)):s=!0}return a},e.extractContours=(t,n)=>{const o=[];m.clear();const r=t.getLines();n.getPoints().setData(Float32Array.from(t.getPoints().getData()));for(let n=0;n<r.getNumberOfCells();n++){if(m.has(n))continue;const{cellPointIds:r}=t.getCellPoints(n);if(!r)continue;m.add(n);const i=r[0],a=[];a.push({t:0,ptId:i}),i!==e.traverseLoop(t,f.Forward,n,i,a)&&(e.traverseLoop(t,f.Backward,n,i,a),a.sort(((e,t)=>e.t<t.t?-1:1)),a.length&&a[0].ptId!==a[a.length-1]?.ptId&&a.push({...a[a.length-1]})),a.length&&o.push(a)}const i=n.getLines();i.resize(0),o.forEach((e=>{i.insertNextCell(e.map((e=>e.ptId)))}))}}(e)}var w={newInstance:h.m.newInstance(v,"vtkContourLoopExtraction"),extend:v},y=n(64976),I=n(15306),A=n(74119),E=n(56634),T=n(84797);const S={polySeg:null,polySegInitializing:!1,polySegInitializingPromise:null,async initializePolySeg(e){this.polySegInitializing?await this.polySegInitializingPromise:this.polySeg?.instance||(this.polySegInitializing=!0,this.polySegInitializingPromise=new Promise((t=>{this.polySeg=new c,this.polySeg.initialize({updateProgress:e}).then((()=>{this.polySegInitializing=!1,t()}))})),await this.polySegInitializingPromise)},async convertContourToSurface(e,...t){const{polylines:n,numPointsArray:o}=e,[r]=t;await this.initializePolySeg(r);return await this.polySeg.instance.convertContourRoiToSurface(n,o)},async convertLabelmapToSurface(e,...t){const[n]=t;await this.initializePolySeg(n);return this.polySeg.instance.convertLabelmapToSurface(e.scalarData,e.dimensions,e.spacing,e.direction,e.origin,[e.segmentIndex])},async convertContourToVolumeLabelmap(e,...t){const[n]=t,o=await new c;await o.initialize({updateProgress:n});const{segmentIndices:r,scalarData:s,annotationUIDsInSegmentMap:l,dimensions:d,origin:g,direction:h,spacing:f}=e,m=u.utilities.VoxelManager.createVolumeVoxelManager(d,s),p=i.Ay.newInstance();p.setDimensions(d),p.setOrigin(g),p.setDirection(h),p.setSpacing(f);const v=a.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:s});p.getPointData().setScalars(v),p.modified();for(const e of r){const t=l.get(e);for(const n of t){if(!n.polyline)continue;const{polyline:t,holesPolyline:o}=n,r=(0,I.getBoundingBoxAroundShapeWorld)(t),[i,a,s]=u.utilities.transformWorldToIndex(p,[r[0][0],r[1][0],r[2][0]]),[l,c,d]=u.utilities.transformWorldToIndex(p,[r[0][1],r[1][1],r[2][1]]),{projectedPolyline:g,sharedDimensionIndex:h}=(0,E.projectTo2D)(t),f=o?.map((e=>{const{projectedPolyline:t}=(0,E.projectTo2D)(e);return t})),v=(h+1)%3,w=(h+2)%3;(0,A.pointInShapeCallback)(p,(e=>{const t=[e[v],e[w]];return(0,E.containsPoint)(g,t,{holes:f})}),(({pointIJK:t})=>{m.setAtIJKPoint(t,e)}),[[i,l],[a,c],[s,d]])}}return m.scalarData},async convertContourToStackLabelmap(e,...t){const[n]=t,o=await new c;await o.initialize({updateProgress:n});const{segmentationsInfo:r,annotationUIDsInSegmentMap:s,segmentIndices:l}=e,d=new Map;r.forEach(((e,t)=>{const{dimensions:n,scalarData:o,direction:r,spacing:s,origin:l}=e,c=u.utilities.VoxelManager.createVolumeVoxelManager(n,o),g=i.Ay.newInstance();g.setDimensions(n),g.setOrigin(l),g.setDirection(r),g.setSpacing(s);const h=a.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:o});g.getPointData().setScalars(h),g.modified(),d.set(t,{manager:c,imageData:g})}));for(const e of l){const t=s.get(e);for(const n of t){if(!n.polyline)continue;const{polyline:t,holesPolyline:o,referencedImageId:r}=n,i=(0,I.getBoundingBoxAroundShapeWorld)(t),{manager:a,imageData:s}=d.get(r),[l,c,g]=u.utilities.transformWorldToIndex(s,[i[0][0],i[1][0],i[2][0]]),[h,f,m]=u.utilities.transformWorldToIndex(s,[i[0][1],i[1][1],i[2][1]]),{projectedPolyline:p,sharedDimensionIndex:v}=(0,E.projectTo2D)(t),w=o?.map((e=>{const{projectedPolyline:t}=(0,E.projectTo2D)(e);return t})),y=(v+1)%3,T=(v+2)%3;(0,A.pointInShapeCallback)(s,(e=>{const t=[e[y],e[T]];return(0,E.containsPoint)(p,t,{holes:w})}),(({pointIJK:t})=>{a.setAtIJKPoint(t,e)}),[[l,h],[c,f],[g,m]])}}return r.forEach(((e,t)=>{const{manager:n}=d.get(t);e.scalarData=n.scalarData})),r},async convertSurfaceToVolumeLabelmap(e,...t){const[n]=t;await this.initializePolySeg(n);return this.polySeg.instance.convertSurfaceToLabelmap(e.points,e.polys,e.dimensions,e.spacing,e.direction,e.origin)},async convertSurfacesToVolumeLabelmap(e,...t){const[n]=t;await this.initializePolySeg(n);const{segmentsInfo:o}=e,r=Array.from(o.keys()).map((t=>{const{points:n,polys:r}=o.get(t);return{...this.polySeg.instance.convertSurfaceToLabelmap(n,r,e.dimensions,e.spacing,e.direction,e.origin),segmentIndex:t}})),s=await Promise.all(r),l=i.Ay.newInstance();l.setDimensions(e.dimensions),l.setOrigin(e.origin),l.setSpacing(e.spacing),l.setDirection(e.direction);const c=e.dimensions[0]*e.dimensions[1]*e.dimensions[2],d=a.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:new Uint8Array(c)});l.getPointData().setScalars(d),l.modified();const g=u.utilities.VoxelManager.createVolumeVoxelManager(e.dimensions,l.getPointData().getScalars().getData()),h=s.map((e=>{const{data:t,dimensions:n,direction:o,origin:r,spacing:s}=e,l=i.Ay.newInstance();l.setDimensions(n),l.setOrigin(r),l.setSpacing(s),l.setDirection(o);const c=a.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:t});l.getPointData().setScalars(c),l.modified();const d=u.utilities.VoxelManager.createVolumeVoxelManager(n,t),g=l.getExtent();return{volume:l,voxelManager:d,extent:g,scalarData:t,segmentIndex:e.segmentIndex}}));return(0,A.pointInShapeCallback)(l,(()=>!0),(({pointIJK:e,pointLPS:t})=>{try{for(const n of h){const{volume:o,extent:r,voxelManager:i,segmentIndex:a}=n,s=o.worldToIndex(t);if(s[0]<r[0]||s[0]>r[1]||s[1]<r[2]||s[1]>r[3]||s[2]<r[4]||s[2]>r[5])continue;const l=s.map(Math.round);if(i.getAtIJK(...l)>0){g.setAtIJKPoint(e,a);break}}}catch(e){}})),g.scalarData},getSurfacesAABBs({surfacesInfo:e}){const t=new Map;for(const{points:n,id:o}of e){const e=(0,E.getAABB)(n,{numDimensions:3});t.set(o,e)}return t},cutSurfacesIntoPlanes({planesInfo:e,surfacesInfo:t,surfacesAABB:n=new Map},o,r){const i=e.length,a=y.Ay.newInstance(),s=d.Ay.newInstance();a.setCutFunction(s);const l=g.Ay.newInstance();try{for(const[c,u]of e.entries()){const{sliceIndex:e,planes:d}=u,g=new Map;for(const e of t){const{points:t,polys:o,id:r}=e,i=n.get(r)||(0,E.getAABB)(t,{numDimensions:3});n.has(r)||n.set(r,i);const{minX:c,minY:u,minZ:h,maxX:f,maxY:m,maxZ:p}=i,{origin:v,normal:y}=d[0];if(!(0,T.isPlaneIntersectingAABB)(v,y,c,u,h,f,m,p))continue;l.getPoints().setData(t,3),l.getPolys().setData(o,3),l.modified(),a.setInputData(l),s.setOrigin(v),s.setNormal(y);try{a.update()}catch(e){console.warn("Error during clipping",e);continue}const I=a.getOutputData(),A=I;A.buildLinks();const S=w.newInstance();S.setInputData(A);const x=S.getOutputData();I&&g.set(r,{points:x.getPoints().getData(),lines:x.getLines().getData(),numberOfCells:x.getLines().getNumberOfCells()})}o({progress:(c+1)/i}),r({sliceIndex:e,polyDataResults:g})}}catch(e){console.warn("Error during processing",e)}finally{t=null,s.delete()}}};(0,r.p)(S)},51250:(e,t,n)=>{n.d(t,{Ay:()=>h});var o=n(50906),r=n(68680),i=n(52662),a=n(32090),s=n(89780),l=n(13422),c=n(44753);const{vtkErrorMacro:u}=o.m;const d={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:l.e.EMPTY};function g(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,d,n),a.Ay.extend(e,t,n),t.direction?Array.isArray(t.direction)&&(t.direction=new Float64Array(t.direction.slice(0,9))):t.direction=c.w0.identity(new Float64Array(9)),t.indexToWorld=new Float64Array(16),t.worldToIndex=new Float64Array(16),o.m.get(e,t,["indexToWorld","worldToIndex"]),o.m.setGetArray(e,t,["origin","spacing"],3),o.m.setGetArray(e,t,["direction"],9),o.m.getArray(e,t,["extent"],6),function(e,t){t.classHierarchy.push("vtkImageData"),e.setExtent=function(){if(t.deleted)return u("instance deleted - cannot call any method"),!1;for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];const i=1===o.length?o[0]:o;if(6!==i.length)return!1;const a=t.extent.some(((e,t)=>e!==i[t]));return a&&(t.extent=i.slice(),t.dataDescription=s.A.getDataDescriptionFromExtent(t.extent),e.modified()),a},e.setDimensions=function(){let n,o,r;if(t.deleted)u("instance deleted - cannot call any method");else{if(1===arguments.length){const e=arguments.length<=0?void 0:arguments[0];n=e[0],o=e[1],r=e[2]}else{if(3!==arguments.length)return void u("Bad dimension specification");n=arguments.length<=0?void 0:arguments[0],o=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2]}e.setExtent(0,n-1,0,o-1,0,r-1)}},e.getDimensions=()=>[t.extent[1]-t.extent[0]+1,t.extent[3]-t.extent[2]+1,t.extent[5]-t.extent[4]+1],e.getNumberOfCells=()=>{const t=e.getDimensions();let n=1;for(let e=0;e<3;e++){if(0===t[e])return 0;t[e]>1&&(n*=t[e]-1)}return n},e.getNumberOfPoints=()=>{const t=e.getDimensions();return t[0]*t[1]*t[2]},e.getPoint=n=>{const o=e.getDimensions();if(0===o[0]||0===o[1]||0===o[2])return u("Requesting a point from an empty image."),null;const r=new Float64Array(3);switch(t.dataDescription){case l.e.EMPTY:return null;case l.e.SINGLE_POINT:break;case l.e.X_LINE:r[0]=n;break;case l.e.Y_LINE:r[1]=n;break;case l.e.Z_LINE:r[2]=n;break;case l.e.XY_PLANE:r[0]=n%o[0],r[1]=n/o[0];break;case l.e.YZ_PLANE:r[1]=n%o[1],r[2]=n/o[1];break;case l.e.XZ_PLANE:r[0]=n%o[0],r[2]=n/o[0];break;case l.e.XYZ_GRID:r[0]=n%o[0],r[1]=n/o[0]%o[1],r[2]=n/(o[0]*o[1]);break;default:u("Invalid dataDescription")}const i=[0,0,0];return e.indexToWorld(r,i),i},e.getBounds=()=>e.extentToBounds(e.getSpatialExtent()),e.extentToBounds=e=>i.Ay.transformBounds(e,t.indexToWorld),e.getSpatialExtent=()=>i.Ay.inflate([...t.extent],.5),e.computeTransforms=()=>{c.pB.fromTranslation(t.indexToWorld,t.origin),t.indexToWorld[0]=t.direction[0],t.indexToWorld[1]=t.direction[1],t.indexToWorld[2]=t.direction[2],t.indexToWorld[4]=t.direction[3],t.indexToWorld[5]=t.direction[4],t.indexToWorld[6]=t.direction[5],t.indexToWorld[8]=t.direction[6],t.indexToWorld[9]=t.direction[7],t.indexToWorld[10]=t.direction[8],c.pB.scale(t.indexToWorld,t.indexToWorld,t.spacing),c.pB.invert(t.worldToIndex,t.indexToWorld)},e.indexToWorld=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.eR.transformMat4(n,e,t.indexToWorld),n},e.indexToWorldVec3=e.indexToWorld,e.worldToIndex=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.eR.transformMat4(n,e,t.worldToIndex),n},e.worldToIndexVec3=e.worldToIndex,e.indexToWorldBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return i.Ay.transformBounds(e,t.indexToWorld,n)},e.worldToIndexBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return i.Ay.transformBounds(e,t.worldToIndex,n)},e.onModified(e.computeTransforms),e.computeTransforms(),e.getCenter=()=>i.Ay.getCenter(e.getBounds()),e.computeHistogram=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=[0,0,0,0,0,0];e.worldToIndexBounds(t,o);const a=[0,0,0],s=[0,0,0];i.Ay.computeCornerPoints(o,a,s),(0,r.b)(a,a),(0,r.b)(s,s);const l=e.getDimensions();(0,r.c)(a,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],a),(0,r.c)(s,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],s);const c=l[0],u=l[0]*l[1],d=e.getPointData().getScalars().getData();let g=-1/0,h=1/0,f=0,m=0,p=0;for(let e=a[2];e<=s[2];e++)for(let t=a[1];t<=s[1];t++){let r=a[0]+t*c+e*u;for(let i=a[0];i<=s[0];i++){if(!n||n([i,t,e],o)){const e=d[r];e>g&&(g=e),e<h&&(h=e),f+=e*e,m+=e,p+=1}++r}}const v=p>0?m/p:0,w=p?Math.abs(f/p-v*v):0;return{minimum:h,maximum:g,average:v,variance:w,sigma:Math.sqrt(w),count:p}},e.computeIncrements=function(e){const t=[];let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let o=0;o<3;++o)t[o]=n,n*=e[2*o+1]-e[2*o]+1;return t},e.computeOffsetIndex=t=>{let[n,o,r]=t;const i=e.getExtent(),a=e.getPointData().getScalars().getNumberOfComponents(),s=e.computeIncrements(i,a);return Math.floor((Math.round(n)-i[0])*s[0]+(Math.round(o)-i[2])*s[1]+(Math.round(r)-i[4])*s[2])},e.getOffsetIndexFromWorld=t=>{const n=e.getExtent(),o=e.worldToIndex(t);for(let e=0;e<3;++e)if(o[e]<n[2*e]||o[e]>n[2*e+1])return u(`GetScalarPointer: Pixel ${o} is not in memory. Current extent = ${n}`),NaN;return e.computeOffsetIndex(o)},e.getScalarValueFromWorld=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=e.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=o)return u(`GetScalarPointer: Scalar Component ${n} is not within bounds. Current Scalar numberOfComponents: ${o}`),NaN;const r=e.getOffsetIndexFromWorld(t);return Number.isNaN(r)?r:e.getPointData().getScalars().getComponent(r,n)}}(e,t)}var h={newInstance:o.m.newInstance(g,"vtkImageData"),extend:g}},52754:(e,t,n)=>{var o=n(50906),r=n(27398),i=n(23410),a=n(68749);const{vtkErrorMacro:s,vtkDebugMacro:l}=o.m;function c(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=n=>{t.contourValues=n,e.modified()};const n=[],o=[],c=[],u=i.A.newInstance();e.getPixelScalars=(e,t,r,i,a,s)=>{const[l,c,u]=e;n[0]=u*t[1]*t[0]+c*t[0]+l,n[1]=n[0]+i[a],n[2]=n[0]+i[s],n[3]=n[2]+i[a];for(let e=0;e<4;++e)o[e]=r[n[e]]},e.getPixelPoints=(e,t,n,o,r)=>{const i=e[o],a=e[r];c[0]=t[o]+i*n[o],c[1]=t[r]+a*n[r],c[2]=c[0]+n[o],c[3]=c[1],c[4]=c[0],c[5]=c[1]+n[r],c[6]=c[2],c[7]=c[5]},e.produceLines=(r,i,s,l,d,g,h,f,m,p,v)=>{const w=i[t.slicingMode],y=[1,2,8,4],I=[];let A;e.getPixelScalars(i,s,g,m,p,v);let E=0;for(let e=0;e<4;e++)o[e]>=r&&(E|=y[e]);const T=a.A.getCase(E);if(T[0]<0)return;e.getPixelPoints(i,l,d,p,v);const S=l[t.slicingMode]+w*d[t.slicingMode];for(let e=0;T[e]>=0;e+=2){f.push(2);for(let i=0;i<2;i++){const s=a.A.getEdge(T[e+i]);if(A=void 0,t.mergePoints&&(A=u.isInsertedEdge(n[s[0]],n[s[1]])?.value),void 0===A){const e=(r-o[s[0]])/(o[s[1]]-o[s[0]]),i=c.slice(2*s[0],2*(s[0]+1)),a=c.slice(2*s[1],2*(s[1]+1));I[p]=i[0]+e*(a[0]-i[0]),I[v]=i[1]+e*(a[1]-i[1]),I[t.slicingMode]=S,A=h.length/3,h.push(I[0],I[1],I[2]),t.mergePoints&&u.insertEdge(n[s[0]],n[s[1]],A)}f.push(A)}}},e.requestData=(n,o)=>{const i=n[0];if(!i)return void s("Invalid or missing input");if(null==t.slicingMode||t.slicingMode<0||t.slicingMode>2)return void s("Invalid or missing slicing mode");console.time("msquares");const a=i.getOrigin(),c=i.getSpacing(),d=i.getDimensions(),g=i.getExtent(),h=i.computeIncrements(g),f=i.getPointData().getScalars().getData(),[m,p]=function(){let e=0,n=1;return 1===t.slicingMode?(e=0,n=2):0===t.slicingMode&&(e=1,n=2),[e,n]}(),v=[],w=[];let y=Math.round(t.slice);y>=d[t.slicingMode]&&(y=0);const I=[0,0,0];I[t.slicingMode]=y;for(let n=0;n<t.contourValues.length;++n){for(let o=0;o<d[p]-1;++o){I[p]=o;for(let o=0;o<d[m]-1;++o)I[m]=o,e.produceLines(t.contourValues[n],I,d,a,c,f,v,w,h,m,p)}u.initialize()}const A=r.Ay.newInstance();A.getPoints().setData(new Float32Array(v),3),A.getLines().setData(new Uint32Array(w)),o[0]=A,l("Produced output"),console.timeEnd("msquares")}}const u={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,u,n),o.m.obj(e,t),o.m.algo(e,t,1,1),o.m.setGet(e,t,["slicingMode","slice","mergePoints"]),o.m.algo(e,t,1,1),c(e,t)}o.m.newInstance(d,"vtkImageMarchingSquares")},99178:(e,t,n)=>{n.d(t,{A2:()=>i,BX:()=>I,LV:()=>g,p:()=>u});const o=Symbol("Comlink.proxy"),r=Symbol("Comlink.endpoint"),i=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,c=new Map([["proxy",{canHandle:e=>l(e)&&e[o],serialize(e){const{port1:t,port2:n}=new MessageChannel;return u(e,t),[n,[n]]},deserialize:e=>(e.start(),g(e))}],["throw",{canHandle:e=>l(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function u(e,t=globalThis,n=["*"]){t.addEventListener("message",(function o(r){if(!r||!r.data)return;if(!function(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,r.origin))return void console.warn(`Invalid origin '${r.origin}' for comlink proxy`);const{id:i,type:l,path:c}=Object.assign({path:[]},r.data),g=(r.data.argumentList||[]).map(E);let h;try{const t=c.slice(0,-1).reduce(((e,t)=>e[t]),e),n=c.reduce(((e,t)=>e[t]),e);switch(l){case"GET":h=n;break;case"SET":t[c.slice(-1)[0]]=E(r.data.value),h=!0;break;case"APPLY":h=n.apply(t,g);break;case"CONSTRUCT":h=I(new n(...g));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;u(e,n),h=function(e,t){return y.set(e,t),e}(t,[t])}break;case"RELEASE":h=void 0;break;default:return}}catch(e){h={value:e,[s]:0}}Promise.resolve(h).catch((e=>({value:e,[s]:0}))).then((n=>{const[r,s]=A(n);t.postMessage(Object.assign(Object.assign({},r),{id:i}),s),"RELEASE"===l&&(t.removeEventListener("message",o),d(t),a in e&&"function"==typeof e[a]&&e[a]())})).catch((e=>{const[n,o]=A({value:new TypeError("Unserializable return value"),[s]:0});t.postMessage(Object.assign(Object.assign({},n),{id:i}),o)}))})),t.start&&t.start()}function d(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function g(e,t){return v(e,[],t)}function h(e){if(e)throw new Error("Proxy has been released and is not useable")}function f(e){return T(e,{type:"RELEASE"}).then((()=>{d(e)}))}const m=new WeakMap,p="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(m.get(e)||0)-1;m.set(e,t),0===t&&f(e)}));function v(e,t=[],n=function(){}){let o=!1;const a=new Proxy(n,{get(n,r){if(h(o),r===i)return()=>{!function(e){p&&p.unregister(e)}(a),f(e),o=!0};if("then"===r){if(0===t.length)return{then:()=>a};const n=T(e,{type:"GET",path:t.map((e=>e.toString()))}).then(E);return n.then.bind(n)}return v(e,[...t,r])},set(n,r,i){h(o);const[a,s]=A(i);return T(e,{type:"SET",path:[...t,r].map((e=>e.toString())),value:a},s).then(E)},apply(n,i,a){h(o);const s=t[t.length-1];if(s===r)return T(e,{type:"ENDPOINT"}).then(E);if("bind"===s)return v(e,t.slice(0,-1));const[l,c]=w(a);return T(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:l},c).then(E)},construct(n,r){h(o);const[i,a]=w(r);return T(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:i},a).then(E)}});return function(e,t){const n=(m.get(t)||0)+1;m.set(t,n),p&&p.register(e,t,e)}(a,e),a}function w(e){const t=e.map(A);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const y=new WeakMap;function I(e){return Object.assign(e,{[o]:!0})}function A(e){for(const[t,n]of c)if(n.canHandle(e)){const[o,r]=n.serialize(e);return[{type:"HANDLER",name:t,value:o},r]}return[{type:"RAW",value:e},y.get(e)||[]]}function E(e){switch(e.type){case"HANDLER":return c.get(e.name).deserialize(e.value);case"RAW":return e.value}}function T(e,t,n){return new Promise((o=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===r&&(e.removeEventListener("message",t),o(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:r},t),n)}))}},1201:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(89370),r=n(43768);function i(e){let t,n,i;function s(e,o,r=0,i=e.length){if(r<i){if(0!==t(o,o))return i;do{const t=r+i>>>1;n(e[t],o)<0?r=t+1:i=t}while(r<i)}return r}return 2!==e.length?(t=o.A,n=(t,n)=>(0,o.A)(e(t),n),i=(t,n)=>e(t)-n):(t=e===o.A||e===r.A?e:a,n=e,i=e),{left:s,center:function(e,t,n=0,o=e.length){const r=s(e,t,n,o-1);return r>n&&i(e[r-1],t)>-i(e[r],t)?r-1:r},right:function(e,o,r=0,i=e.length){if(r<i){if(0!==t(o,o))return i;do{const t=r+i>>>1;n(e[t],o)<=0?r=t+1:i=t}while(r<i)}return r}}}function a(){return 0}}}]);
//# sourceMappingURL=164.bundle.ab28621e569cd0e68db4.js.map