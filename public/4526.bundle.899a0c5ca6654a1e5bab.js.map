{"version":3,"file":"4526.bundle.899a0c5ca6654a1e5bab.js","mappings":"uJAMA,QANA,SAAuCA,EAAkBC,EAAsBC,GAC7E,MAAMC,EAAQF,EAAqBG,iBAAiB,oCAEpD,OAAOJ,EAAiBK,2BAA2BH,EAAaC,EAClE,ECJMG,EAAW,CACfC,UAAW,EACXC,OAAQ,EACRC,YAAa,GAiFf,QA9EA,UAA0B,gBACxBC,EAAe,cACfC,EAAa,WACbC,EAAU,oBACVC,EAAmB,gBACnBC,IAEA,MAAM,wBAAEC,EAAuB,qBAAEd,GAAyBS,EAAgBM,SAEpEC,EADmBP,EAAgBQ,kBACNC,WAEnC,OAAO,IAAIC,SAAQC,eAAgBC,EAASC,GAC1C,MAAMC,EAAeP,GAAWQ,2BAC5BnB,EAASG,kBAoBjB,SACEM,EACAd,EACAW,GAEA,OAAO,IAAIQ,SAAQ,SAAUE,EAASC,GACpC,MAAMG,EAAUzB,EAAqBG,iBAAiB,0CAChDuB,EAAU,CACd,CACEC,GAAI,aACJC,KAAM,YACNC,KAAM,KACNC,MAAOzB,EAASE,QAElB,CACEoB,GAAI,cACJC,KAAM,UACNC,KAAM,MACNC,MAAOzB,EAASG,cAGduB,EAAWC,IACflB,EAAwBmB,OACxBZ,EAAQW,EAAO,EAGjBlB,EAAwBoB,KAAK,CAC3BvB,aACAiB,KAAM,OACNH,UACAC,UACAK,WACAI,eAAgBA,KACdrB,EAAwBmB,OACxBZ,EAAQhB,EAASE,OAAO,EAE1B6B,WAAYC,IACQ,UAAdA,EAAMC,KACRP,EAAS1B,EAASG,YACpB,GAGN,GACF,CA9Dc+B,CAAYzB,EAAyBd,EAAsBW,GAEjEY,IAAiBlB,EAASG,cAC5BI,GAAqB4B,SAAQC,IAC3BA,GAAU,IAGZC,OAAOC,YAAWvB,UAChB,MAAMwB,QAAmB/B,EAAgB,CACvCH,gBACAC,eAGFU,EAAQuB,EAAW,GAClB,GAEP,GACF,EChCe,SAASC,GAAoB,WAAED,EAAU,cAAEE,IACxD,IAAIC,EAAiB,KACjBC,EAAa,KAEjB,OAAQJ,GACN,KAAK,EACHI,EAAaA,IAAMC,EAAAA,cAACC,EAAAA,IAAMC,OAAM,CAACC,KAAK,iBACtCL,EAAiBA,IAAME,EAAAA,cAAA,WAAK,yDAC5B,MACF,KAAK,EACHD,EAAaA,IACXC,EAAAA,cAACC,EAAAA,IAAMC,OAAM,CACXE,UAAU,gCACVD,KAAK,qBAGTL,EAAiBA,IAAME,EAAAA,cAAA,WAAK,oCAGhC,MAAMK,EAAaA,KACjB,MAAM,EAAEC,IAAMC,EAAAA,EAAAA,IAAe,UACvBC,EAAUF,EAAE,QAElB,OACEN,EAAAA,cAAA,OAAKI,UAAU,wDACbJ,EAAAA,cAAA,OAAKI,UAAU,+EACbJ,EAAAA,cAACD,EAAU,MACXC,EAAAA,cAAA,QAAMI,UAAU,QAAO,SAEvBT,GACAK,EAAAA,cAACS,EAAAA,IAAoB,CAACC,cAAeb,GAAgBW,GAEnD,EAIV,OACER,EAAAA,cAAAA,EAAAA,SAAA,KACGF,GACCE,EAAAA,cAACW,EAAAA,IAAO,KACNX,EAAAA,cAACY,EAAAA,IAAc,CAACC,SAAO,GACrBb,EAAAA,cAAA,YACEA,EAAAA,cAACK,EAAU,QAGfL,EAAAA,cAACc,EAAAA,IAAc,CAACC,KAAK,UACnBf,EAAAA,cAACF,EAAc,SAInBA,GAAkBE,EAAAA,cAACK,EAAU,MAGrC,C,iPC6VA,QA1YA,SAAoCW,GAClC,MAAM,SACJC,EAAQ,YACRC,EAAW,gBACXC,EAAe,gBACf3D,EAAe,iBACf4D,EAAgB,gBAChBC,GACEL,GAEE,EAAEV,IAAMC,EAAAA,EAAAA,IAAe,eACvB7C,EAAayD,EAAgBzD,YAE7B,kBACJ4D,EAAiB,iBACjBC,EAAgB,oBAChBC,EAAmB,qBACnBzE,EAAoB,6BACpB0E,GACEjE,EAAgBM,SAEd4D,EAA+B3E,EAAqBG,iBACxD,mCAGIF,EAAc,gBAA8BU,IAGlD,GAAIwD,EAAYS,OAAS,EACvB,MAAM,IAAIC,MAAM,sDAGlB,MAAMnE,EAAgByD,EAAY,IAC3BW,EAAcC,IAAuBC,EAAAA,EAAAA,QAItC,wBAAEC,IAA4BC,EAAAA,EAAAA,iCAO7BtC,EAAYuC,IAAiBC,EAAAA,EAAAA,UAAS1E,EAAckC,aACpDyC,EAAcC,IAAmBF,EAAAA,EAAAA,WAAU1E,EAAc6E,WACzDC,EAASC,IAAcL,EAAAA,EAAAA,UAAS,OAChCM,EAAoBC,IAAyBP,EAAAA,EAAAA,UAAS,CAC3DQ,gBAAiB,KACjBC,cAAe,OAIXC,GAA0BC,EAAAA,EAAAA,QAAO,OAEjC,UAAEC,EAAS,iBAAEC,GAAqBnB,EAElCoB,EAAkCxF,EAAcwF,gCAChDC,EAAuB5B,EAAkB6B,mBAC7CF,GAGIG,EA2SR,SAA0CF,EAAsBzF,GAC9D,MAAM,+BAAE4F,GAAmC5F,EAAc6F,SAEnDC,EAAwBC,MAAMC,QAAQJ,GACxCA,EAA+B,GAC/BA,GAEE,sBAAEK,GAA0BH,EAE5BI,EAAgBH,MAAMC,QAAQC,GAChCA,EAAsB,GACtBA,GAEE,qBAAEE,EAAoB,eAAEC,GAAmBF,EAE3CG,EAASZ,EAAqBa,OAAO,GACrCX,EAA+B,CACnCY,UAAWF,EAAOE,UAClBC,YAAaH,EAAOG,YACpBC,WAAYJ,EAAOI,WACnBC,WAAYL,EAAOK,WACnBN,eAAgBC,EAAOD,gBAAkBA,EACzCO,UAAWN,EAAOM,UAClBC,kBAAmBP,EAAOO,kBAC1BC,kBAAmBR,EAAOQ,kBAC1BC,aAAcT,EAAOS,aACrBC,sBAAuBV,EAAOU,sBAC9BZ,qBAAsBE,EAAOF,sBAAwBA,GAGvD,OAAOR,CACT,CA1UuCqB,CACnCvB,EACAzF,GAGFoF,EAAwB6B,QAAU,CAChCC,WAAYzB,EACZ0B,SAAUxB,GAQZ,MAIMyB,EAAoBA,KACxBrC,EAAW,KAAK,EAGZsC,GAAyBC,EAAAA,EAAAA,cAAY,KACzClD,GAAckB,UAAUxD,SAAQ,EAAG7B,iBACjC2D,EAAgB2D,WAAW,oBAAqB,CAC9CtH,cACA,GACF,GACD,CAACmE,IAEEoD,GAAyBF,EAAAA,EAAAA,cAAY,KACzC,MAAQG,UAAWC,GAAc/D,EAAiBgE,eAChD,0DAIF,OACEpF,EAAAA,cAACmF,EAASE,EAAA,GACJrE,EAAK,CACTE,YAAa,CAACzD,GACd0D,gBAAiB,CACfmE,aAAcnE,EAAgBmE,aAC9BtI,YAAaA,EACbuI,YAAapE,EAAgBoE,YAC7B7H,WAAYyD,EAAgBzD,WAC5B8H,gBAAiBrE,EAAgBqE,iBAEnCC,iBAAkBC,IAChB1E,EAAMyE,mBAAmBC,GAlCRA,KACvBlD,EAAWkD,EAAIC,OAAOpD,QAAQ,EAkCxBkD,CAAiBC,EAAI,EAEvBb,kBAAmBA,IACR,GAEd,CAACnH,EAAYD,EAAeT,IAEzB4I,GAAkBb,EAAAA,EAAAA,cACtBc,IACEC,EAAAA,MAAMC,oBAAoB,CACxBF,YACApI,cAAeA,EACfC,aACAsI,2BAzFqC,EA0FrCxE,uBACA,GAEJ,CA7FyC,IAgGrCyE,GAAalB,EAAAA,EAAAA,cAAY,KAI7B1D,EAAgB2D,WAAW,uCAAwC,CACjEL,WAAYlH,EACZkB,KAAMuH,EAAAA,4BAA4BC,WAMpC9E,EAAgB2D,WAAW,mCAAoC,CAC7DtH,aACA0I,sBAAuBlD,EAAqBkD,wBAG9C/E,EAAgB2D,WAAW,yCAA0C,CACnEtH,aACA2I,uBAAwB,CAACnD,EAAqBkD,wBAC9C,GACD,CAAC/E,EAAiB3D,EAAYwF,EAAsBzF,KAEvD6I,EAAAA,EAAAA,YAAU,KACJlE,GAIJmE,EAAiB,CACf/I,kBACAE,aACAD,gBACAE,oBAAqB,CAACmH,GACtBlH,gBAAiBqI,IAChBO,MAAK7G,IACFA,GACFuC,GAAc,EAChB,GACA,GACD,CAAC1E,EAAiBE,EAAYD,EAAe2E,EAAc6D,KAE9DK,EAAAA,EAAAA,YAAU,KAER9E,EAAoBiF,iCAAiC/I,GAErD,MAAM,YAAEgJ,GAAgBlF,EAAoBmF,UAC1CnF,EAAoBoF,OAAOC,+BAC3BnB,IAKE,GAJIA,EAAIjI,cAAc2I,wBAA0B3I,EAAc2I,uBAC5D/D,GAAgB,GAGd5E,GAAeqJ,4BAA8B3F,GAAiBqE,gBAAiB,CACjF,MAAM,2BAAEsB,GAA+BrJ,GACjC,gBAAE+H,GAAoBrE,EAE5Ba,EAAwBwD,EAAgBuB,uBAAwB,CAC9DC,cAAe,CACbC,kBAAmBH,IAGzB,KAIJ,MAAO,KACLJ,GAAa,CACd,GACA,CAACjJ,KAEJ6I,EAAAA,EAAAA,YAAU,KACR,MAAM,YAAEI,GAAgBlF,EAAoBmF,UAC1CnF,EAAoBoF,OAAOM,0BAC3B,EAAGvE,kBAAiBwE,kBAClBzE,EAAsB,CACpBC,kBACAC,cAAeuE,GACf,IAIN,MAAO,KACLT,GAAa,CACd,GACA,CAACjJ,KAKJ6I,EAAAA,EAAAA,YAAU,KACR,MAAMc,EAAmC9F,EAAkBqF,UACzDrF,EAAkBsF,OAAOS,sBACzB,EAAGhB,6BACD,MAAMiB,EAAiBvE,EAAUwE,IAAIvE,GACjCqD,EAAuBmB,SAASF,EAAelB,wBACjDtE,EAAoB2F,0BAA0B,CAC5C/J,WAAYsF,EACZqD,uBAAwB,IAE5B,IAIJ,MAAO,KACLe,EAAiCV,aAAa,CAC/C,GACA,KAEHJ,EAAAA,EAAAA,YAAU,KACR,IAAIoB,EAAYnG,EAAiBoG,aAAa3K,GAE9C,IAAI0K,EAmBJ,OAbArG,EAAgB2D,WAAW,uCAAwC,CACjEL,WAAYlH,EACZkB,KAAMuH,EAAAA,4BAA4BC,WAKpC3E,EAAoBiF,iCAAiC/I,GAIrDgK,EAAYE,EAA8BrG,EAAkBxE,EAAsBC,GAE3E,KAGLwE,EAAoBiF,iCAAiC/I,GAGrD6D,EAAiBsG,iBAAiB7K,EAAY,CAC/C,GACA,IAEH,MAAM6C,GAAgBkF,EAAAA,EAAAA,cAAY5G,UAOhC2G,IACAmB,GAAY,GACX,CAACnB,EAAwBmB,KAE5BK,EAAAA,EAAAA,YAAU,KACR7E,EAA6BqG,cAAc,CACzC,CACEpK,aACAgB,GAAI,0BACJwG,UAAWtF,EAAoB,CAC7BD,aACAE,kBAEFkI,eAAgB,IAChBC,SAAUvG,EAA6BwG,UAAUC,SAEnD,CACExK,aACAgB,GAAI,gCACJwG,UACElF,EAAAA,cAACmI,EAAAA,IAAoB,CACnB9I,IAAI,eACJ+I,cAAexC,EACfxF,UACE1C,IAAesF,EAAmB,UAAY,uCAIpD+E,cAAe,EACfC,SAAUvG,EAA6BwG,UAAUI,WAEnD,GACD,CACDrF,EACArD,EACAiG,EACA/F,EACA4B,EACA/D,IAIF,IAAI4K,EAAoB,KAExB,OACGzF,EAAwB6B,SACzBxB,EAAqBkD,wBACnBvD,EAAwB6B,QAAQC,WAAWyB,uBAK3CnF,GAAYA,EAASU,SACvB2G,EAAoBrH,EAASsH,KAAI,CAACC,EAAOC,IAErCD,GACAxI,EAAAA,aAAmBwI,EAAO,CACxB9K,aACA2B,IAAKoJ,OAOXzI,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,OAAKI,UAAU,wDACZgC,GACCpC,EAAAA,cAAC0B,EAA4B,CAC3BtB,UAAU,gBACVsI,aAAcjG,EAAmBG,cACjCD,gBAAiBF,EAAmBE,gBACpCgG,YAAY,mBAGf1D,IACAqD,KA3BE,IA+BX,C","sources":["webpack:///../../../extensions/cornerstone-dicom-seg/src/utils/initSEGToolGroup.ts","webpack:///../../../extensions/cornerstone-dicom-seg/src/utils/promptHydrateSEG.ts","webpack:///../../../extensions/cornerstone-dicom-seg/src/viewports/_getStatusComponent.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/viewports/OHIFCornerstoneSEGViewport.tsx"],"sourcesContent":["function createSEGToolGroupAndAddTools(ToolGroupService, customizationService, toolGroupId) {\r\n  const tools = customizationService.getCustomization('cornerstone.overlayViewportTools');\r\n\r\n  return ToolGroupService.createToolGroupAndAddTools(toolGroupId, tools);\r\n}\r\n\r\nexport default createSEGToolGroupAndAddTools;\r\n","const RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  HYDRATE_SEG: 5,\r\n};\r\n\r\nfunction promptHydrateSEG({\r\n  servicesManager,\r\n  segDisplaySet,\r\n  viewportId,\r\n  preHydrateCallbacks,\r\n  hydrateCallback,\r\n}: withAppTypes) {\r\n  const { uiViewportDialogService, customizationService } = servicesManager.services;\r\n  const extensionManager = servicesManager._extensionManager;\r\n  const appConfig = extensionManager._appConfig;\r\n\r\n  return new Promise(async function (resolve, reject) {\r\n    const promptResult = appConfig?.disableConfirmationPrompts\r\n      ? RESPONSE.HYDRATE_SEG\r\n      : await _askHydrate(uiViewportDialogService, customizationService, viewportId);\r\n\r\n    if (promptResult === RESPONSE.HYDRATE_SEG) {\r\n      preHydrateCallbacks?.forEach(callback => {\r\n        callback();\r\n      });\r\n\r\n      window.setTimeout(async () => {\r\n        const isHydrated = await hydrateCallback({\r\n          segDisplaySet,\r\n          viewportId,\r\n        });\r\n\r\n        resolve(isHydrated);\r\n      }, 0);\r\n    }\r\n  });\r\n}\r\n\r\nfunction _askHydrate(\r\n  uiViewportDialogService: AppTypes.UIViewportDialogService,\r\n  customizationService: AppTypes.CustomizationService,\r\n  viewportId\r\n) {\r\n  return new Promise(function (resolve, reject) {\r\n    const message = customizationService.getCustomization('viewportNotification.hydrateSEGMessage');\r\n    const actions = [\r\n      {\r\n        id: 'no-hydrate',\r\n        type: 'secondary',\r\n        text: 'No',\r\n        value: RESPONSE.CANCEL,\r\n      },\r\n      {\r\n        id: 'yes-hydrate',\r\n        type: 'primary',\r\n        text: 'Yes',\r\n        value: RESPONSE.HYDRATE_SEG,\r\n      },\r\n    ];\r\n    const onSubmit = result => {\r\n      uiViewportDialogService.hide();\r\n      resolve(result);\r\n    };\r\n\r\n    uiViewportDialogService.show({\r\n      viewportId,\r\n      type: 'info',\r\n      message,\r\n      actions,\r\n      onSubmit,\r\n      onOutsideClick: () => {\r\n        uiViewportDialogService.hide();\r\n        resolve(RESPONSE.CANCEL);\r\n      },\r\n      onKeyPress: event => {\r\n        if (event.key === 'Enter') {\r\n          onSubmit(RESPONSE.HYDRATE_SEG);\r\n        }\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nexport default promptHydrateSEG;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ViewportActionButton } from '@ohif/ui-next';\r\nimport { Icons, Tooltip, TooltipTrigger, TooltipContent } from '@ohif/ui-next';\r\n\r\nexport default function _getStatusComponent({ isHydrated, onStatusClick }) {\r\n  let ToolTipMessage = null;\r\n  let StatusIcon = null;\r\n\r\n  switch (isHydrated) {\r\n    case true:\r\n      StatusIcon = () => <Icons.ByName name=\"status-alert\" />;\r\n      ToolTipMessage = () => <div>This Segmentation is loaded in the segmentation panel</div>;\r\n      break;\r\n    case false:\r\n      StatusIcon = () => (\r\n        <Icons.ByName\r\n          className=\"text-muted-foreground h-4 w-4\"\r\n          name=\"status-untracked\"\r\n        />\r\n      );\r\n      ToolTipMessage = () => <div>Click LOAD to load segmentation.</div>;\r\n  }\r\n\r\n  const StatusArea = () => {\r\n    const { t } = useTranslation('Common');\r\n    const loadStr = t('LOAD');\r\n\r\n    return (\r\n      <div className=\"flex h-6 cursor-default text-sm leading-6 text-white\">\r\n        <div className=\"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1\">\r\n          <StatusIcon />\r\n          <span className=\"ml-1\">SEG</span>\r\n        </div>\r\n        {!isHydrated && (\r\n          <ViewportActionButton onInteraction={onStatusClick}>{loadStr}</ViewportActionButton>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {ToolTipMessage && (\r\n        <Tooltip>\r\n          <TooltipTrigger asChild>\r\n            <span>\r\n              <StatusArea />\r\n            </span>\r\n          </TooltipTrigger>\r\n          <TooltipContent side=\"bottom\">\r\n            <ToolTipMessage />\r\n          </TooltipContent>\r\n        </Tooltip>\r\n      )}\r\n      {!ToolTipMessage && <StatusArea />}\r\n    </>\r\n  );\r\n}\r\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ViewportActionArrows } from '@ohif/ui-next';\r\nimport { useViewportGrid } from '@ohif/ui-next';\r\nimport createSEGToolGroupAndAddTools from '../utils/initSEGToolGroup';\r\nimport promptHydrateSEG from '../utils/promptHydrateSEG';\r\nimport _getStatusComponent from './_getStatusComponent';\r\nimport { usePositionPresentationStore } from '@ohif/extension-cornerstone';\r\nimport { SegmentationRepresentations } from '@cornerstonejs/tools/enums';\r\nimport { utils } from '@ohif/extension-cornerstone';\r\n\r\nconst SEG_TOOLGROUP_BASE_NAME = 'SEGToolGroup';\r\n\r\nfunction OHIFCornerstoneSEGViewport(props: withAppTypes) {\r\n  const {\r\n    children,\r\n    displaySets,\r\n    viewportOptions,\r\n    servicesManager,\r\n    extensionManager,\r\n    commandsManager,\r\n  } = props;\r\n\r\n  const { t } = useTranslation('SEGViewport');\r\n  const viewportId = viewportOptions.viewportId;\r\n\r\n  const {\r\n    displaySetService,\r\n    toolGroupService,\r\n    segmentationService,\r\n    customizationService,\r\n    viewportActionCornersService,\r\n  } = servicesManager.services;\r\n\r\n  const LoadingIndicatorTotalPercent = customizationService.getCustomization(\r\n    'ui.loadingIndicatorTotalPercent'\r\n  );\r\n\r\n  const toolGroupId = `${SEG_TOOLGROUP_BASE_NAME}-${viewportId}`;\r\n\r\n  // SEG viewport will always have a single display set\r\n  if (displaySets.length > 1) {\r\n    throw new Error('SEG viewport should only have a single display set');\r\n  }\r\n\r\n  const segDisplaySet = displaySets[0];\r\n  const [viewportGrid, viewportGridService] = useViewportGrid();\r\n\r\n  // States\r\n  const selectedSegmentObjectIndex: number = 0;\r\n  const { setPositionPresentation } = usePositionPresentationStore();\r\n\r\n  // Hydration means that the SEG is opened and segments are loaded into the\r\n  // segmentation panel, and SEG is also rendered on any viewport that is in the\r\n  // same frameOfReferenceUID as the referencedSeriesUID of the SEG. However,\r\n  // loading basically means SEG loading over network and bit unpacking of the\r\n  // SEG data.\r\n  const [isHydrated, setIsHydrated] = useState(segDisplaySet.isHydrated);\r\n  const [segIsLoading, setSegIsLoading] = useState(!segDisplaySet.isLoaded);\r\n  const [element, setElement] = useState(null);\r\n  const [processingProgress, setProcessingProgress] = useState({\r\n    percentComplete: null,\r\n    totalSegments: null,\r\n  });\r\n\r\n  // refs\r\n  const referencedDisplaySetRef = useRef(null);\r\n\r\n  const { viewports, activeViewportId } = viewportGrid;\r\n\r\n  const referencedDisplaySetInstanceUID = segDisplaySet.referencedDisplaySetInstanceUID;\r\n  const referencedDisplaySet = displaySetService.getDisplaySetByUID(\r\n    referencedDisplaySetInstanceUID\r\n  );\r\n\r\n  const referencedDisplaySetMetadata = _getReferencedDisplaySetMetadata(\r\n    referencedDisplaySet,\r\n    segDisplaySet\r\n  );\r\n\r\n  referencedDisplaySetRef.current = {\r\n    displaySet: referencedDisplaySet,\r\n    metadata: referencedDisplaySetMetadata,\r\n  };\r\n  /**\r\n   * OnElementEnabled callback which is called after the cornerstoneExtension\r\n   * has enabled the element. Note: we delegate all the image rendering to\r\n   * cornerstoneExtension, so we don't need to do anything here regarding\r\n   * the image rendering, element enabling etc.\r\n   */\r\n  const onElementEnabled = evt => {\r\n    setElement(evt.detail.element);\r\n  };\r\n\r\n  const onElementDisabled = () => {\r\n    setElement(null);\r\n  };\r\n\r\n  const storePresentationState = useCallback(() => {\r\n    viewportGrid?.viewports.forEach(({ viewportId }) => {\r\n      commandsManager.runCommand('storePresentation', {\r\n        viewportId,\r\n      });\r\n    });\r\n  }, [viewportGrid]);\r\n\r\n  const getCornerstoneViewport = useCallback(() => {\r\n    const { component: Component } = extensionManager.getModuleEntry(\r\n      '@ohif/extension-cornerstone.viewportModule.cornerstone'\r\n    );\r\n\r\n    // Todo: jump to the center of the first segment\r\n    return (\r\n      <Component\r\n        {...props}\r\n        displaySets={[segDisplaySet]}\r\n        viewportOptions={{\r\n          viewportType: viewportOptions.viewportType,\r\n          toolGroupId: toolGroupId,\r\n          orientation: viewportOptions.orientation,\r\n          viewportId: viewportOptions.viewportId,\r\n          presentationIds: viewportOptions.presentationIds,\r\n        }}\r\n        onElementEnabled={evt => {\r\n          props.onElementEnabled?.(evt);\r\n          onElementEnabled(evt);\r\n        }}\r\n        onElementDisabled={onElementDisabled}\r\n      ></Component>\r\n    );\r\n  }, [viewportId, segDisplaySet, toolGroupId]);\r\n\r\n  const onSegmentChange = useCallback(\r\n    direction => {\r\n      utils.handleSegmentChange({\r\n        direction,\r\n        segDisplaySet: segDisplaySet,\r\n        viewportId,\r\n        selectedSegmentObjectIndex,\r\n        segmentationService,\r\n      });\r\n    },\r\n    [selectedSegmentObjectIndex]\r\n  );\r\n\r\n  const hydrateSEG = useCallback(() => {\r\n    // update the previously stored segmentationPresentation with the new viewportId\r\n    // presentation so that when we put the referencedDisplaySet back in the viewport\r\n    // it will have the correct segmentation representation hydrated\r\n    commandsManager.runCommand('updateStoredSegmentationPresentation', {\r\n      displaySet: segDisplaySet,\r\n      type: SegmentationRepresentations.Labelmap,\r\n    });\r\n\r\n    // update the previously stored positionPresentation with the new viewportId\r\n    // presentation so that when we put the referencedDisplaySet back in the viewport\r\n    // it will be in the correct position zoom and pan\r\n    commandsManager.runCommand('updateStoredPositionPresentation', {\r\n      viewportId,\r\n      displaySetInstanceUID: referencedDisplaySet.displaySetInstanceUID,\r\n    });\r\n\r\n    commandsManager.runCommand('loadSegmentationDisplaySetsForViewport', {\r\n      viewportId,\r\n      displaySetInstanceUIDs: [referencedDisplaySet.displaySetInstanceUID],\r\n    });\r\n  }, [commandsManager, viewportId, referencedDisplaySet, segDisplaySet]);\r\n\r\n  useEffect(() => {\r\n    if (segIsLoading) {\r\n      return;\r\n    }\r\n\r\n    promptHydrateSEG({\r\n      servicesManager,\r\n      viewportId,\r\n      segDisplaySet,\r\n      preHydrateCallbacks: [storePresentationState],\r\n      hydrateCallback: hydrateSEG,\r\n    }).then(isHydrated => {\r\n      if (isHydrated) {\r\n        setIsHydrated(true);\r\n      }\r\n    });\r\n  }, [servicesManager, viewportId, segDisplaySet, segIsLoading, hydrateSEG]);\r\n\r\n  useEffect(() => {\r\n    // on new seg display set, remove all segmentations from all viewports\r\n    segmentationService.clearSegmentationRepresentations(viewportId);\r\n\r\n    const { unsubscribe } = segmentationService.subscribe(\r\n      segmentationService.EVENTS.SEGMENTATION_LOADING_COMPLETE,\r\n      evt => {\r\n        if (evt.segDisplaySet.displaySetInstanceUID === segDisplaySet.displaySetInstanceUID) {\r\n          setSegIsLoading(false);\r\n        }\r\n\r\n        if (segDisplaySet?.firstSegmentedSliceImageId && viewportOptions?.presentationIds) {\r\n          const { firstSegmentedSliceImageId } = segDisplaySet;\r\n          const { presentationIds } = viewportOptions;\r\n\r\n          setPositionPresentation(presentationIds.positionPresentationId, {\r\n            viewReference: {\r\n              referencedImageId: firstSegmentedSliceImageId,\r\n            },\r\n          });\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [segDisplaySet]);\r\n\r\n  useEffect(() => {\r\n    const { unsubscribe } = segmentationService.subscribe(\r\n      segmentationService.EVENTS.SEGMENT_LOADING_COMPLETE,\r\n      ({ percentComplete, numSegments }) => {\r\n        setProcessingProgress({\r\n          percentComplete,\r\n          totalSegments: numSegments,\r\n        });\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [segDisplaySet]);\r\n\r\n  /**\r\n   Cleanup the SEG viewport when the viewport is destroyed\r\n   */\r\n  useEffect(() => {\r\n    const onDisplaySetsRemovedSubscription = displaySetService.subscribe(\r\n      displaySetService.EVENTS.DISPLAY_SETS_REMOVED,\r\n      ({ displaySetInstanceUIDs }) => {\r\n        const activeViewport = viewports.get(activeViewportId);\r\n        if (displaySetInstanceUIDs.includes(activeViewport.displaySetInstanceUID)) {\r\n          viewportGridService.setDisplaySetsForViewport({\r\n            viewportId: activeViewportId,\r\n            displaySetInstanceUIDs: [],\r\n          });\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      onDisplaySetsRemovedSubscription.unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let toolGroup = toolGroupService.getToolGroup(toolGroupId);\r\n\r\n    if (toolGroup) {\r\n      return;\r\n    }\r\n\r\n    // keep the already stored segmentationPresentation for this viewport in memory\r\n    // so that we can restore it after hydrating the SEG\r\n    commandsManager.runCommand('updateStoredSegmentationPresentation', {\r\n      displaySet: segDisplaySet,\r\n      type: SegmentationRepresentations.Labelmap,\r\n    });\r\n\r\n    // always start fresh for this viewport since it is special type of viewport\r\n    // that should only show one segmentation at a time.\r\n    segmentationService.clearSegmentationRepresentations(viewportId);\r\n\r\n    // This creates a custom tool group which has the lifetime of this view\r\n    // only, and does NOT interfere with currently displayed segmentations.\r\n    toolGroup = createSEGToolGroupAndAddTools(toolGroupService, customizationService, toolGroupId);\r\n\r\n    return () => {\r\n      // remove the segmentation representations if seg displayset changed\r\n      // e.g., another seg displayset is dragged into the viewport\r\n      segmentationService.clearSegmentationRepresentations(viewportId);\r\n\r\n      // Only destroy the viewport specific implementation\r\n      toolGroupService.destroyToolGroup(toolGroupId);\r\n    };\r\n  }, []);\r\n\r\n  const onStatusClick = useCallback(async () => {\r\n    // Before hydrating a SEG and make it added to all viewports in the grid\r\n    // that share the same frameOfReferenceUID, we need to store the viewport grid\r\n    // presentation state, so that we can restore it after hydrating the SEG. This is\r\n    // required if the user has changed the viewport (other viewport than SEG viewport)\r\n    // presentation state (w/l and invert) and then opens the SEG. If we don't store\r\n    // the presentation state, the viewport will be reset to the default presentation\r\n    storePresentationState();\r\n    hydrateSEG();\r\n  }, [storePresentationState, hydrateSEG]);\r\n\r\n  useEffect(() => {\r\n    viewportActionCornersService.addComponents([\r\n      {\r\n        viewportId,\r\n        id: 'viewportStatusComponent',\r\n        component: _getStatusComponent({\r\n          isHydrated,\r\n          onStatusClick,\r\n        }),\r\n        indexPriority: -100,\r\n        location: viewportActionCornersService.LOCATIONS.topLeft,\r\n      },\r\n      {\r\n        viewportId,\r\n        id: 'viewportActionArrowsComponent',\r\n        component: (\r\n          <ViewportActionArrows\r\n            key=\"actionArrows\"\r\n            onArrowsClick={onSegmentChange}\r\n            className={\r\n              viewportId === activeViewportId ? 'visible' : 'invisible group-hover/pane:visible'\r\n            }\r\n          ></ViewportActionArrows>\r\n        ),\r\n        indexPriority: 0,\r\n        location: viewportActionCornersService.LOCATIONS.topRight,\r\n      },\r\n    ]);\r\n  }, [\r\n    activeViewportId,\r\n    isHydrated,\r\n    onSegmentChange,\r\n    onStatusClick,\r\n    viewportActionCornersService,\r\n    viewportId,\r\n  ]);\r\n\r\n  // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n  let childrenWithProps = null;\r\n\r\n  if (\r\n    !referencedDisplaySetRef.current ||\r\n    referencedDisplaySet.displaySetInstanceUID !==\r\n      referencedDisplaySetRef.current.displaySet.displaySetInstanceUID\r\n  ) {\r\n    return null;\r\n  }\r\n\r\n  if (children && children.length) {\r\n    childrenWithProps = children.map((child, index) => {\r\n      return (\r\n        child &&\r\n        React.cloneElement(child, {\r\n          viewportId,\r\n          key: index,\r\n        })\r\n      );\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"relative flex h-full w-full flex-row overflow-hidden\">\r\n        {segIsLoading && (\r\n          <LoadingIndicatorTotalPercent\r\n            className=\"h-full w-full\"\r\n            totalNumbers={processingProgress.totalSegments}\r\n            percentComplete={processingProgress.percentComplete}\r\n            loadingText=\"Loading SEG...\"\r\n          />\r\n        )}\r\n        {getCornerstoneViewport()}\r\n        {childrenWithProps}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction _getReferencedDisplaySetMetadata(referencedDisplaySet, segDisplaySet) {\r\n  const { SharedFunctionalGroupsSequence } = segDisplaySet.instance;\r\n\r\n  const SharedFunctionalGroup = Array.isArray(SharedFunctionalGroupsSequence)\r\n    ? SharedFunctionalGroupsSequence[0]\r\n    : SharedFunctionalGroupsSequence;\r\n\r\n  const { PixelMeasuresSequence } = SharedFunctionalGroup;\r\n\r\n  const PixelMeasures = Array.isArray(PixelMeasuresSequence)\r\n    ? PixelMeasuresSequence[0]\r\n    : PixelMeasuresSequence;\r\n\r\n  const { SpacingBetweenSlices, SliceThickness } = PixelMeasures;\r\n\r\n  const image0 = referencedDisplaySet.images[0];\r\n  const referencedDisplaySetMetadata = {\r\n    PatientID: image0.PatientID,\r\n    PatientName: image0.PatientName,\r\n    PatientSex: image0.PatientSex,\r\n    PatientAge: image0.PatientAge,\r\n    SliceThickness: image0.SliceThickness || SliceThickness,\r\n    StudyDate: image0.StudyDate,\r\n    SeriesDescription: image0.SeriesDescription,\r\n    SeriesInstanceUID: image0.SeriesInstanceUID,\r\n    SeriesNumber: image0.SeriesNumber,\r\n    ManufacturerModelName: image0.ManufacturerModelName,\r\n    SpacingBetweenSlices: image0.SpacingBetweenSlices || SpacingBetweenSlices,\r\n  };\r\n\r\n  return referencedDisplaySetMetadata;\r\n}\r\n\r\nexport default OHIFCornerstoneSEGViewport;\r\n"],"names":["ToolGroupService","customizationService","toolGroupId","tools","getCustomization","createToolGroupAndAddTools","RESPONSE","NO_NEVER","CANCEL","HYDRATE_SEG","servicesManager","segDisplaySet","viewportId","preHydrateCallbacks","hydrateCallback","uiViewportDialogService","services","appConfig","_extensionManager","_appConfig","Promise","async","resolve","reject","promptResult","disableConfirmationPrompts","message","actions","id","type","text","value","onSubmit","result","hide","show","onOutsideClick","onKeyPress","event","key","_askHydrate","forEach","callback","window","setTimeout","isHydrated","_getStatusComponent","onStatusClick","ToolTipMessage","StatusIcon","React","Icons","ByName","name","className","StatusArea","t","useTranslation","loadStr","ViewportActionButton","onInteraction","Tooltip","TooltipTrigger","asChild","TooltipContent","side","props","children","displaySets","viewportOptions","extensionManager","commandsManager","displaySetService","toolGroupService","segmentationService","viewportActionCornersService","LoadingIndicatorTotalPercent","length","Error","viewportGrid","viewportGridService","useViewportGrid","setPositionPresentation","usePositionPresentationStore","setIsHydrated","useState","segIsLoading","setSegIsLoading","isLoaded","element","setElement","processingProgress","setProcessingProgress","percentComplete","totalSegments","referencedDisplaySetRef","useRef","viewports","activeViewportId","referencedDisplaySetInstanceUID","referencedDisplaySet","getDisplaySetByUID","referencedDisplaySetMetadata","SharedFunctionalGroupsSequence","instance","SharedFunctionalGroup","Array","isArray","PixelMeasuresSequence","PixelMeasures","SpacingBetweenSlices","SliceThickness","image0","images","PatientID","PatientName","PatientSex","PatientAge","StudyDate","SeriesDescription","SeriesInstanceUID","SeriesNumber","ManufacturerModelName","_getReferencedDisplaySetMetadata","current","displaySet","metadata","onElementDisabled","storePresentationState","useCallback","runCommand","getCornerstoneViewport","component","Component","getModuleEntry","_extends","viewportType","orientation","presentationIds","onElementEnabled","evt","detail","onSegmentChange","direction","utils","handleSegmentChange","selectedSegmentObjectIndex","hydrateSEG","SegmentationRepresentations","Labelmap","displaySetInstanceUID","displaySetInstanceUIDs","useEffect","promptHydrateSEG","then","clearSegmentationRepresentations","unsubscribe","subscribe","EVENTS","SEGMENTATION_LOADING_COMPLETE","firstSegmentedSliceImageId","positionPresentationId","viewReference","referencedImageId","SEGMENT_LOADING_COMPLETE","numSegments","onDisplaySetsRemovedSubscription","DISPLAY_SETS_REMOVED","activeViewport","get","includes","setDisplaySetsForViewport","toolGroup","getToolGroup","createSEGToolGroupAndAddTools","destroyToolGroup","addComponents","indexPriority","location","LOCATIONS","topLeft","ViewportActionArrows","onArrowsClick","topRight","childrenWithProps","map","child","index","totalNumbers","loadingText"],"sourceRoot":""}