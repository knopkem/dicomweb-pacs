{"version":3,"file":"dist/584.ohif-extension-tmtv.umd.js","mappings":"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","sources":["webpack://ohif-extension-tmtv/webpack/universalModuleDefinition","webpack://ohif-extension-tmtv/external umd \"@cornerstonejs/tools\"","webpack://ohif-extension-tmtv/external umd \"@kitware/vtk.js/Common/Core/DataArray\"","webpack://ohif-extension-tmtv/external umd \"@kitware/vtk.js/Common/DataModel/ImageData\"","webpack://ohif-extension-tmtv/external umd \"gl-matrix\"","webpack://ohif-extension-tmtv/webpack/bootstrap","webpack://ohif-extension-tmtv/webpack/runtime/compat get default export","webpack://ohif-extension-tmtv/webpack/runtime/define property getters","webpack://ohif-extension-tmtv/webpack/runtime/hasOwnProperty shorthand","webpack://ohif-extension-tmtv/../../../node_modules/comlink/dist/esm/comlink.mjs","webpack://ohif-extension-tmtv/./utils/calculateSUVPeakWorker.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@cornerstonejs/tools\"), require(\"@kitware/vtk.js/Common/Core/DataArray\"), require(\"@kitware/vtk.js/Common/DataModel/ImageData\"), require(\"gl-matrix\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@cornerstonejs/tools\", \"@kitware/vtk.js/Common/Core/DataArray\", \"@kitware/vtk.js/Common/DataModel/ImageData\", \"gl-matrix\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ohif-extension-tmtv\"] = factory(require(\"@cornerstonejs/tools\"), require(\"@kitware/vtk.js/Common/Core/DataArray\"), require(\"@kitware/vtk.js/Common/DataModel/ImageData\"), require(\"gl-matrix\"));\n\telse\n\t\troot[\"ohif-extension-tmtv\"] = factory(root[\"@cornerstonejs/tools\"], root[\"@kitware/vtk.js/Common/Core/DataArray\"], root[\"@kitware/vtk.js/Common/DataModel/ImageData\"], root[\"gl-matrix\"]);\n})(globalThis, (__WEBPACK_EXTERNAL_MODULE__713__, __WEBPACK_EXTERNAL_MODULE__670__, __WEBPACK_EXTERNAL_MODULE__322__, __WEBPACK_EXTERNAL_MODULE__155__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__713__;","module.exports = __WEBPACK_EXTERNAL_MODULE__670__;","module.exports = __WEBPACK_EXTERNAL_MODULE__322__;","module.exports = __WEBPACK_EXTERNAL_MODULE__155__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\nconst proxyMarker = Symbol(\"Comlink.proxy\");\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\nconst finalizer = Symbol(\"Comlink.finalizer\");\nconst throwMarker = Symbol(\"Comlink.thrown\");\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\n/**\n * Internal transfer handle to handle objects marked to proxy.\n */\nconst proxyTransferHandler = {\n    canHandle: (val) => isObject(val) && val[proxyMarker],\n    serialize(obj) {\n        const { port1, port2 } = new MessageChannel();\n        expose(obj, port1);\n        return [port2, [port2]];\n    },\n    deserialize(port) {\n        port.start();\n        return wrap(port);\n    },\n};\n/**\n * Internal transfer handler to handle thrown exceptions.\n */\nconst throwTransferHandler = {\n    canHandle: (value) => isObject(value) && throwMarker in value,\n    serialize({ value }) {\n        let serialized;\n        if (value instanceof Error) {\n            serialized = {\n                isError: true,\n                value: {\n                    message: value.message,\n                    name: value.name,\n                    stack: value.stack,\n                },\n            };\n        }\n        else {\n            serialized = { isError: false, value };\n        }\n        return [serialized, []];\n    },\n    deserialize(serialized) {\n        if (serialized.isError) {\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\n        }\n        throw serialized.value;\n    },\n};\n/**\n * Allows customizing the serialization of certain values.\n */\nconst transferHandlers = new Map([\n    [\"proxy\", proxyTransferHandler],\n    [\"throw\", throwTransferHandler],\n]);\nfunction isAllowedOrigin(allowedOrigins, origin) {\n    for (const allowedOrigin of allowedOrigins) {\n        if (origin === allowedOrigin || allowedOrigin === \"*\") {\n            return true;\n        }\n        if (allowedOrigin instanceof RegExp && allowedOrigin.test(origin)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction expose(obj, ep = globalThis, allowedOrigins = [\"*\"]) {\n    ep.addEventListener(\"message\", function callback(ev) {\n        if (!ev || !ev.data) {\n            return;\n        }\n        if (!isAllowedOrigin(allowedOrigins, ev.origin)) {\n            console.warn(`Invalid origin '${ev.origin}' for comlink proxy`);\n            return;\n        }\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\n        let returnValue;\n        try {\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\n            switch (type) {\n                case \"GET\" /* MessageType.GET */:\n                    {\n                        returnValue = rawValue;\n                    }\n                    break;\n                case \"SET\" /* MessageType.SET */:\n                    {\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\n                        returnValue = true;\n                    }\n                    break;\n                case \"APPLY\" /* MessageType.APPLY */:\n                    {\n                        returnValue = rawValue.apply(parent, argumentList);\n                    }\n                    break;\n                case \"CONSTRUCT\" /* MessageType.CONSTRUCT */:\n                    {\n                        const value = new rawValue(...argumentList);\n                        returnValue = proxy(value);\n                    }\n                    break;\n                case \"ENDPOINT\" /* MessageType.ENDPOINT */:\n                    {\n                        const { port1, port2 } = new MessageChannel();\n                        expose(obj, port2);\n                        returnValue = transfer(port1, [port1]);\n                    }\n                    break;\n                case \"RELEASE\" /* MessageType.RELEASE */:\n                    {\n                        returnValue = undefined;\n                    }\n                    break;\n                default:\n                    return;\n            }\n        }\n        catch (value) {\n            returnValue = { value, [throwMarker]: 0 };\n        }\n        Promise.resolve(returnValue)\n            .catch((value) => {\n            return { value, [throwMarker]: 0 };\n        })\n            .then((returnValue) => {\n            const [wireValue, transferables] = toWireValue(returnValue);\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\n            if (type === \"RELEASE\" /* MessageType.RELEASE */) {\n                // detach and deactive after sending release response above.\n                ep.removeEventListener(\"message\", callback);\n                closeEndPoint(ep);\n                if (finalizer in obj && typeof obj[finalizer] === \"function\") {\n                    obj[finalizer]();\n                }\n            }\n        })\n            .catch((error) => {\n            // Send Serialization Error To Caller\n            const [wireValue, transferables] = toWireValue({\n                value: new TypeError(\"Unserializable return value\"),\n                [throwMarker]: 0,\n            });\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\n        });\n    });\n    if (ep.start) {\n        ep.start();\n    }\n}\nfunction isMessagePort(endpoint) {\n    return endpoint.constructor.name === \"MessagePort\";\n}\nfunction closeEndPoint(endpoint) {\n    if (isMessagePort(endpoint))\n        endpoint.close();\n}\nfunction wrap(ep, target) {\n    return createProxy(ep, [], target);\n}\nfunction throwIfProxyReleased(isReleased) {\n    if (isReleased) {\n        throw new Error(\"Proxy has been released and is not useable\");\n    }\n}\nfunction releaseEndpoint(ep) {\n    return requestResponseMessage(ep, {\n        type: \"RELEASE\" /* MessageType.RELEASE */,\n    }).then(() => {\n        closeEndPoint(ep);\n    });\n}\nconst proxyCounter = new WeakMap();\nconst proxyFinalizers = \"FinalizationRegistry\" in globalThis &&\n    new FinalizationRegistry((ep) => {\n        const newCount = (proxyCounter.get(ep) || 0) - 1;\n        proxyCounter.set(ep, newCount);\n        if (newCount === 0) {\n            releaseEndpoint(ep);\n        }\n    });\nfunction registerProxy(proxy, ep) {\n    const newCount = (proxyCounter.get(ep) || 0) + 1;\n    proxyCounter.set(ep, newCount);\n    if (proxyFinalizers) {\n        proxyFinalizers.register(proxy, ep, proxy);\n    }\n}\nfunction unregisterProxy(proxy) {\n    if (proxyFinalizers) {\n        proxyFinalizers.unregister(proxy);\n    }\n}\nfunction createProxy(ep, path = [], target = function () { }) {\n    let isProxyReleased = false;\n    const proxy = new Proxy(target, {\n        get(_target, prop) {\n            throwIfProxyReleased(isProxyReleased);\n            if (prop === releaseProxy) {\n                return () => {\n                    unregisterProxy(proxy);\n                    releaseEndpoint(ep);\n                    isProxyReleased = true;\n                };\n            }\n            if (prop === \"then\") {\n                if (path.length === 0) {\n                    return { then: () => proxy };\n                }\n                const r = requestResponseMessage(ep, {\n                    type: \"GET\" /* MessageType.GET */,\n                    path: path.map((p) => p.toString()),\n                }).then(fromWireValue);\n                return r.then.bind(r);\n            }\n            return createProxy(ep, [...path, prop]);\n        },\n        set(_target, prop, rawValue) {\n            throwIfProxyReleased(isProxyReleased);\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\n            // boolean. To show good will, we return true asynchronously ¯\\_(ツ)_/¯\n            const [value, transferables] = toWireValue(rawValue);\n            return requestResponseMessage(ep, {\n                type: \"SET\" /* MessageType.SET */,\n                path: [...path, prop].map((p) => p.toString()),\n                value,\n            }, transferables).then(fromWireValue);\n        },\n        apply(_target, _thisArg, rawArgumentList) {\n            throwIfProxyReleased(isProxyReleased);\n            const last = path[path.length - 1];\n            if (last === createEndpoint) {\n                return requestResponseMessage(ep, {\n                    type: \"ENDPOINT\" /* MessageType.ENDPOINT */,\n                }).then(fromWireValue);\n            }\n            // We just pretend that `bind()` didn’t happen.\n            if (last === \"bind\") {\n                return createProxy(ep, path.slice(0, -1));\n            }\n            const [argumentList, transferables] = processArguments(rawArgumentList);\n            return requestResponseMessage(ep, {\n                type: \"APPLY\" /* MessageType.APPLY */,\n                path: path.map((p) => p.toString()),\n                argumentList,\n            }, transferables).then(fromWireValue);\n        },\n        construct(_target, rawArgumentList) {\n            throwIfProxyReleased(isProxyReleased);\n            const [argumentList, transferables] = processArguments(rawArgumentList);\n            return requestResponseMessage(ep, {\n                type: \"CONSTRUCT\" /* MessageType.CONSTRUCT */,\n                path: path.map((p) => p.toString()),\n                argumentList,\n            }, transferables).then(fromWireValue);\n        },\n    });\n    registerProxy(proxy, ep);\n    return proxy;\n}\nfunction myFlat(arr) {\n    return Array.prototype.concat.apply([], arr);\n}\nfunction processArguments(argumentList) {\n    const processed = argumentList.map(toWireValue);\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\n}\nconst transferCache = new WeakMap();\nfunction transfer(obj, transfers) {\n    transferCache.set(obj, transfers);\n    return obj;\n}\nfunction proxy(obj) {\n    return Object.assign(obj, { [proxyMarker]: true });\n}\nfunction windowEndpoint(w, context = globalThis, targetOrigin = \"*\") {\n    return {\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\n        addEventListener: context.addEventListener.bind(context),\n        removeEventListener: context.removeEventListener.bind(context),\n    };\n}\nfunction toWireValue(value) {\n    for (const [name, handler] of transferHandlers) {\n        if (handler.canHandle(value)) {\n            const [serializedValue, transferables] = handler.serialize(value);\n            return [\n                {\n                    type: \"HANDLER\" /* WireValueType.HANDLER */,\n                    name,\n                    value: serializedValue,\n                },\n                transferables,\n            ];\n        }\n    }\n    return [\n        {\n            type: \"RAW\" /* WireValueType.RAW */,\n            value,\n        },\n        transferCache.get(value) || [],\n    ];\n}\nfunction fromWireValue(value) {\n    switch (value.type) {\n        case \"HANDLER\" /* WireValueType.HANDLER */:\n            return transferHandlers.get(value.name).deserialize(value.value);\n        case \"RAW\" /* WireValueType.RAW */:\n            return value.value;\n    }\n}\nfunction requestResponseMessage(ep, msg, transfers) {\n    return new Promise((resolve) => {\n        const id = generateUUID();\n        ep.addEventListener(\"message\", function l(ev) {\n            if (!ev.data || !ev.data.id || ev.data.id !== id) {\n                return;\n            }\n            ep.removeEventListener(\"message\", l);\n            resolve(ev.data);\n        });\n        if (ep.start) {\n            ep.start();\n        }\n        ep.postMessage(Object.assign({ id }, msg), transfers);\n    });\n}\nfunction generateUUID() {\n    return new Array(4)\n        .fill(0)\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\n        .join(\"-\");\n}\n\nexport { createEndpoint, expose, finalizer, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","import { utilities } from '@cornerstonejs/tools';\nimport { vec3 } from 'gl-matrix';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkDataArray from '@kitware/vtk.js/Common/Core/DataArray';\nimport { expose } from 'comlink';\n\nconst createVolume = ({ dimensions, origin, direction, spacing, scalarData, metadata }) => {\n  const imageData = vtkImageData.newInstance();\n  imageData.setDimensions(dimensions);\n  imageData.setOrigin(origin);\n  imageData.setDirection(direction);\n  imageData.setSpacing(spacing);\n\n  const scalarArray = vtkDataArray.newInstance({\n    name: 'Pixels',\n    numberOfComponents: 1,\n    values: scalarData,\n  });\n\n  imageData.getPointData().setScalars(scalarArray);\n\n  imageData.modified();\n\n  return {\n    imageData,\n    metadata,\n    getScalarData: () => scalarData,\n  };\n};\n/**\n * This method calculates the SUV peak on a segmented ROI from a reference PET\n * volume. If a rectangle annotation is provided, the peak is calculated within that\n * rectangle. Otherwise, the calculation is performed on the entire volume which\n * will be slower but same result.\n * @param viewport Viewport to use for the calculation\n * @param labelmap Labelmap from which the mask is taken\n * @param referenceVolume PET volume to use for SUV calculation\n * @param toolData [Optional] list of toolData to use for SUV calculation\n * @param segmentIndex The index of the segment to use for masking\n * @returns\n */\nfunction calculateSuvPeak({ labelmapProps, referenceVolumeProps, annotations, segmentIndex = 1 }) {\n  const labelmap = createVolume(labelmapProps);\n  const referenceVolume = createVolume(referenceVolumeProps);\n\n  if (referenceVolume.metadata.Modality !== 'PT') {\n    return;\n  }\n\n  const labelmapData = labelmap.getScalarData();\n  const referenceVolumeData = referenceVolume.getScalarData();\n\n  if (labelmapData.length !== referenceVolumeData.length) {\n    throw new Error('labelmap and referenceVolume must have the same number of pixels');\n  }\n\n  const { dimensions, imageData: labelmapImageData } = labelmap;\n  const { imageData: referenceVolumeImageData } = referenceVolume;\n\n  let boundsIJK;\n  // Todo: using the first annotation for now\n  if (annotations?.length && annotations[0].data?.cachedStats) {\n    const { projectionPoints } = annotations[0].data.cachedStats;\n    const pointsToUse = [].concat(...projectionPoints); // cannot use flat() because of typescript compiler right now\n\n    const rectangleCornersIJK = pointsToUse.map(world => {\n      const ijk = vec3.fromValues(0, 0, 0);\n      referenceVolumeImageData.worldToIndex(world, ijk);\n      return ijk;\n    });\n\n    boundsIJK = utilities.boundingBox.getBoundingBoxAroundShape(rectangleCornersIJK, dimensions);\n  }\n\n  let max = 0;\n  let maxIJK = [0, 0, 0];\n  let maxLPS = [0, 0, 0];\n\n  const callback = ({ pointIJK, pointLPS }) => {\n    const offset = referenceVolumeImageData.computeOffsetIndex(pointIJK);\n    const value = labelmapData[offset];\n\n    if (value !== segmentIndex) {\n      return;\n    }\n\n    const referenceValue = referenceVolumeData[offset];\n\n    if (referenceValue > max) {\n      max = referenceValue;\n      maxIJK = pointIJK;\n      maxLPS = pointLPS;\n    }\n  };\n\n  utilities.pointInShapeCallback(labelmapImageData, () => true, callback, boundsIJK);\n\n  const direction = labelmapImageData.getDirection().slice(0, 3);\n\n  /**\n   * 2. Find the bottom and top of the great circle for the second sphere (1cc sphere)\n   * V = (4/3)πr3\n   */\n  const radius = Math.pow(1 / ((4 / 3) * Math.PI), 1 / 3) * 10;\n  const diameter = radius * 2;\n\n  const secondaryCircleWorld = vec3.create();\n  const bottomWorld = vec3.create();\n  const topWorld = vec3.create();\n  referenceVolumeImageData.indexToWorld(maxIJK, secondaryCircleWorld);\n  vec3.scaleAndAdd(bottomWorld, secondaryCircleWorld, direction, -diameter / 2);\n  vec3.scaleAndAdd(topWorld, secondaryCircleWorld, direction, diameter / 2);\n  const suvPeakCirclePoints = [bottomWorld, topWorld];\n\n  /**\n   * 3. Find the Mean and Max of the 1cc sphere centered on the suv Max of the previous\n   * sphere\n   */\n  let count = 0;\n  let acc = 0;\n  const suvPeakMeanCallback = ({ value }) => {\n    acc += value;\n    count += 1;\n  };\n\n  utilities.pointInSurroundingSphereCallback(\n    referenceVolumeImageData,\n    suvPeakCirclePoints,\n    suvPeakMeanCallback\n  );\n\n  const mean = acc / count;\n\n  return {\n    max,\n    maxIJK,\n    maxLPS,\n    mean,\n  };\n}\n\nconst obj = {\n  calculateSuvPeak,\n};\n\nexpose(obj);\n"],"names":["root","factory","exports","module","require","define","amd","globalThis","__WEBPACK_EXTERNAL_MODULE__713__","__WEBPACK_EXTERNAL_MODULE__670__","__WEBPACK_EXTERNAL_MODULE__322__","__WEBPACK_EXTERNAL_MODULE__155__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","proxyMarker","Symbol","createEndpoint","releaseProxy","finalizer","throwMarker","isObject","val","proxyTransferHandler","canHandle","serialize","port1","port2","MessageChannel","expose","deserialize","port","start","createProxy","target","transferHandlers","Map","value","serialized","Error","isError","message","name","stack","assign","ep","allowedOrigins","addEventListener","callback","ev","data","origin","allowedOrigin","RegExp","test","isAllowedOrigin","console","warn","id","type","path","argumentList","map","fromWireValue","returnValue","parent","slice","reduce","rawValue","apply","proxy","transfers","transferCache","set","transfer","Promise","resolve","catch","then","wireValue","transferables","toWireValue","postMessage","removeEventListener","closeEndPoint","error","TypeError","endpoint","constructor","isMessagePort","close","throwIfProxyReleased","isReleased","releaseEndpoint","requestResponseMessage","proxyCounter","WeakMap","proxyFinalizers","FinalizationRegistry","newCount","isProxyReleased","Proxy","_target","unregister","unregisterProxy","length","r","p","toString","bind","_thisArg","rawArgumentList","last","processArguments","construct","register","registerProxy","processed","v","arr","Array","concat","handler","serializedValue","msg","fill","Math","floor","random","Number","MAX_SAFE_INTEGER","join","l","createVolume","dimensions","direction","spacing","scalarData","metadata","imageData","vtkImageData","setDimensions","setOrigin","setDirection","setSpacing","scalarArray","vtkDataArray","numberOfComponents","values","getPointData","setScalars","modified","getScalarData","calculateSuvPeak","labelmapProps","referenceVolumeProps","annotations","segmentIndex","labelmap","referenceVolume","Modality","labelmapData","referenceVolumeData","labelmapImageData","referenceVolumeImageData","boundsIJK","cachedStats","projectionPoints","rectangleCornersIJK","world","ijk","vec3","fromValues","worldToIndex","utilities","boundingBox","getBoundingBoxAroundShape","max","maxIJK","maxLPS","pointInShapeCallback","pointIJK","pointLPS","offset","computeOffsetIndex","referenceValue","getDirection","diameter","pow","PI","secondaryCircleWorld","create","bottomWorld","topWorld","indexToWorld","scaleAndAdd","suvPeakCirclePoints","count","acc","pointInSurroundingSphereCallback","suvPeakMeanCallback","mean"],"sourceRoot":""}