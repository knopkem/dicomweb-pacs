{"version":3,"file":"2701.bundle.b389364e2a611cb92afc.js","mappings":"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","sources":["webpack:///../../../extensions/cornerstone-dicom-sr/src/components/OHIFCornerstoneSRMeasurementViewport.tsx","webpack:///../../../extensions/cornerstone-dicom-sr/src/utils/formatContentItem.ts","webpack:///../../../extensions/cornerstone-dicom-sr/src/components/OHIFCornerstoneSRContentItem.tsx","webpack:///../../../extensions/cornerstone-dicom-sr/src/components/OHIFCornerstoneSRContainer.tsx","webpack:///../../../extensions/cornerstone-dicom-sr/src/components/OHIFCornerstoneSRTextViewport.tsx","webpack:///../../../extensions/cornerstone-dicom-sr/src/components/OHIFCornerstoneSRViewport.tsx"],"sourcesContent":["import PropTypes from 'prop-types';\r\nimport React, { useCallback, useContext, useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ExtensionManager, useToolbar } from '@ohif/core';\r\n\r\nimport { setTrackingUniqueIdentifiersForElement } from '../tools/modules/dicomSRModule';\r\n\r\nimport { ViewportActionArrows } from '@ohif/ui-next';\r\nimport createReferencedImageDisplaySet from '../utils/createReferencedImageDisplaySet';\r\nimport { usePositionPresentationStore } from '@ohif/extension-cornerstone';\r\nimport { useViewportGrid } from '@ohif/ui-next';\r\nimport { Icons, Tooltip, TooltipTrigger, TooltipContent } from '@ohif/ui-next';\r\n\r\nconst MEASUREMENT_TRACKING_EXTENSION_ID = '@ohif/extension-measurement-tracking';\r\n\r\nconst SR_TOOLGROUP_BASE_NAME = 'SRToolGroup';\r\n\r\nfunction OHIFCornerstoneSRMeasurementViewport(props: withAppTypes) {\r\n  const { children, dataSource, displaySets, viewportOptions, servicesManager, extensionManager } =\r\n    props;\r\n\r\n  const { displaySetService, viewportActionCornersService } = servicesManager.services;\r\n\r\n  const viewportId = viewportOptions.viewportId;\r\n\r\n  // SR viewport will always have a single display set\r\n  if (displaySets.length > 1) {\r\n    throw new Error('SR viewport should only have a single display set');\r\n  }\r\n\r\n  const srDisplaySet = displaySets[0];\r\n\r\n  const { setPositionPresentation } = usePositionPresentationStore();\r\n\r\n  const [viewportGrid, viewportGridService] = useViewportGrid();\r\n  const [measurementSelected, setMeasurementSelected] = useState(0);\r\n  const [measurementCount, setMeasurementCount] = useState(1);\r\n  const [activeImageDisplaySetData, setActiveImageDisplaySetData] = useState(null);\r\n  const [referencedDisplaySetMetadata, setReferencedDisplaySetMetadata] = useState(null);\r\n  const [element, setElement] = useState(null);\r\n  const { viewports, activeViewportId } = viewportGrid;\r\n\r\n  const { t } = useTranslation('Common');\r\n\r\n  // Optional hook into tracking extension, if present.\r\n  let trackedMeasurements;\r\n\r\n  const hasMeasurementTrackingExtension = extensionManager.registeredExtensionIds.includes(\r\n    MEASUREMENT_TRACKING_EXTENSION_ID\r\n  );\r\n\r\n  if (hasMeasurementTrackingExtension) {\r\n    const contextModule = extensionManager.getModuleEntry(\r\n      '@ohif/extension-measurement-tracking.contextModule.TrackedMeasurementsContext'\r\n    );\r\n\r\n    const tracked = useContext(contextModule.context);\r\n    trackedMeasurements = tracked?.[0];\r\n  }\r\n\r\n  /**\r\n   * Todo: what is this, not sure what it does regarding the react aspect,\r\n   * it is updating a local variable? which is not state.\r\n   */\r\n  const [isLocked, setIsLocked] = useState(trackedMeasurements?.context?.trackedSeries?.length > 0);\r\n  /**\r\n   * Store the tracking identifiers per viewport in order to be able to\r\n   * show the SR measurements on the referenced image on the correct viewport,\r\n   * when multiple viewports are used.\r\n   */\r\n  const setTrackingIdentifiers = useCallback(\r\n    measurementSelected => {\r\n      const { measurements } = srDisplaySet;\r\n\r\n      setTrackingUniqueIdentifiersForElement(\r\n        element,\r\n        measurements.map(measurement => measurement.TrackingUniqueIdentifier),\r\n        measurementSelected\r\n      );\r\n    },\r\n    [element, measurementSelected, srDisplaySet]\r\n  );\r\n\r\n  /**\r\n   * OnElementEnabled callback which is called after the cornerstoneExtension\r\n   * has enabled the element. Note: we delegate all the image rendering to\r\n   * cornerstoneExtension, so we don't need to do anything here regarding\r\n   * the image rendering, element enabling etc.\r\n   */\r\n  const onElementEnabled = evt => {\r\n    setElement(evt.detail.element);\r\n  };\r\n\r\n  const updateViewport = useCallback(\r\n    newMeasurementSelected => {\r\n      const { StudyInstanceUID, displaySetInstanceUID, sopClassUids } = srDisplaySet;\r\n\r\n      if (!StudyInstanceUID || !displaySetInstanceUID) {\r\n        return;\r\n      }\r\n\r\n      if (sopClassUids && sopClassUids.length > 1) {\r\n        // Todo: what happens if there are multiple SOP Classes? Why we are\r\n        // not throwing an error?\r\n        console.warn('More than one SOPClassUID in the same series is not yet supported.');\r\n      }\r\n\r\n      // if (!srDisplaySet.measurements || !srDisplaySet.measurements.length) {\r\n      //   return;\r\n      // }\r\n\r\n      _getViewportReferencedDisplaySetData(\r\n        srDisplaySet,\r\n        newMeasurementSelected,\r\n        displaySetService\r\n      ).then(({ referencedDisplaySet, referencedDisplaySetMetadata }) => {\r\n        if (!referencedDisplaySet || !referencedDisplaySetMetadata) {\r\n          return;\r\n        }\r\n\r\n        setMeasurementSelected(newMeasurementSelected);\r\n\r\n        setActiveImageDisplaySetData(referencedDisplaySet);\r\n        setReferencedDisplaySetMetadata(referencedDisplaySetMetadata);\r\n\r\n        const { presentationIds } = viewportOptions;\r\n        const measurement = srDisplaySet.measurements[newMeasurementSelected];\r\n        setPositionPresentation(presentationIds.positionPresentationId, {\r\n          viewReference: {\r\n            referencedImageId: measurement.imageId,\r\n          },\r\n        });\r\n      });\r\n    },\r\n    [dataSource, srDisplaySet, activeImageDisplaySetData, viewportId]\r\n  );\r\n\r\n  const getCornerstoneViewport = useCallback(() => {\r\n    if (!activeImageDisplaySetData) {\r\n      return null;\r\n    }\r\n\r\n    const { component: Component } = extensionManager.getModuleEntry(\r\n      '@ohif/extension-cornerstone.viewportModule.cornerstone'\r\n    );\r\n\r\n    const { measurements } = srDisplaySet;\r\n    const measurement = measurements[measurementSelected];\r\n\r\n    if (!measurement) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <Component\r\n        {...props}\r\n        // should be passed second since we don't want SR displaySet to\r\n        // override the activeImageDisplaySetData\r\n        displaySets={[activeImageDisplaySetData]}\r\n        // It is possible that there is a hanging protocol applying viewportOptions\r\n        // for the SR, so inherit the viewport options\r\n        // TODO: Ensure the viewport options are set correctly with respect to\r\n        // stack etc, in the incoming viewport options.\r\n        viewportOptions={{\r\n          ...viewportOptions,\r\n          toolGroupId: `${SR_TOOLGROUP_BASE_NAME}`,\r\n          // viewportType should not be required, as the stack type should be\r\n          // required already in order to view SR, but sometimes segmentation\r\n          // views set the viewport type without fixing the allowed display\r\n          viewportType: 'stack',\r\n          // The positionIds for the viewport aren't meaningful for the child display sets\r\n          positionIds: null,\r\n        }}\r\n        onElementEnabled={evt => {\r\n          props.onElementEnabled?.(evt);\r\n          onElementEnabled(evt);\r\n        }}\r\n        isJumpToMeasurementDisabled={true}\r\n      ></Component>\r\n    );\r\n  }, [activeImageDisplaySetData, viewportId, measurementSelected]);\r\n\r\n  const onMeasurementChange = useCallback(\r\n    direction => {\r\n      let newMeasurementSelected = measurementSelected;\r\n\r\n      newMeasurementSelected += direction;\r\n      if (newMeasurementSelected >= measurementCount) {\r\n        newMeasurementSelected = 0;\r\n      } else if (newMeasurementSelected < 0) {\r\n        newMeasurementSelected = measurementCount - 1;\r\n      }\r\n\r\n      setTrackingIdentifiers(newMeasurementSelected);\r\n      updateViewport(newMeasurementSelected);\r\n    },\r\n    [measurementSelected, measurementCount, updateViewport, setTrackingIdentifiers]\r\n  );\r\n\r\n  /**\r\n   Cleanup the SR viewport when the viewport is destroyed\r\n   */\r\n  useEffect(() => {\r\n    const onDisplaySetsRemovedSubscription = displaySetService.subscribe(\r\n      displaySetService.EVENTS.DISPLAY_SETS_REMOVED,\r\n      ({ displaySetInstanceUIDs }) => {\r\n        const activeViewport = viewports.get(activeViewportId);\r\n        if (displaySetInstanceUIDs.includes(activeViewport.displaySetInstanceUID)) {\r\n          viewportGridService.setDisplaySetsForViewport({\r\n            viewportId: activeViewportId,\r\n            displaySetInstanceUIDs: [],\r\n          });\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      onDisplaySetsRemovedSubscription.unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  /**\r\n   * Loading the measurements from the SR viewport, which goes through the\r\n   * isHydratable check, the outcome for the isHydrated state here is always FALSE\r\n   * since we don't do the hydration here. Todo: can't we just set it as false? why\r\n   * we are changing the state here? isHydrated is always false at this stage, and\r\n   * if it is hydrated we don't even use the SR viewport.\r\n   */\r\n  useEffect(() => {\r\n    const loadSR = async () => {\r\n      if (!srDisplaySet.isLoaded) {\r\n        await srDisplaySet.load();\r\n      }\r\n      const numMeasurements = srDisplaySet.measurements.length;\r\n      setMeasurementCount(numMeasurements);\r\n      updateViewport(measurementSelected);\r\n    };\r\n    loadSR();\r\n  }, [srDisplaySet]);\r\n\r\n  /**\r\n   * Hook to update the tracking identifiers when the selected measurement changes or\r\n   * the element changes\r\n   */\r\n  useEffect(() => {\r\n    const updateSR = async () => {\r\n      if (!srDisplaySet.isLoaded) {\r\n        await srDisplaySet.load();\r\n      }\r\n      if (!element || !srDisplaySet.isLoaded) {\r\n        return;\r\n      }\r\n      setTrackingIdentifiers(measurementSelected);\r\n    };\r\n    updateSR();\r\n  }, [measurementSelected, element, setTrackingIdentifiers, srDisplaySet]);\r\n\r\n  useEffect(() => {\r\n    setIsLocked(trackedMeasurements?.context?.trackedSeries?.length > 0);\r\n  }, [trackedMeasurements]);\r\n\r\n  useEffect(() => {\r\n    viewportActionCornersService.addComponents([\r\n      {\r\n        viewportId,\r\n        id: 'viewportStatusComponent',\r\n        component: _getStatusComponent({\r\n          srDisplaySet,\r\n          viewportId,\r\n          isRehydratable: srDisplaySet.isRehydratable,\r\n          isLocked,\r\n          t,\r\n          servicesManager,\r\n        }),\r\n        indexPriority: -100,\r\n        location: viewportActionCornersService.LOCATIONS.topLeft,\r\n      },\r\n      {\r\n        viewportId,\r\n        id: 'viewportActionArrowsComponent',\r\n        index: 0,\r\n        component: (\r\n          <ViewportActionArrows\r\n            key=\"actionArrows\"\r\n            onArrowsClick={onMeasurementChange}\r\n          ></ViewportActionArrows>\r\n        ),\r\n        indexPriority: 0,\r\n        location: viewportActionCornersService.LOCATIONS.topRight,\r\n      },\r\n    ]);\r\n  }, [isLocked, onMeasurementChange, srDisplaySet, t, viewportActionCornersService, viewportId]);\r\n\r\n  // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n  let childrenWithProps = null;\r\n\r\n  if (!activeImageDisplaySetData || !referencedDisplaySetMetadata) {\r\n    return null;\r\n  }\r\n\r\n  if (children && children.length) {\r\n    childrenWithProps = children.map((child, index) => {\r\n      return (\r\n        child &&\r\n        React.cloneElement(child, {\r\n          viewportId,\r\n          key: index,\r\n        })\r\n      );\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"relative flex h-full w-full flex-row overflow-hidden\">\r\n        {getCornerstoneViewport()}\r\n        {childrenWithProps}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nOHIFCornerstoneSRMeasurementViewport.propTypes = {\r\n  displaySets: PropTypes.arrayOf(PropTypes.object),\r\n  viewportId: PropTypes.string.isRequired,\r\n  dataSource: PropTypes.object,\r\n  children: PropTypes.node,\r\n  viewportLabel: PropTypes.string,\r\n  viewportOptions: PropTypes.object,\r\n  servicesManager: PropTypes.object.isRequired,\r\n  extensionManager: PropTypes.instanceOf(ExtensionManager).isRequired,\r\n};\r\n\r\nasync function _getViewportReferencedDisplaySetData(\r\n  displaySet,\r\n  measurementSelected,\r\n  displaySetService\r\n) {\r\n  const { measurements } = displaySet;\r\n  const measurement = measurements[measurementSelected];\r\n\r\n  const { displaySetInstanceUID } = measurement;\r\n  if (!displaySet.keyImageDisplaySet) {\r\n    // Create a new display set, and preserve a reference to it here,\r\n    // so that it can be re-displayed and shown inside the SR viewport.\r\n    // This is only for ease of redisplay - the display set is stored in the\r\n    // usual manner in the display set service.\r\n    displaySet.keyImageDisplaySet = createReferencedImageDisplaySet(displaySetService, displaySet);\r\n  }\r\n\r\n  if (!displaySetInstanceUID) {\r\n    return { referencedDisplaySetMetadata: null, referencedDisplaySet: null };\r\n  }\r\n\r\n  const referencedDisplaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\r\n\r\n  const image0 = referencedDisplaySet.images[0];\r\n  const referencedDisplaySetMetadata = {\r\n    PatientID: image0.PatientID,\r\n    PatientName: image0.PatientName,\r\n    PatientSex: image0.PatientSex,\r\n    PatientAge: image0.PatientAge,\r\n    SliceThickness: image0.SliceThickness,\r\n    StudyDate: image0.StudyDate,\r\n    SeriesDescription: image0.SeriesDescription,\r\n    SeriesInstanceUID: image0.SeriesInstanceUID,\r\n    SeriesNumber: image0.SeriesNumber,\r\n    ManufacturerModelName: image0.ManufacturerModelName,\r\n    SpacingBetweenSlices: image0.SpacingBetweenSlices,\r\n  };\r\n\r\n  return { referencedDisplaySetMetadata, referencedDisplaySet };\r\n}\r\n\r\nfunction _getStatusComponent({\r\n  srDisplaySet,\r\n  viewportId,\r\n  isRehydratable,\r\n  isLocked,\r\n  t,\r\n  servicesManager,\r\n}) {\r\n  const loadStr = t('LOAD');\r\n\r\n  // 1 - Incompatible\r\n  // 2 - Locked\r\n  // 3 - Rehydratable / Open\r\n  const state = isRehydratable && !isLocked ? 3 : isRehydratable && isLocked ? 2 : 1;\r\n  let ToolTipMessage = null;\r\n  let StatusIcon = null;\r\n\r\n  switch (state) {\r\n    case 1:\r\n      StatusIcon = () => (\r\n        <Icons.ByName\r\n          name=\"status-alert\"\r\n          className=\"h-4 w-4\"\r\n        />\r\n      );\r\n\r\n      ToolTipMessage = () => (\r\n        <div>\r\n          This structured report is not compatible\r\n          <br />\r\n          with this application.\r\n        </div>\r\n      );\r\n      break;\r\n    case 2:\r\n      StatusIcon = () => (\r\n        <Icons.ByName\r\n          name=\"status-locked\"\r\n          className=\"h-4 w-4\"\r\n        />\r\n      );\r\n\r\n      ToolTipMessage = () => (\r\n        <div>\r\n          This structured report is currently read-only\r\n          <br />\r\n          because you are tracking measurements in\r\n          <br />\r\n          another viewport.\r\n        </div>\r\n      );\r\n      break;\r\n    case 3:\r\n      StatusIcon = () => (\r\n        <Icons.ByName\r\n          className=\"text-muted-foreground h-4 w-4\"\r\n          name=\"status-untracked\"\r\n        />\r\n      );\r\n\r\n      ToolTipMessage = () => <div>{`Click ${loadStr} to restore measurements.`}</div>;\r\n  }\r\n\r\n  const StatusArea = () => {\r\n    const { toolbarButtons: loadSRMeasurementsButtons, onInteraction } = useToolbar({\r\n      servicesManager,\r\n      buttonSection: 'loadSRMeasurements',\r\n    });\r\n\r\n    const commandOptions = {\r\n      displaySetInstanceUID: srDisplaySet.displaySetInstanceUID,\r\n      viewportId,\r\n    };\r\n\r\n    return (\r\n      <div className=\"flex h-6 cursor-default text-sm leading-6 text-white\">\r\n        <div className=\"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1\">\r\n          <StatusIcon className=\"h-4 w-4\" />\r\n          <span className=\"ml-1\">SR</span>\r\n        </div>\r\n        {state === 3 && (\r\n          <>\r\n            {loadSRMeasurementsButtons.map(toolDef => {\r\n              if (!toolDef) {\r\n                return null;\r\n              }\r\n              const { id, Component, componentProps } = toolDef;\r\n              const tool = (\r\n                <Component\r\n                  key={id}\r\n                  id={id}\r\n                  onInteraction={args => onInteraction({ ...args, ...commandOptions })}\r\n                  {...componentProps}\r\n                />\r\n              );\r\n\r\n              return <div key={id}>{tool}</div>;\r\n            })}\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {ToolTipMessage && (\r\n        <Tooltip>\r\n          <TooltipTrigger asChild>\r\n            <span>\r\n              <StatusArea />\r\n            </span>\r\n          </TooltipTrigger>\r\n          <TooltipContent\r\n            side=\"bottom\"\r\n            align=\"start\"\r\n          >\r\n            <ToolTipMessage />\r\n          </TooltipContent>\r\n        </Tooltip>\r\n      )}\r\n      {!ToolTipMessage && <StatusArea />}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default OHIFCornerstoneSRMeasurementViewport;\r\n","import { utils } from '@ohif/core';\r\n\r\n/**\r\n * Formatters used to format each of the content items (SR \"nodes\") which can be\r\n * text, code, UID ref, number, person name, date, time and date time. Each\r\n * formatter must be a function with the following signature:\r\n *\r\n *    [VALUE_TYPE]: (contentItem) => string\r\n *\r\n */\r\nconst contentItemFormatters = {\r\n  TEXT: contentItem => contentItem.TextValue,\r\n  CODE: contentItem => contentItem.ConceptCodeSequence?.[0]?.CodeMeaning,\r\n  UIDREF: contentItem => contentItem.UID,\r\n  NUM: contentItem => {\r\n    const measuredValue = contentItem.MeasuredValueSequence?.[0];\r\n\r\n    if (!measuredValue) {\r\n      return;\r\n    }\r\n\r\n    const { NumericValue, MeasurementUnitsCodeSequence } = measuredValue;\r\n    const { CodeValue } = MeasurementUnitsCodeSequence;\r\n\r\n    return `${NumericValue} ${CodeValue}`;\r\n  },\r\n  PNAME: contentItem => {\r\n    const personName = contentItem.PersonName?.[0];\r\n    return personName ? utils.formatPN(personName) : undefined;\r\n  },\r\n  DATE: contentItem => {\r\n    const { Date } = contentItem;\r\n    return Date ? utils.formatDate(Date) : undefined;\r\n  },\r\n  TIME: contentItem => {\r\n    const { Time } = contentItem;\r\n    return Time ? utils.formatTime(Time) : undefined;\r\n  },\r\n  DATETIME: contentItem => {\r\n    const { DateTime } = contentItem;\r\n\r\n    if (typeof DateTime !== 'string') {\r\n      return;\r\n    }\r\n\r\n    // 14 characters because it should be something like 20180614113714\r\n    if (DateTime.length < 14) {\r\n      return DateTime;\r\n    }\r\n\r\n    const dicomDate = DateTime.substring(0, 8);\r\n    const dicomTime = DateTime.substring(8, 14);\r\n    const formattedDate = utils.formatDate(dicomDate);\r\n    const formattedTime = utils.formatTime(dicomTime);\r\n\r\n    return `${formattedDate} ${formattedTime}`;\r\n  },\r\n};\r\n\r\nfunction formatContentItemValue(contentItem) {\r\n  const { ValueType } = contentItem;\r\n  const fnFormat = contentItemFormatters[ValueType];\r\n\r\n  return fnFormat ? fnFormat(contentItem) : `[${ValueType} is not supported]`;\r\n}\r\n\r\nexport { formatContentItemValue as default, formatContentItemValue };\r\n","import PropTypes from 'prop-types';\r\nimport React from 'react';\r\nimport { CodeNameCodeSequenceValues } from '../enums';\r\nimport formatContentItemValue from '../utils/formatContentItem';\r\n\r\nconst EMPTY_TAG_VALUE = '[empty]';\r\n\r\nfunction OHIFCornerstoneSRContentItem(props) {\r\n  const { contentItem, nodeIndexesTree, continuityOfContent } = props;\r\n  const { ConceptNameCodeSequence } = contentItem;\r\n  const { CodeValue, CodeMeaning } = ConceptNameCodeSequence;\r\n  const isChildFirstNode = nodeIndexesTree[nodeIndexesTree.length - 1] === 0;\r\n  const formattedValue = formatContentItemValue(contentItem) ?? EMPTY_TAG_VALUE;\r\n  const startWithAlphaNumCharRegEx = /^[a-zA-Z0-9]/;\r\n  const isContinuous = continuityOfContent === 'CONTINUOUS';\r\n  const isFinding = CodeValue === CodeNameCodeSequenceValues.Finding;\r\n  const addExtraSpace =\r\n    isContinuous && !isChildFirstNode && startWithAlphaNumCharRegEx.test(formattedValue?.[0]);\r\n\r\n  // Collapse sequences of white space preserving newline characters\r\n  let className = 'whitespace-pre-line';\r\n\r\n  if (CodeValue === CodeNameCodeSequenceValues.Finding) {\r\n    // Preserve spaces because it is common to see tabular text in a\r\n    // \"Findings\" ConceptNameCodeSequence\r\n    className = 'whitespace-pre-wrap';\r\n  }\r\n\r\n  if (isContinuous) {\r\n    return (\r\n      <>\r\n        <span\r\n          className={className}\r\n          title={CodeMeaning}\r\n        >\r\n          {addExtraSpace ? ' ' : ''}\r\n          {formattedValue}\r\n        </span>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"mb-2\">\r\n        <span className=\"font-bold\">{CodeMeaning}: </span>\r\n        {isFinding ? (\r\n          <pre>{formattedValue}</pre>\r\n        ) : (\r\n          <span className={className}>{formattedValue}</span>\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nOHIFCornerstoneSRContentItem.propTypes = {\r\n  contentItem: PropTypes.object,\r\n  nodeIndexesTree: PropTypes.arrayOf(PropTypes.number),\r\n  continuityOfContent: PropTypes.string,\r\n};\r\n\r\nexport { OHIFCornerstoneSRContentItem };\r\n","import PropTypes from 'prop-types';\r\nimport React from 'react';\r\nimport { OHIFCornerstoneSRContentItem } from './OHIFCornerstoneSRContentItem';\r\n\r\nexport function OHIFCornerstoneSRContainer(props) {\r\n  const { container, nodeIndexesTree = [0], containerNumberedTree = [1] } = props;\r\n  const { ContinuityOfContent, ConceptNameCodeSequence } = container;\r\n  const { CodeMeaning } = ConceptNameCodeSequence ?? {};\r\n  let childContainerIndex = 1;\r\n  const contentItems = container.ContentSequence?.map((contentItem, i) => {\r\n    const { ValueType } = contentItem;\r\n    const childNodeLevel = [...nodeIndexesTree, i];\r\n    const key = childNodeLevel.join('.');\r\n\r\n    let Component;\r\n    let componentProps;\r\n\r\n    if (ValueType === 'CONTAINER') {\r\n      const childContainerNumberedTree = [...containerNumberedTree, childContainerIndex++];\r\n\r\n      Component = OHIFCornerstoneSRContainer;\r\n      componentProps = {\r\n        container: contentItem,\r\n        nodeIndexesTree: childNodeLevel,\r\n        containerNumberedTree: childContainerNumberedTree,\r\n      };\r\n    } else {\r\n      Component = OHIFCornerstoneSRContentItem;\r\n      componentProps = {\r\n        contentItem,\r\n        nodeIndexesTree: childNodeLevel,\r\n        continuityOfContent: ContinuityOfContent,\r\n      };\r\n    }\r\n\r\n    return (\r\n      <Component\r\n        key={key}\r\n        {...componentProps}\r\n      />\r\n    );\r\n  });\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"font-bold\">\r\n        {containerNumberedTree.join('.')}.&nbsp;\r\n        {CodeMeaning}\r\n      </div>\r\n      <div className=\"ml-4 mb-2\">{contentItems}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nOHIFCornerstoneSRContainer.propTypes = {\r\n  /**\r\n   * A tree node that may contain another container or one or more content items\r\n   * (text, code, uidref, pname, etc.)\r\n   */\r\n  container: PropTypes.object,\r\n  /**\r\n   * A 0-based index list\r\n   */\r\n  nodeIndexesTree: PropTypes.arrayOf(PropTypes.number),\r\n  /**\r\n   * A 1-based index list that represents a container in a multi-level numbered\r\n   * list (tree).\r\n   *\r\n   * Example:\r\n   *  1. History\r\n   *    1.1. Chief Complaint\r\n   *    1.2. Present Illness\r\n   *    1.3. Past History\r\n   *    1.4. Family History\r\n   *  2. Findings\r\n   * */\r\n  containerNumberedTree: PropTypes.arrayOf(PropTypes.number),\r\n};\r\n","import PropTypes from 'prop-types';\r\nimport React from 'react';\r\nimport { ExtensionManager } from '@ohif/core';\r\nimport { OHIFCornerstoneSRContainer } from './OHIFCornerstoneSRContainer';\r\n\r\nfunction OHIFCornerstoneSRTextViewport(props: withAppTypes) {\r\n  const { displaySets } = props;\r\n  const displaySet = displaySets[0];\r\n  const instance = displaySet.instances[0];\r\n\r\n  return (\r\n    <div className=\"relative flex h-full w-full flex-col overflow-auto p-4 text-white\">\r\n      <div>\r\n        {/* The root level is always a container */}\r\n        <OHIFCornerstoneSRContainer container={instance} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nOHIFCornerstoneSRTextViewport.propTypes = {\r\n  displaySets: PropTypes.arrayOf(PropTypes.object),\r\n  viewportId: PropTypes.string.isRequired,\r\n  dataSource: PropTypes.object,\r\n  children: PropTypes.node,\r\n  viewportLabel: PropTypes.string,\r\n  viewportOptions: PropTypes.object,\r\n  servicesManager: PropTypes.object.isRequired,\r\n  extensionManager: PropTypes.instanceOf(ExtensionManager).isRequired,\r\n};\r\n\r\nexport default OHIFCornerstoneSRTextViewport;\r\n","import PropTypes from 'prop-types';\r\nimport React from 'react';\r\nimport { ExtensionManager } from '@ohif/core';\r\n\r\nimport OHIFCornerstoneSRMeasurementViewport from './OHIFCornerstoneSRMeasurementViewport';\r\nimport OHIFCornerstoneSRTextViewport from './OHIFCornerstoneSRTextViewport';\r\n\r\nfunction OHIFCornerstoneSRViewport(props: withAppTypes) {\r\n  const { displaySets } = props;\r\n  const { isImagingMeasurementReport } = displaySets[0];\r\n\r\n  if (isImagingMeasurementReport) {\r\n    return <OHIFCornerstoneSRMeasurementViewport {...props}></OHIFCornerstoneSRMeasurementViewport>;\r\n  }\r\n\r\n  return <OHIFCornerstoneSRTextViewport {...props}></OHIFCornerstoneSRTextViewport>;\r\n}\r\n\r\nOHIFCornerstoneSRViewport.propTypes = {\r\n  displaySets: PropTypes.arrayOf(PropTypes.object),\r\n  viewportId: PropTypes.string.isRequired,\r\n  dataSource: PropTypes.object,\r\n  children: PropTypes.node,\r\n  viewportLabel: PropTypes.string,\r\n  viewportOptions: PropTypes.object,\r\n  servicesManager: PropTypes.object.isRequired,\r\n  extensionManager: PropTypes.instanceOf(ExtensionManager).isRequired,\r\n};\r\n\r\nexport default OHIFCornerstoneSRViewport;\r\n"],"names":["OHIFCornerstoneSRMeasurementViewport","props","children","dataSource","displaySets","viewportOptions","servicesManager","extensionManager","displaySetService","viewportActionCornersService","services","viewportId","length","Error","srDisplaySet","setPositionPresentation","usePositionPresentationStore","viewportGrid","viewportGridService","useViewportGrid","measurementSelected","setMeasurementSelected","useState","measurementCount","setMeasurementCount","activeImageDisplaySetData","setActiveImageDisplaySetData","referencedDisplaySetMetadata","setReferencedDisplaySetMetadata","element","setElement","viewports","activeViewportId","t","useTranslation","trackedMeasurements","registeredExtensionIds","includes","contextModule","getModuleEntry","tracked","useContext","context","isLocked","setIsLocked","trackedSeries","setTrackingIdentifiers","useCallback","measurements","setTrackingUniqueIdentifiersForElement","map","measurement","TrackingUniqueIdentifier","updateViewport","newMeasurementSelected","StudyInstanceUID","displaySetInstanceUID","sopClassUids","console","warn","async","displaySet","keyImageDisplaySet","createReferencedImageDisplaySet","referencedDisplaySet","getDisplaySetByUID","image0","images","PatientID","PatientName","PatientSex","PatientAge","SliceThickness","StudyDate","SeriesDescription","SeriesInstanceUID","SeriesNumber","ManufacturerModelName","SpacingBetweenSlices","_getViewportReferencedDisplaySetData","then","presentationIds","positionPresentationId","viewReference","referencedImageId","imageId","getCornerstoneViewport","component","Component","React","_extends","toolGroupId","viewportType","positionIds","onElementEnabled","evt","detail","isJumpToMeasurementDisabled","onMeasurementChange","direction","useEffect","onDisplaySetsRemovedSubscription","subscribe","EVENTS","DISPLAY_SETS_REMOVED","displaySetInstanceUIDs","activeViewport","get","setDisplaySetsForViewport","unsubscribe","isLoaded","load","numMeasurements","loadSR","updateSR","addComponents","id","_getStatusComponent","isRehydratable","indexPriority","location","LOCATIONS","topLeft","index","ViewportActionArrows","key","onArrowsClick","topRight","childrenWithProps","child","className","loadStr","state","ToolTipMessage","StatusIcon","Icons","ByName","name","StatusArea","toolbarButtons","loadSRMeasurementsButtons","onInteraction","useToolbar","buttonSection","commandOptions","toolDef","componentProps","tool","args","Tooltip","TooltipTrigger","asChild","TooltipContent","side","align","propTypes","PropTypes","isRequired","viewportLabel","ExtensionManager","contentItemFormatters","TEXT","contentItem","TextValue","CODE","ConceptCodeSequence","CodeMeaning","UIDREF","UID","NUM","measuredValue","MeasuredValueSequence","NumericValue","MeasurementUnitsCodeSequence","CodeValue","PNAME","personName","PersonName","utils","formatPN","undefined","DATE","Date","formatDate","TIME","Time","formatTime","DATETIME","DateTime","dicomDate","substring","dicomTime","EMPTY_TAG_VALUE","OHIFCornerstoneSRContentItem","nodeIndexesTree","continuityOfContent","ConceptNameCodeSequence","isChildFirstNode","formattedValue","ValueType","fnFormat","formatContentItemValue","isContinuous","isFinding","CodeNameCodeSequenceValues","Finding","addExtraSpace","test","title","OHIFCornerstoneSRContainer","container","containerNumberedTree","ContinuityOfContent","childContainerIndex","contentItems","ContentSequence","i","childNodeLevel","join","OHIFCornerstoneSRTextViewport","instance","instances","OHIFCornerstoneSRViewport","isImagingMeasurementReport"],"sourceRoot":""}